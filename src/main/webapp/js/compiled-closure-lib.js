var COMPILED=!1,goog=goog||{};goog.global=this;goog.DEBUG=!0;goog.LOCALE="en";goog.evalWorksForGlobals_=null;goog.provide=function(a){if(!COMPILED){if(goog.getObjectByName(a)&&!goog.implicitNamespaces_[a])throw Error('Namespace "'+a+'" already declared.');for(var b=a;b=b.substring(0,b.lastIndexOf("."));)goog.implicitNamespaces_[b]=!0}goog.exportPath_(a)};COMPILED||(goog.implicitNamespaces_={});
goog.exportPath_=function(a,b,c){a=a.split(".");c=c||goog.global;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&goog.isDef(b)?c[d]=b:c=c[d]?c[d]:c[d]={}};goog.getObjectByName=function(a,b){for(var c=a.split("."),d=b||goog.global,e;e=c.shift();)if(d[e])d=d[e];else return null;return d};goog.globalize=function(a,b){var c=b||goog.global,d;for(d in a)c[d]=a[d]};
goog.addDependency=function(a,b,c){if(!COMPILED){var d;a=a.replace(/\\/g,"/");for(var e=goog.dependencies_,f=0;d=b[f];f++)e.nameToPath[d]=a,a in e.pathToNames||(e.pathToNames[a]={}),e.pathToNames[a][d]=!0;for(d=0;b=c[d];d++)a in e.requires||(e.requires[a]={}),e.requires[a][b]=!0}};
goog.require=function(a){if(!COMPILED&&!goog.getObjectByName(a)){var b=goog.getPathFromDeps_(a);if(b)goog.included_[b]=!0,goog.writeScripts_();else throw a="goog.require could not find: "+a,goog.global.console&&goog.global.console.error(a),Error(a);}};goog.useStrictRequires=!1;goog.basePath="";goog.global.CLOSURE_BASE_PATH;goog.global.CLOSURE_NO_DEPS;goog.nullFunction=function(){};goog.identityFunction=function(a){return a};
goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(a){a.getInstance=function(){return a.instance_||(a.instance_=new a)}};
COMPILED||(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.inHtmlDocument_()){var a=goog.global.document;if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else for(var a=a.getElementsByTagName("script"),b=a.length-1;0<=b;--b){var c=a[b].src,d=c.length;if("base.js"==c.substr(d-7)){goog.basePath=
c.substr(0,d-7);break}}}},goog.writeScriptTag_=function(a){goog.inHtmlDocument_()&&!goog.dependencies_.written[a]&&(goog.dependencies_.written[a]=!0,goog.global.document.write('<script type="text/javascript" src="'+a+'">\x3c/script>'))},goog.writeScripts_=function(){function a(e){if(!(e in d.written)){if(!(e in d.visited)&&(d.visited[e]=!0,e in d.requires))for(var g in d.requires[e])if(g in d.nameToPath)a(d.nameToPath[g]);else if(!goog.getObjectByName(g))throw Error("Undefined nameToPath for "+g);
e in c||(c[e]=!0,b.push(e))}}var b=[],c={},d=goog.dependencies_,e;for(e in goog.included_)d.written[e]||a(e);for(e=0;e<b.length;e++)if(b[e])goog.writeScriptTag_(goog.basePath+b[e]);else throw Error("Undefined script input");},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS);
goog.typeOf=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array||!(a instanceof Object)&&"[object Array]"==Object.prototype.toString.call(a)||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if(!(a instanceof Object||"[object Function]"!=Object.prototype.toString.call(a)&&("undefined"==typeof a.call||"undefined"==typeof a.propertyIsEnumerable||a.propertyIsEnumerable("call"))))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.propertyIsEnumerableCustom_=function(a,b){if(b in a)for(var c in a)if(c==b&&Object.prototype.hasOwnProperty.call(a,b))return!0;return!1};goog.propertyIsEnumerable_=function(a,b){return a instanceof Object?Object.prototype.propertyIsEnumerable.call(a,b):goog.propertyIsEnumerableCustom_(a,b)};goog.isDef=function(a){return void 0!==a};goog.isNull=function(a){return null===a};
goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isString=function(a){return"string"==typeof a};goog.isBoolean=function(a){return"boolean"==typeof a};goog.isNumber=function(a){return"number"==typeof a};
goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){a=goog.typeOf(a);return"object"==a||"array"==a||"function"==a};goog.getHashCode=function(a){if(a.hasOwnProperty&&a.hasOwnProperty(goog.HASH_CODE_PROPERTY_))return a[goog.HASH_CODE_PROPERTY_];a[goog.HASH_CODE_PROPERTY_]||(a[goog.HASH_CODE_PROPERTY_]=++goog.hashCodeCounter_);return a[goog.HASH_CODE_PROPERTY_]};goog.removeHashCode=function(a){"removeAttribute"in a&&a.removeAttribute(goog.HASH_CODE_PROPERTY_);try{delete a[goog.HASH_CODE_PROPERTY_]}catch(b){}};
goog.HASH_CODE_PROPERTY_="closure_hashCode_"+Math.floor(2147483648*Math.random()).toString(36);goog.hashCodeCounter_=0;goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone.call(a);var b="array"==b?[]:{},c;for(c in a)b[c]=goog.cloneObject(a[c]);return b}return a};Object.prototype.clone;
goog.bind=function(a,b,c){var d=b||goog.global;if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(b,e);return a.apply(d,b)}}return function(){return a.apply(d,arguments)}};goog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=Array.prototype.slice.call(arguments);b.unshift.apply(b,c);return a.apply(this,b)}};
goog.mixin=function(a,b){for(var c in b)a[c]=b[c]};goog.now=Date.now||function(){return+new Date};
goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval)if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("script");c.type="text/javascript";c.defer=!1;c.appendChild(b.createTextNode(a));b.body.appendChild(c);
b.body.removeChild(c)}else throw Error("goog.globalEval not available");};goog.typedef=!0;goog.cssNameMapping_;goog.getCssName=function(a,b){var c=a+(b?"-"+b:"");return goog.cssNameMapping_&&c in goog.cssNameMapping_?goog.cssNameMapping_[c]:c};goog.setCssNameMapping=function(a){goog.cssNameMapping_=a};goog.getMsg=function(a,b){var c=b||{},d;for(d in c)a=a.replace(new RegExp("\\{\\$"+d+"\\}","gi"),c[d]);return a};goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)};
goog.exportProperty=function(a,b,c){a[b]=c};goog.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a};
goog.base=function(a,b,c){var d=arguments.callee.caller;if(d.superClass_)return d.superClass_.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var e=Array.prototype.slice.call(arguments,2),f=!1,g=a.constructor;g;g=g.superClass_&&g.superClass_.constructor)if(g.prototype[b]===d)f=!0;else if(f)return g.prototype[b].apply(a,e);if(a[b]===d)return a.constructor.prototype[b].apply(a,e);throw Error("goog.base called from a method of one name to a method of a different name");};goog.array={};goog.array.ArrayLike=goog.typedef;goog.array.peek=function(a){return a[a.length-1]};goog.array.ARRAY_PROTOTYPE_=Array.prototype;goog.array.indexOf=goog.array.ARRAY_PROTOTYPE_.indexOf?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(goog.isString(a))return goog.isString(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};
goog.array.lastIndexOf=goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(a,b,null==c?a.length-1:c)}:function(a,b,c){c=null==c?a.length-1:c;0>c&&(c=Math.max(0,a.length+c));if(goog.isString(a))return goog.isString(b)&&1==b.length?a.lastIndexOf(b,c):-1;for(;0<=c;c--)if(c in a&&a[c]===b)return c;return-1};
goog.array.forEach=goog.array.ARRAY_PROTOTYPE_.forEach?function(a,b,c){goog.array.ARRAY_PROTOTYPE_.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};goog.array.forEachRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,d=d-1;0<=d;--d)d in e&&b.call(c,e[d],d,a)};
goog.array.filter=goog.array.ARRAY_PROTOTYPE_.filter?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=goog.isString(a)?a.split(""):a,h=0;h<d;h++)if(h in g){var k=g[h];b.call(c,k,h,a)&&(e[f++]=k)}return e};
goog.array.map=goog.array.ARRAY_PROTOTYPE_.map?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=goog.isString(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e};goog.array.reduce=function(a,b,c,d){if(a.reduce)return d?a.reduce(goog.bind(b,d),c):a.reduce(b,c);var e=c;goog.array.forEach(a,function(c,g){e=b.call(d,e,c,g,a)});return e};
goog.array.reduceRight=function(a,b,c,d){if(a.reduceRight)return d?a.reduceRight(goog.bind(b,d),c):a.reduceRight(b,c);var e=c;goog.array.forEachRight(a,function(c,g){e=b.call(d,e,c,g,a)});return e};goog.array.some=goog.array.ARRAY_PROTOTYPE_.some?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1};
goog.array.every=goog.array.ARRAY_PROTOTYPE_.every?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0};goog.array.find=function(a,b,c){b=goog.array.findIndex(a,b,c);return 0>b?null:goog.isString(a)?a.charAt(b):a[b]};
goog.array.findIndex=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1};goog.array.findRight=function(a,b,c){b=goog.array.findIndexRight(a,b,c);return 0>b?null:goog.isString(a)?a.charAt(b):a[b]};goog.array.findIndexRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,d=d-1;0<=d;d--)if(d in e&&b.call(c,e[d],d,a))return d;return-1};goog.array.contains=function(a,b){return 0<=goog.array.indexOf(a,b)};
goog.array.isEmpty=function(a){return 0==a.length};goog.array.clear=function(a){if(!goog.isArray(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0};goog.array.insert=function(a,b){goog.array.contains(a,b)||a.push(b)};goog.array.insertAt=function(a,b,c){goog.array.splice(a,c,0,b)};goog.array.insertArrayAt=function(a,b,c){goog.partial(goog.array.splice,a,c,0).apply(null,b)};
goog.array.insertBefore=function(a,b,c){var d;2==arguments.length||0>(d=goog.array.indexOf(a,c))?a.push(b):goog.array.insertAt(a,b,d)};goog.array.remove=function(a,b){var c=goog.array.indexOf(a,b),d;(d=0<=c)&&goog.array.removeAt(a,c);return d};goog.array.removeAt=function(a,b){return 1==goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1).length};goog.array.removeIf=function(a,b,c){b=goog.array.findIndex(a,b,c);return 0<=b?(goog.array.removeAt(a,b),!0):!1};
goog.array.concat=function(a){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)};goog.array.clone=function(a){if(goog.isArray(a))return goog.array.concat(a);for(var b=[],c=0,d=a.length;c<d;c++)b[c]=a[c];return b};goog.array.toArray=function(a){return goog.isArray(a)?goog.array.concat(a):goog.array.clone(a)};
goog.array.extend=function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c],e;if(goog.isArray(d)||(e=goog.isArrayLike(d))&&d.hasOwnProperty("callee"))a.push.apply(a,d);else if(e)for(var f=a.length,g=d.length,h=0;h<g;h++)a[f+h]=d[h];else a.push(d)}};goog.array.splice=function(a,b,c,d){return goog.array.ARRAY_PROTOTYPE_.splice.apply(a,goog.array.slice(arguments,1))};
goog.array.slice=function(a,b,c){return 2>=arguments.length?goog.array.ARRAY_PROTOTYPE_.slice.call(a,b):goog.array.ARRAY_PROTOTYPE_.slice.call(a,b,c)};goog.array.removeDuplicates=function(a,b){for(var c=b||a,d={},e=0,f=0;f<a.length;){var g=a[f++],h=goog.isObject(g)?goog.getHashCode(g):g;Object.prototype.hasOwnProperty.call(d,h)||(d[h]=!0,c[e++]=g)}c.length=e};
goog.array.binarySearch=function(a,b,c){var d=0,e=a.length-1;for(c=c||goog.array.defaultCompare;d<=e;){var f=d+e>>1,g=c(b,a[f]);if(0<g)d=f+1;else if(0>g)e=f-1;else return f}return-(d+1)};goog.array.sort=function(a,b){goog.array.ARRAY_PROTOTYPE_.sort.call(a,b||goog.array.defaultCompare)};
goog.array.stableSort=function(a,b){for(var c=0;c<a.length;c++)a[c]={index:c,value:a[c]};var d=b||goog.array.defaultCompare;goog.array.sort(a,function(a,b){return d(a.value,b.value)||a.index-b.index});for(c=0;c<a.length;c++)a[c]=a[c].value};goog.array.sortObjectsByKey=function(a,b,c){var d=c||goog.array.defaultCompare;goog.array.sort(a,function(a,c){return d(a[b],c[b])})};
goog.array.equals=function(a,b,c){if(!goog.isArrayLike(a)||!goog.isArrayLike(b)||a.length!=b.length)return!1;var d=a.length;c=c||goog.array.defaultCompareEquality;for(var e=0;e<d;e++)if(!c(a[e],b[e]))return!1;return!0};goog.array.compare=function(a,b,c){return goog.array.equals(a,b,c)};goog.array.defaultCompare=function(a,b){return a>b?1:a<b?-1:0};goog.array.defaultCompareEquality=function(a,b){return a===b};
goog.array.binaryInsert=function(a,b,c){c=goog.array.binarySearch(a,b,c);return 0>c?(goog.array.insertAt(a,b,-(c+1)),!0):!1};goog.array.binaryRemove=function(a,b,c){b=goog.array.binarySearch(a,b,c);return 0<=b?goog.array.removeAt(a,b):!1};goog.array.bucket=function(a,b){for(var c={},d=0;d<a.length;d++){var e=a[d],f=b(e,d,a);goog.isDef(f)&&(c[f]||(c[f]=[])).push(e)}return c};goog.array.repeat=function(a,b){for(var c=[],d=0;d<b;d++)c[d]=a;return c};
goog.array.flatten=function(a){for(var b=[],c=0;c<arguments.length;c++){var d=arguments[c];goog.isArray(d)?b.push.apply(b,goog.array.flatten.apply(null,d)):b.push(d)}return b};goog.array.rotate=function(a,b){a.length&&(b%=a.length,0<b?goog.array.ARRAY_PROTOTYPE_.unshift.apply(a,a.splice(-b,b)):0>b&&goog.array.ARRAY_PROTOTYPE_.push.apply(a,a.splice(0,-b)));return a};goog.object={};goog.object.forEach=function(a,b,c){for(var d in a)b.call(c,a[d],d,a)};goog.object.filter=function(a,b,c){var d={},e;for(e in a)b.call(c,a[e],e,a)&&(d[e]=a[e]);return d};goog.object.map=function(a,b,c){var d={},e;for(e in a)d[e]=b.call(c,a[e],e,a);return d};goog.object.some=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return!0;return!1};goog.object.every=function(a,b,c){for(var d in a)if(!b.call(c,a[d],d,a))return!1;return!0};
goog.object.getCount=function(a){var b=0,c;for(c in a)b++;return b};goog.object.getAnyKey=function(a){for(var b in a)return b};goog.object.getAnyValue=function(a){for(var b in a)return a[b]};goog.object.contains=function(a,b){return goog.object.containsValue(a,b)};goog.object.getValues=function(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b};goog.object.getKeys=function(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b};goog.object.containsKey=function(a,b){return b in a};
goog.object.containsValue=function(a,b){for(var c in a)if(a[c]==b)return!0;return!1};goog.object.findKey=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return d};goog.object.findValue=function(a,b,c){return(b=goog.object.findKey(a,b,c))&&a[b]};goog.object.isEmpty=function(a){for(var b in a)return!1;return!0};goog.object.clear=function(a){for(var b=goog.object.getKeys(a),c=b.length-1;0<=c;c--)goog.object.remove(a,b[c])};goog.object.remove=function(a,b){var c;(c=b in a)&&delete a[b];return c};
goog.object.add=function(a,b,c){if(b in a)throw Error('The object already contains the key "'+b+'"');goog.object.set(a,b,c)};goog.object.get=function(a,b,c){return b in a?a[b]:c};goog.object.set=function(a,b,c){a[b]=c};goog.object.setIfUndefined=function(a,b,c){return b in a?a[b]:a[b]=c};goog.object.clone=function(a){var b={},c;for(c in a)b[c]=a[c];return b};goog.object.transpose=function(a){var b={},c;for(c in a)b[a[c]]=c;return b};goog.object.PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.object.extend=function(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<goog.object.PROTOTYPE_FIELDS_.length;f++)c=goog.object.PROTOTYPE_FIELDS_[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};
goog.object.create=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(b%2)throw Error("Uneven number of arguments");for(var c={},d=0;d<b;d+=2)c[arguments[d]]=arguments[d+1];return c};goog.object.createSet=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var c={},d=0;d<b;d++)c[arguments[d]]=!0;return c};goog.math={};goog.math.Coordinate=function(a,b){this.x=goog.isDef(a)?a:0;this.y=goog.isDef(b)?b:0};goog.math.Coordinate.prototype.clone=function(){return new goog.math.Coordinate(this.x,this.y)};goog.DEBUG&&(goog.math.Coordinate.prototype.toString=function(){return"("+this.x+", "+this.y+")"});goog.math.Coordinate.equals=function(a,b){return a==b?!0:a&&b?a.x==b.x&&a.y==b.y:!1};goog.math.Coordinate.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)};
goog.math.Coordinate.squaredDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d};goog.math.Coordinate.difference=function(a,b){return new goog.math.Coordinate(a.x-b.x,a.y-b.y)};goog.math.Coordinate.sum=function(a,b){return new goog.math.Coordinate(a.x+b.x,a.y+b.y)};goog.math.Box=function(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d};goog.math.Box.boundingBox=function(a){for(var b=new goog.math.Box(arguments[0].y,arguments[0].x,arguments[0].y,arguments[0].x),c=1;c<arguments.length;c++){var d=arguments[c];b.top=Math.min(b.top,d.y);b.right=Math.max(b.right,d.x);b.bottom=Math.max(b.bottom,d.y);b.left=Math.min(b.left,d.x)}return b};goog.math.Box.prototype.clone=function(){return new goog.math.Box(this.top,this.right,this.bottom,this.left)};
goog.DEBUG&&(goog.math.Box.prototype.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"});goog.math.Box.prototype.contains=function(a){return goog.math.Box.contains(this,a)};goog.math.Box.prototype.expand=function(a,b,c,d){goog.isObject(a)?(this.top-=a.top,this.right+=a.right,this.bottom+=a.bottom,this.left-=a.left):(this.top-=a,this.right+=b,this.bottom+=c,this.left-=d);return this};
goog.math.Box.equals=function(a,b){return a==b?!0:a&&b?a.top==b.top&&a.right==b.right&&a.bottom==b.bottom&&a.left==b.left:!1};goog.math.Box.contains=function(a,b){return a&&b?b instanceof goog.math.Box?b.left>=a.left&&b.right<=a.right&&b.top>=a.top&&b.bottom<=a.bottom:b.x>=a.left&&b.x<=a.right&&b.y>=a.top&&b.y<=a.bottom:!1};
goog.math.Box.distance=function(a,b){return b.x>=a.left&&b.x<=a.right?b.y>=a.top&&b.y<=a.bottom?0:b.y<a.top?a.top-b.y:b.y-a.bottom:b.y>=a.top&&b.y<=a.bottom?b.x<a.left?a.left-b.x:b.x-a.right:goog.math.Coordinate.distance(b,new goog.math.Coordinate(b.x<a.left?a.left:a.right,b.y<a.top?a.top:a.bottom))};goog.math.Box.intersects=function(a,b){return a.left<=b.right&&b.left<=a.right&&a.top<=b.bottom&&b.top<=a.bottom};goog.math.Range=function(a,b){a=Number(a);b=Number(b);this.start=a<b?a:b;this.end=a<b?b:a};goog.math.Range.prototype.clone=function(){return new goog.math.Range(this.start,this.end)};goog.DEBUG&&(goog.math.Range.prototype.toString=function(){return"["+this.start+", "+this.end+"]"});goog.math.Range.equals=function(a,b){return a==b?!0:a&&b?a.start==b.start&&a.end==b.end:!1};
goog.math.Range.intersection=function(a,b){var c=Math.max(a.start,b.start),d=Math.min(a.end,b.end);return c<=d?new goog.math.Range(c,d):null};goog.math.Range.hasIntersection=function(a,b){return Math.max(a.start,b.start)<=Math.min(a.end,b.end)};goog.math.Range.boundingRange=function(a,b){return new goog.math.Range(Math.min(a.start,b.start),Math.max(a.end,b.end))};goog.math.Range.contains=function(a,b){return a.start<=b.start&&a.end>=b.end};
goog.math.Range.containsPoint=function(a,b){return a.start<=b&&a.end>=b};goog.math.Size=function(a,b){this.width=a;this.height=b};goog.math.Size.equals=function(a,b){return a==b?!0:a&&b?a.width==b.width&&a.height==b.height:!1};goog.math.Size.prototype.clone=function(){return new goog.math.Size(this.width,this.height)};goog.DEBUG&&(goog.math.Size.prototype.toString=function(){return"("+this.width+" x "+this.height+")"});goog.math.Size.prototype.getLongest=function(){return Math.max(this.width,this.height)};
goog.math.Size.prototype.getShortest=function(){return Math.min(this.width,this.height)};goog.math.Size.prototype.area=function(){return this.width*this.height};goog.math.Size.prototype.aspectRatio=function(){return this.width/this.height};goog.math.Size.prototype.isEmpty=function(){return!this.area()};goog.math.Size.prototype.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};
goog.math.Size.prototype.fitsInside=function(a){return this.width<=a.width&&this.height<=a.height};goog.math.Size.prototype.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};goog.math.Size.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};goog.math.Size.prototype.scale=function(a){this.width*=a;this.height*=a;return this};
goog.math.Size.prototype.scaleToFit=function(a){a=this.aspectRatio()>a.aspectRatio()?a.width/this.width:a.height/this.height;return this.scale(a)};goog.math.Rect=function(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d};goog.math.Rect.prototype.clone=function(){return new goog.math.Rect(this.left,this.top,this.width,this.height)};goog.math.Rect.prototype.toBox=function(){return new goog.math.Box(this.top,this.left+this.width,this.top+this.height,this.left)};goog.math.Rect.createFromBox=function(a){return new goog.math.Rect(a.left,a.top,a.right-a.left,a.bottom-a.top)};
goog.DEBUG&&(goog.math.Rect.prototype.toString=function(){return"("+this.left+", "+this.top+" - "+this.width+"w x "+this.height+"h)"});goog.math.Rect.equals=function(a,b){return a==b?!0:a&&b?a.left==b.left&&a.width==b.width&&a.top==b.top&&a.height==b.height:!1};
goog.math.Rect.prototype.intersection=function(a){var b=Math.max(this.left,a.left),c=Math.min(this.left+this.width,a.left+a.width);if(b<=c){var d=Math.max(this.top,a.top);a=Math.min(this.top+this.height,a.top+a.height);if(d<=a)return this.left=b,this.top=d,this.width=c-b,this.height=a-d,!0}return!1};
goog.math.Rect.intersection=function(a,b){var c=Math.max(a.left,b.left),d=Math.min(a.left+a.width,b.left+b.width);if(c<=d){var e=Math.max(a.top,b.top),f=Math.min(a.top+a.height,b.top+b.height);if(e<=f)return new goog.math.Rect(c,e,d-c,f-e)}return null};goog.math.Rect.intersects=function(a,b){return a.left<=b.left+b.width&&b.left<=a.left+a.width&&a.top<=b.top+b.height&&b.top<=a.top+a.height};goog.math.Rect.prototype.intersects=function(a){return goog.math.Rect.intersects(this,a)};
goog.math.Rect.difference=function(a,b){var c=goog.math.Rect.intersection(a,b);if(!c||!c.height||!c.width)return[a.clone()];var c=[],d=a.top,e=a.height,f=a.left+a.width,g=a.top+a.height,h=b.left+b.width,k=b.top+b.height;b.top>a.top&&(c.push(new goog.math.Rect(a.left,a.top,a.width,b.top-a.top)),d=b.top,e-=b.top-a.top);k<g&&(c.push(new goog.math.Rect(a.left,k,a.width,g-k)),e=k-d);b.left>a.left&&c.push(new goog.math.Rect(a.left,d,b.left-a.left,e));h<f&&c.push(new goog.math.Rect(h,d,f-h,e));return c};
goog.math.Rect.prototype.difference=function(a){return goog.math.Rect.difference(this,a)};goog.math.Rect.prototype.boundingRect=function(a){var b=Math.max(this.left+this.width,a.left+a.width),c=Math.max(this.top+this.height,a.top+a.height);this.left=Math.min(this.left,a.left);this.top=Math.min(this.top,a.top);this.width=b-this.left;this.height=c-this.top};goog.math.Rect.boundingRect=function(a,b){if(!a||!b)return null;var c=a.clone();c.boundingRect(b);return c};
goog.math.Rect.prototype.contains=function(a){return a instanceof goog.math.Rect?this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height:a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height};goog.math.Rect.prototype.getSize=function(){return new goog.math.Size(this.width,this.height)};goog.math.randomInt=function(a){return Math.floor(Math.random()*a)};goog.math.uniformRandom=function(a,b){return a+Math.random()*(b-a)};goog.math.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};goog.math.modulo=function(a,b){var c=a%b;return 0>c*b?c+b:c};goog.math.lerp=function(a,b,c){return a+c*(b-a)};goog.math.nearlyEquals=function(a,b,c){return Math.abs(a-b)<=(c||1E-6)};goog.math.standardAngle=function(a){return goog.math.modulo(a,360)};
goog.math.toRadians=function(a){return a*Math.PI/180};goog.math.toDegrees=function(a){return 180*a/Math.PI};goog.math.angleDx=function(a,b){return b*Math.cos(goog.math.toRadians(a))};goog.math.angleDy=function(a,b){return b*Math.sin(goog.math.toRadians(a))};goog.math.angle=function(a,b,c,d){return goog.math.standardAngle(goog.math.toDegrees(Math.atan2(d-b,c-a)))};goog.math.angleDifference=function(a,b){var c=goog.math.standardAngle(b)-goog.math.standardAngle(a);180<c?c-=360:-180>=c&&(c=360+c);return c};
goog.math.sign=function(a){return 0==a?0:0>a?-1:1};goog.math.longestCommonSubsequence=function(a,b,c,d){c=c||function(a,b){return a==b};d=d||function(b,c){return a[b]};for(var e=a.length,f=b.length,g=[],h=0;h<e+1;h++)g[h]=[],g[h][0]=0;for(var k=0;k<f+1;k++)g[0][k]=0;for(h=1;h<=e;h++)for(k=1;k<=e;k++)c(a[h-1],b[k-1])?g[h][k]=g[h-1][k-1]+1:g[h][k]=Math.max(g[h-1][k],g[h][k-1]);for(var m=[],h=e,k=f;0<h&&0<k;)c(a[h-1],b[k-1])?(m.unshift(d(h-1,k-1)),h--,k--):g[h-1][k]>g[h][k-1]?h--:k--;return m};
goog.math.sum=function(a){return goog.array.reduce(arguments,function(a,c){return a+c},0)};goog.math.average=function(a){return goog.math.sum.apply(null,arguments)/arguments.length};goog.math.standardDeviation=function(a){var b=arguments.length;if(2>b)return 0;var c=goog.math.average.apply(null,arguments),b=goog.math.sum.apply(null,goog.array.map(arguments,function(a){return Math.pow(a-c,2)}))/(b-1);return Math.sqrt(b)};goog.math.isInt=function(a){return isFinite(a)&&0==a%1};
goog.math.isFiniteNumber=function(a){return isFinite(a)&&!isNaN(a)};goog.math.Bezier=function(a,b,c,d,e,f,g,h){this.x0=a;this.y0=b;this.x1=c;this.y1=d;this.x2=e;this.y2=f;this.x3=g;this.y3=h};goog.math.Bezier.KAPPA=4*(Math.sqrt(2)-1)/3;goog.math.Bezier.prototype.clone=function(){return new goog.math.Bezier(this.x0,this.y0,this.x1,this.y1,this.x2,this.y2,this.x3,this.y3)};goog.math.Bezier.prototype.equals=function(a){return this.x0==a.x0&&this.y0==a.y0&&this.x1==a.x1&&this.y1==a.y1&&this.x2==a.x2&&this.y2==a.y2&&this.x3==a.x3&&this.y3==a.y3};
goog.math.Bezier.prototype.flip=function(){var a=this.x0;this.x0=this.x3;this.x3=a;a=this.y0;this.y0=this.y3;this.y3=a;a=this.x1;this.x1=this.x2;this.x2=a;a=this.y1;this.y1=this.y2;this.y2=a};
goog.math.Bezier.prototype.getPoint=function(a){if(0==a)return new goog.math.Coordinate(this.x0,this.y0);if(1==a)return new goog.math.Coordinate(this.x3,this.y3);var b=goog.math.lerp(this.x0,this.x1,a),c=goog.math.lerp(this.y0,this.y1,a),d=goog.math.lerp(this.x1,this.x2,a),e=goog.math.lerp(this.y1,this.y2,a),f=goog.math.lerp(this.x2,this.x3,a),g=goog.math.lerp(this.y2,this.y3,a),b=goog.math.lerp(b,d,a),c=goog.math.lerp(c,e,a),d=goog.math.lerp(d,f,a),e=goog.math.lerp(e,g,a);return new goog.math.Coordinate(goog.math.lerp(b,
d,a),goog.math.lerp(c,e,a))};
goog.math.Bezier.prototype.subdivideLeft=function(a){if(1!=a){var b=goog.math.lerp(this.x0,this.x1,a),c=goog.math.lerp(this.y0,this.y1,a),d=goog.math.lerp(this.x1,this.x2,a),e=goog.math.lerp(this.y1,this.y2,a),f=goog.math.lerp(this.x2,this.x3,a),g=goog.math.lerp(this.y2,this.y3,a);this.x1=b;this.y1=c;b=goog.math.lerp(b,d,a);c=goog.math.lerp(c,e,a);d=goog.math.lerp(d,f,a);e=goog.math.lerp(e,g,a);this.x2=b;this.y2=c;this.x3=goog.math.lerp(b,d,a);this.y3=goog.math.lerp(c,e,a)}};
goog.math.Bezier.prototype.subdivideRight=function(a){this.flip();this.subdivideLeft(1-a);this.flip()};goog.math.Bezier.prototype.subdivide=function(a,b){this.subdivideRight(a);this.subdivideLeft((b-a)/(1-a))};var NChart=function(a,b,c){this.characters=a;c=c||{};this.node_spacing=c.node_spacing?c.node_spacing:50;this.subnode_spacing=c.subnode_spacing?c.subnode_spacing:15;this.slope_func=c.slope_func?c.slope_func:function(a){return Math.max(1.5,3.5-a.weight/7)};this.group_styles=c.group_styles?c.group_styles:{};this.group_styles.default_group||(this.group_styles.default_group={"stroke-width":1});this.death_style=c.death_style?c.death_style:{fill:"black",radius:5};this.death_style.radius?(this.death_radius=
this.death_style.radius,delete this.death_style.radius):this.death_radius=5;this.undeath_style=c.undeath_style?c.undeath_style:{fill:"white",stroke:"black",radius:5};this.undeath_style.radius?(this.undeath_radius=this.undeath_style.radius,delete this.undeath_style.radius):this.undeath_radius=5;var d=this;this.bendiness=c.bendiness?c.bendiness:function(a,b,c,h){return Math.min(c-a-d.node_spacing,Math.floor(.375*Math.abs(b-h)))};this.name_style=c.name_style?c.name_style:{fill:"black","font-family":"fantasy",
"font-size":"9",dy:"-2"};this.name_padding=c.name_padding?c.name_padding:{top:20,bottom:20,left:20};this.initial_padding=c.initial_padding?c.initial_padding:{top:20,right:20,bottom:20,left:20};goog.array.forEach(["top","right","bottom","left"],function(a){d.initial_padding[a]=d.initial_padding[a]||0});this.length_tolerance=c.length_tolerance?c.length_tolerance:.1;this.max_scale=c.max_scale?c.max_scale:10;this.min_scale=c.min_scale?c.min_scale:.05;c.start_scale&&"auto"!=c.start_scale&&(this.start_scale=
c.start_scale);!(this.debug=c.debug?c.debug:null)||0<this.debug.direction&&5>this.debug.direction||(d=this,goog.array.forEach(["blocks","classes"],function(a){goog.array.contains(d.debug.features,a)&&(goog.array.remove(d.debug.features,a),alert("Cannot draw "+a+" without a direction"))}),delete this.debug.direction);this.path_styles={"default":{"stroke-width":"inherit","stroke-linecap":"round","stroke-linejoin":"round",fill:"none"},dead:{"stroke-width":"inherit","stroke-linecap":"round","stroke-linejoin":"round",
"stroke-dasharray":"10",fill:"none"},disappeared:null};this.states={"default":{icon:null,noun:null,following_style:"default"},dead:{icon:{circle:{r:5,fill:"black"},skip_radius:7,placement:"end"},noun:"deaths",following_style:"dead",reverses:"default"},undead:{icon:{circle:{r:5,fill:"white",stroke:"black"},skip_radius:7,placement:"end"},noun:"undeaths",reverses:"dead"},disappeared:{icon:{path:{d:"m2,0 m-3.5,-6.06218 l-4,-6.92822 m7.5,12.9904 m-3.5,6.06218 l-4,6.92822 m7.5,-12.9904 m3.5,-6.06218 l4,-6.92822 m-7.5,12.9904 m3.5,6.06218 l4,6.92822 m-7.5,-12.9904 m7,0 l8,0",
stroke:"black","stroke-width":2,"stroke-linecap":"round"},skip_radius:8,placement:"end"},noun:"disappearances",following_style:"disappeared",reverses:"default"},reappeared:{icon:{path:{d:"m-2,0 m-3.5,-6.06218 l-4,-6.92822 m7.5,12.9904 m-3.5,6.06218 l-4,6.92822 m7.5,-12.9904 m3.5,-6.06218 l4,-6.92822 m-7.5,12.9904 m3.5,6.06218 l4,6.92822 m-7.5,-12.9904 m-7,0 l-8,0",stroke:"black","stroke-width":2,"stroke-linecap":"round"},skip_radius:8,placement:"start"},noun:"reappearances",reverses:"disappeared"}};
this.path_breakers=["disappearances"];this.plotter=c.plotter?new c.plotter(this):new NChart.Plotter(this);this.drawer=c.drawer?new c.drawer(this):new NChart.SvgDrawer(this);this.graph=this.parse_layers(b)};NChart.prototype.calc=function(){this.order();this.post_process();return this};NChart.prototype.plot=function(){this.plotter.place_nodes();return this};NChart.prototype.draw=function(a){this.paper_id=a;var b=this;$(function(){b.paper=$("#"+b.paper_id);b.drawer.draw_graph()});return this};
NChart.prototype.parse_layers=function(a){function b(a,b){for(var d=0;d<b.length;d++)c[b[d]]=a}for(var c={},d={},e=[],f=0;f<a.length;f++){var g=a[f];g.segs={};g.num=f;g.prev=a[f-1];g.next=a[f+1];g.node_positions={};for(var h=0;h<g.nodes.length;h++){var k=g.nodes[h];k.id=f+"-"+h;k.duration=g.duration;k.parents=[];k.children=[];k.layer=g;k.draw=!0;k.edges={};k.subnode_positions={};g.node_positions[k.id]=h;for(var m=0;m<k.subnodes.length;m++){var p=k.subnodes[m],n=c[p];k.subnode_positions[p]=m;goog.object.setIfUndefined(d,
p,[]);if(n&&n!=k){var l=f-n.layer.num,q=intersect(k.subnodes,n.subnodes);if(2<l){var t=a[n.layer.num+1],w=a[f-1],r={id:n.layer.num+1+"-"+t.nodes.length,subnodes:q,duration:0,layer:t,p:!0,span:l,draw:n.draw,edges:{},parents:[],children:[]},l={id:f-1+"-"+w.nodes.length,subnodes:q,duration:0,layer:w,q:!0,span:l,draw:n.draw,edges:{},parents:[],children:[]};t.nodes.push(r);w.nodes.push(l);for(t=0;t<q.length;t++)w=q[t],n==c[w]?n.draw&&(d[w].push(r),d[w].push(l)):(q.splice(t,1),t--);this.add_pq_edges(n,
r,l,k,q)}else if(2==l){l=a[f-1];r={id:f-1+"-"+l.nodes.length,subnodes:q,duration:0,layer:l,r:!0,draw:n.draw,edges:{},parents:[],children:[]};l.nodes.push(r);for(t=0;t<q.length;t++)w=q[t],n==c[w]?n.draw&&d[w].push(r):(q.splice(t,1),t--);this.add_r_edges(n,r,k,q)}else this.add_simple_edges(n,k,q);b(k,q)}d[p].push(k);c[p]=k}k.dangle=k.dangle_left=!!k.children.length;if(k.dangle)for(m=0;m<k.parents.length;m++)if(0==k.parents[m].dangle_left){k.dangle=k.dangle_left=!1;break}for(m=0;m<this.path_breakers.length;m++)if(n=
this.path_breakers[m],k[n]&&k[n].length)for(q=0;q<k[n].length;q++)p=k[n][q],r=this.characters[p],r.short_name=p,e.push({character:r,nodes:d[p]}),delete d[p],delete c[p]}}var u=this;goog.object.forEach(d,function(a,b){var c=u.characters[b];c.short_name=b;e.push({character:c,nodes:a})});return{layers:a,char_nodes:e}};NChart.prototype.copy_node=function(a,b){return{id:b.num+"-"+b.nodes.length,subnodes:a.subnodes.slice(0),x:b.nodes[0].x,duration:10,parents:[],children:[],layer:b,edges:{}}};
NChart.prototype.add_simple_edges=function(a,b,c){a.children.push(b);b.parents.push(a);var d=!!(a.nodes||b.nodes||a.p||b.q);a.edges[b.id]={source:a,target:b,is_seg:d,subnodes:c,weight:c.length};b.edges[a.id]={source:b,target:a,is_seg:d,subnodes:c,weight:c.length}};NChart.prototype.add_r_edges=function(a,b,c,d){this.add_simple_edges(a,b,d);this.add_simple_edges(b,c,d)};
NChart.prototype.add_pq_edges=function(a,b,c,d,e){this.add_simple_edges(a,b,e);this.add_simple_edges(c,d,e);a={id:b.id+"-"+c.id,nodes:[b,c],subnodes:e,draw:a.draw,layer:b.layer.next,edges:{},parents:[],children:[]};b.layer.segs[a.id]=b.pq_seg=this.copy_segment(a,b.layer);c.layer.segs[a.id]=c.pq_seg=this.copy_segment(a,c.layer);d=c.layer.num-b.layer.num;if(1==d)this.add_simple_edges(b,c,e);else if(2==d)this.add_simple_edges(b,a,e),this.add_simple_edges(a,c,e),a.layer.segs[a.id]=a;else{d=a;for(var f=
this.copy_segment(a,b.layer.next.next),g=b.layer.num+1;g<c.layer.num-1;g++)this.add_simple_edges(d,f,e),d.layer.segs[d.id]=d,d=f.layer.segs[f.id]=f,f=this.copy_segment(a,f.layer.next);this.add_simple_edges(b,a,e);this.add_simple_edges(d,c,e)}};NChart.prototype.copy_segment=function(a,b){return{id:a.id,nodes:a.nodes.slice(0),subnodes:a.subnodes.slice(0),draw:a.draw,layer:b,edges:{},parents:[],children:[]}};
NChart.prototype.order=function(a){var b;a=0;var c={crossings:Infinity,compaction:[]};goog.object.extend(c,this.graph);var d=!1,e=this.graph.layers[0];e.alt_L=[{segs:[]}];e.subnodes=[];for(var f=0;f<e.nodes.length;f++){var g=e.nodes[f];e.alt_L.push(g);e.alt_L.push({segs:[]});g.subnodes&&(e.subnodes=e.subnodes.concat(g.subnodes))}var h=[],k={},m=[],p=!1;do{b=0;var n=[e.nodes.slice(0)];e.L=n[0];for(f=0;f<this.graph.layers.length-1;f++){e=this.minimize_crossings(e,d);b+=e[0];e=e[1];e.subnodes=[];for(var l=
0;l<e.L.length;l++)g=e.L[l],g.subnodes&&(e.subnodes=e.subnodes.concat(g.subnodes));n=n.concat([e.L])}console.log(a,b);for(f=0;f<h.length;f++)if(l=h[f],l.next==b){l.run++;next_index=l.run%l.pattern.length;if(0==next_index&&3==l.run/l.pattern.length){p=!0;break}l.next=l.pattern[next_index];h.splice(1)}else h.splice(f,1),f--;if(!p){e=goog.object.setIfUndefined(k,b,[]);if(!h.length)for(f=0;f<e.length;f++)l=m.slice(e[f]),h.unshift({next:l[1],run:l.length+1,pattern:l});e.push(m.length);m.push(b);if(b<c.crossings){c.crossings=
b;c.compaction=n;c.marked={};c.subnodes={};for(f=0;f<this.graph.layers.length;f++)for(e=this.graph.layers[f],l=0;l<e.nodes.length;l++){b=e.nodes[l];c.subnodes[b.id]=b.subnodes.slice(0);c.marked[b.id]={};for(var q in b.edges)c.marked[b.id][q]=b.edges[q].marked}d&&c.compaction.reverse()}d=!d;this.graph.layers.reverse();e=this.graph.layers[0];e.subnodes=[];for(f=0;f<e.L.length;f++)g=e.nodes[f],g.subnodes&&(e.subnodes=e.subnodes.concat(g.subnodes));a++}}while(!p&&30>=a);d&&this.graph.layers.reverse();
this.graph=c};NChart.prototype.minimize_crossings=function(a,b){if(b)var c="q",d="p",e="parents",f="children",g=a.prev,h=0;else c="p",d="q",e="children",f="parents",g=a.next,h=1;g.L=this.make_L(a,g,c,d,f);g.alt_L=this.make_alt_L(g,h);return[this.get_crossings(a,g.L,e,f),g]};
NChart.prototype.make_L=function(a,b,c,d,e){this.replace_p_nodes(a.alt_L,c);c=[];for(var f,g=0;g<a.alt_L.length;g+=2){var h=this.copy_segment_container(a.alt_L[g],b);f=g?f+1:0;h.measure=h.pos=f;f+=h.segs.length;0<h.segs.length&&c.push(h);g<a.alt_L.length-1&&(h=a.alt_L[g+1],h.pos=f)}f=[];for(g=0;g<b.nodes.length;g++)h=b.nodes[g],h[d]||f.push(h);d={};for(g=0;g<f.length;g++){var h=f[g],k=0,m=0,p=h[e];for(b=0;b<p.length;b++)var n=p[b],l=h.edges[n.id].weight,m=m+l*n.pos,k=k+l;h.measure=0<k?m/k:h.measure?
h.measure:0;goog.object.setIfUndefined(d,h.measure,[]);d[h.measure].push(h)}goog.object.forEach(d,function(b){if(1<b.length)for(var c=0;c<b.length;c++){for(var d=b[c],e=0,f=0;f<d.subnodes.length;f++)e+=goog.array.indexOf(a.subnodes,d.subnodes[f]);d.sub_measure=e/d.subnodes.length}});goog.array.stableSort(f,this.measure_sort);goog.array.stableSort(c,this.measure_sort);for(e=[];c.length&&f.length;)f[0].measure<=c[0].pos?e.push(f.shift()):(h=c.shift(),f[0].measure>=h.pos+h.segs.length-1?e.push(h):(g=
f.shift(),b=Math.ceil(g.measure-h.pos),d={pos:h.pos,segs:h.segs.splice(0,b)},d.segs.length&&e.push(d),e.push(g),h.segs.length&&(h.pos+=b,c.unshift(h))));return e=e.concat(f,c)};NChart.prototype.replace_p_nodes=function(a,b){for(var c=1;c<a.length;c+=2){var d=a[c];d[b]&&(a[c-1].segs=a[c-1].segs.concat(d.pq_seg,a.splice(c+1,1)[0].segs),a.splice(c,1),c-=2)}};NChart.prototype.copy_segment_container=function(a,b){for(var c={segs:[]},d=0;d<a.segs.length;d++)c.segs.push(b.segs[a.segs[d].id]);return c};
NChart.prototype.sort_gen=function(a){return function(b,c){return b[a]-c[a]}};NChart.prototype.measure_sort=function(a,b){return a.measure!=b.measure?a.measure-b.measure:a.sub_measure-b.sub_measure};NChart.prototype.lowest_sub_pos_sort=NChart.prototype.sort_gen("lowest_sub_pos");
NChart.prototype.make_alt_L=function(a,b){this.replace_q_nodes(a,b);for(var c=this.copy_L(a.L),d="node",e=0;e<c.length;e++){var f=c[e];"node"==d&&f.subnodes?(c.splice(e,0,{segs:[]}),d="segment"):"segment"==d&&f.segs?(c[e-1].segs=c[e-1].segs.concat(c.splice(e,1)[0].segs),e--,d="segment"):d="node"==d?"segment":"node"}"node"==d&&c.push({segs:[]});a.nodes=[];a.segments=[];for(e=0;e<c.length;e++)e%2?a.nodes.push(c[e]):a.segments.push(c[e]);return c};
NChart.prototype.copy_L=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d.segs?b.push({segs:d.segs.slice(0)}):b.push(d)}return b};NChart.prototype.replace_q_nodes=function(a,b){for(var c=a.L,d=0;d<c.length;d++){var e=c[d];if(e.segs)for(var f=0;f<e.segs.length;f++)if(e.segs[f].nodes[b].layer.num==a.num){var f=e.segs.splice(0,f),f={pos:e.pos,segs:f},g=e,h=g.segs.splice(0,1)[0].nodes[b],g=g.segs.length?0:1;f.segs.length?(c.splice(d,g,f,h),d+=2):(c.splice(d,g,h),d++);g&&d--;f=-1}}};
NChart.prototype.get_crossings=function(a,b,c,d){function e(a,b){return g[a]-g[b]}function f(a,b){return k[a.id]-k[b.id]}for(var g={},h=0;h<a.subnodes.length;h++)g[a.subnodes[h]]=h;a=a.L;for(var k={},m={},p=h=0;p<b.length;p++){var n=b[p];if(n.subnodes){if(n[d]&&n.draw){n.subnodes.sort(e);for(var l=0;l<n.subnodes.length;l++){var q=n.subnodes[l];g[q]&&(m[q]=h)}k[n.id]=h;h++}}else{for(var t=!1,l=0;l<n.segs.length;l++){var w=n.segs[l];w.draw&&(k[w.id]=h,t=!0);for(var r=0;r<w.subnodes.length;r++)q=w.subnodes[r],
w.draw&&(m[q]=h)}t&&h++}}b=[];d=[];q=[];for(p=t=0;p<a.length;p++)for(m=a[p],w=m.segs?m.segs:[m],l=0;l<w.length;l++){var n=w[l],u=!1,v=n[c];1<v.length&&(goog.array.stableSort(v,f),u=!0);for(var x=0,m={},r=0;r<v.length;r++){var z=n.edges[v[r].id];b.push(z);d.push(k[z.target.id]);q.push(z.weight);if(u){for(var y=0;y<z.subnodes.length;y++)m[z.subnodes[y]]=x;x++}}if(u){u=[];for(r=0;r<n.subnodes.length;r++)u.push(m[n.subnodes[r]]);t+=this.count_sub_crossings(x,u)}}return t+=this.count_crossings(h,b,d,q)};
NChart.prototype.count_crossings=function(a,b,c,d){a=next2power(a);var e=2*a-1;a--;for(var f=[],g=[],h=0;h<e;h++)f[h]=0,g[h]=0;for(h=e=0;h<c.length;h++){var k=c[h]+a,m=b[h];f[k]+=d[h];m.is_seg&&(g[k]+=1);for(var p=0,n=0;0<k;)k%2&&(p+=f[k+1],n+=g[k+1]),k=Math.floor((k-1)/2),f[k]+=d[h],m.is_seg&&(g[k]+=1);e+=d[h]*p;0<n?(m.marked=!0,m.target.edges[m.source.id].marked=!0):(m.marked=!1,m.target.edges[m.source.id].marked=!1);if(m.is_seg)for(k=c[h],m=0;m<h;m++)k<c[m]&&(p=b[m],p.marked=!0,p.target.edges[p.source.id].marked=
!0)}return e};NChart.prototype.count_sub_crossings=function(a,b){var c=next2power(a),d=2*c-1;c--;for(var e=[],f=0;f<d;f++)e[f]=0;for(f=d=0;f<b.length;f++){var g=b[f]+c;for(e[g]++;0<g;)g%2&&(d+=e[g+1]),g=Math.floor((g-1)/2),e[g]++}return d};
NChart.prototype.expand_compaction=function(){this.graph.e_compaction=[];for(var a=0;a<this.graph.compaction.length;a++){for(var b=this.graph.compaction[a].slice(0),c=0;c<b.length;c++){var d=b[c];if(d.segs){d=d.segs.slice(0);for(b.splice(c,1);d.length;){var e=d.shift();e.draw&&(b.splice(c,0,e),c++)}c--}else d.draw||(b.splice(c,1),d.children[0].parents=[],c--)}this.graph.layers[a].L=b;this.graph.e_compaction.push(b)}};
NChart.prototype.neighborify=function(){for(var a=[],b=this.sort_gen("pos"),c=0;c<this.graph.e_compaction.length;c++){for(var d=this.graph.e_compaction[c],e=a,a=[],f=0;f<d.length;f++){var g=d[f];g.pos=f;g.r_pos=d.length-f-1;0<f&&(g.pred=d[f-1]);f<d.length-1&&(g.succ=d[f+1]);goog.array.stableSort(g.parents,b);a.push(g.children)}for(f=0;f<e.length;f++)goog.array.stableSort(e[f],b)}};
NChart.prototype.group_initial_nodes=function(){for(var a=[],b=[],c=0;c<this.graph.e_compaction.length;c++)for(var d=this.graph.e_compaction[c],e=0;e<d.length;e++){for(var f=d[e],g=f.children[0],h=0;h<b.length;h++)if(b[h].node.layer.num<f.layer.num)for(var k=b[h].groups,m=0;m<k.length;m++){var p=k[m];if(1!=p.length){var n=intersect(p,f.subnodes);if(n.length&&n.length!=p.length){for(var l=0;l<n.length;l++)p.splice(goog.array.indexOf(p,n[l]),1);k.splice(m,0,n);m++}}}if(0==f.parents.length&&1==f.children.length&&
1<g.parents.length&&!goog.array.contains(a,g.id)){k=[];for(h=0;h<g.parents.length;h++)k=k.concat(intersect(g.subnodes,g.parents[h].subnodes));b.push({node:g,groups:[k]});a.push(g.id)}}for(c=0;c<b.length;c++){a=b[c];f=goog.array.flatten(a.groups);for(e=0;e<a.node.parents.length;e++)for(d=a.node.parents[e],d.lowest_sub_pos=Infinity,h=0;h<d.subnodes.length;h++)d.lowest_sub_pos=Math.min(d.lowest_sub_pos,goog.array.indexOf(f,d.subnodes[h]));goog.array.stableSort(a.node.parents,this.lowest_sub_pos_sort);
h=a.node.parents[0].layer.L;k=-1;f=[];for(e=0;e<a.node.parents.length;e++)if(d=a.node.parents[e],d.parents.length){for(0>k&&(k=goog.array.indexOf(h,d));f.length;)h.splice(k,0,f.pop()),k++;k++}else g=goog.array.indexOf(h,d),d=h.splice(g,1)[0],0<=k?h.splice(g<k?k-1:k,0,d):f.push(d);if(f.length){d=a.node.layer.L;e=goog.array.indexOf(d,a.node);if(e<d.length-1)g=goog.array.indexOf(h,d[e+1].parents[0]);else if(0<e){do e--,a=d[e].parents,g=goog.array.indexOf(h,a[a.length-1])+1;while(e&&!a.length);g||(g=
0)}else g=h.length;for(;f.length;)h.splice(g,0,f.pop())}}};
NChart.prototype.group_subnodes=function(){for(var a=[],b=[],c=0;c<this.graph.e_compaction.length;c++)for(var d=this.graph.e_compaction[c],e=0;e<d.length;e++){for(var f=d[e],g=0;g<b.length;g++)for(var h=b[g].groups,k=0;k<h.length;k++){var m=h[k];if(1!=m.length){var p=intersect(m,f.subnodes);if(p.length&&p.length!=m.length){for(var n=0;n<p.length;n++)m.splice(goog.array.indexOf(m,p[n]),1);h.splice(k,0,p);k++}}}h=[];for(g=0;g<f.subnodes.length;g++)k=f.subnodes[g],goog.array.contains(a,k)||h.push(k);
h.length&&(b.push({node:f,groups:[f.subnodes.slice(0)]}),a=a.concat(h))}for(c=0;c<b.length;c++)b[c].node.initial_ordering=b[c].groups,b[c].node.subnodes=goog.array.flatten(b[c].groups)};
NChart.prototype.sort_subnodes=function(){this.group_subnodes();for(var a={},b=0;b<this.graph.layers.length;b++)for(var c=function(a,b){return f.subnode_pos[a][0]!=f.subnode_pos[b][0]?f.subnode_pos[b][0]-f.subnode_pos[a][0]:f.subnode_pos[b][1]-f.subnode_pos[a][1]},d=this.graph.layers[b].L,e=0;e<d.length;e++){var f=d[e];f.subnode_pos={};if(!f.nodes){for(var g=[],h=0;h<f.subnodes.length;h++){var k=f.subnodes[h];a[k]?f.subnode_pos[k]=a[k]:(f.subnode_pos[k]=[e,h,0],g.push(k))}if(g.length&&g.length!=f.subnodes.length)for(h=
0;h<f.initial_ordering.length;h++){var k=f.initial_ordering[h],m=intersect(k,g);if(m.length&&m.length<k.length){k=goog.array.filter(k,function(a){return!goog.array.contains(m,a)});goog.array.stableSort(k,c);for(var k=f.subnode_pos[k[0]],p=0;p<m.length;p++){var n=m[p];f.subnode_pos[n]=k.slice(0);f.subnode_pos[n][2]=p+1}}}goog.array.stableSort(f.subnodes,function(a,b){return f.subnode_pos[a][0]!=f.subnode_pos[b][0]?f.subnode_pos[a][0]-f.subnode_pos[b][0]:f.subnode_pos[a][1]!=f.subnode_pos[b][1]?f.subnode_pos[a][1]-
f.subnode_pos[b][1]:f.subnode_pos[a][2]-f.subnode_pos[b][2]});f.subnode_order={};for(h=0;h<f.subnodes.length;h++)k=f.subnodes[h],f.subnode_order[k]=h,a[k]=[e,h,0];for(var l in f.edges)f.edges[l].marked=this.graph.marked[f.id][l]}}};NChart.prototype.post_process=function(){this.expand_compaction();this.neighborify();this.sort_subnodes()};NChart.Plotter=function(a){this.nchart=a};
NChart.Plotter.prototype.align_horizontally=function(a,b){for(var c=a?"children":"parents",d=0;d<this.nchart.graph.e_compaction.length;d++){var e=this.nchart.graph.e_compaction[d];b&&e.reverse();for(var f=-1,g=0;g<e.length;g++){var h=e[g],k=h[c];if(k.length){b&&k.reverse();for(var m=[],p=0;p<k.length;p++)for(var n=k[p],l=h.edges[n.id],q=0;q<l.weight;q++)m.push(n);p=(m.length+1)/2-1;for(n=Math.floor(p);n<=Math.ceil(p);n++)h.align==h&&(q=m[n],l=h.edges[q.id],l&&l.marked||!(f<q[this.dir.pos])||(q.align=
h,h.root=q.root,h.align=h.root,f=q[this.dir.pos]));b&&k.reverse()}}b&&e.reverse()}};NChart.Plotter.prototype.place_block=function(a,b,c){if(null==a.y){a.y=0;var d=a;do{if(0<d[this.dir.pos]){var e=d[this.dir.pred].root;this.place_block(e,b,c);a.sink==a&&(a.sink=e.sink);if(a.sink!=e.sink)this.shift_all(e,a,d,b,c);else{var f=this.get_delta(e,a,d,b,c);a.y=this.dir.set_func(a.y,e.y+f)}}d=d.align}while(d!=a)}};
NChart.Plotter.prototype.get_delta=function(a,b,c,d,e){if(!e&&b[d?"q":"p"]){var f=a,g=0;do{if(d&&f.layer.num<=b.layer.num&&f.layer.num>=c.layer.num||!d&&f.layer.num>=b.layer.num&&f.layer.num<=c.layer.num)g=Math.max(g,f.size);f=f.align}while(f!=a)}else g=c[this.dir.pred].size;return e?this.nchart.subnode_spacing*-c.size-this.nchart.node_spacing:this.nchart.subnode_spacing*g+this.nchart.node_spacing};
NChart.Plotter.prototype.shift_all=function(a,b,c,d,e){this.shift(a,b,c,d,e);var f=this;goog.object.forEach(this.shifted,function(b,c){a.id!=c&&goog.object.forEach(b,function(a){f.shift(a[0],a[1],a[2],d,e)})});goog.object.setIfUndefined(this.shifted,a.id,{});goog.object.setIfUndefined(this.shifted[a.id],b.id,[a,b,c])};
NChart.Plotter.prototype.shift=function(a,b,c,d,e){c=this.get_delta(a,b,c,d,e);d=0;if(e&&-Infinity<b.sink.shift||!e&&Infinity>b.sink.shift)d=b.sink.shift;a.sink.shift=this.dir.shift_func(a.sink.shift,b.y-a.y-c+d)};
NChart.Plotter.prototype.compact_vertically=function(a,b){this.shifted={};for(var c=0;c<this.nchart.graph.e_compaction.length;c++)for(var d=this.nchart.graph.e_compaction[c],e=0;e<d.length;e++){var f=d[e];f.root==f&&this.place_block(f,a,b)}for(var g=[],h=Infinity,k=-Infinity,c=0;c<this.nchart.graph.e_compaction.length;c++){d=this.nchart.graph.e_compaction[c];b&&d.reverse();for(var m=[],e=0;e<d.length;e++){f=d[e];f.y=f.root.y;if(!b&&Infinity>f.sink.shift||b&&-Infinity<f.sink.shift)f.y+=f.sink.shift;
m.push(f.y);h=Math.min(h,f.y);k=Math.max(k,f.y)}b&&(d.reverse(),m.reverse());g.push(m)}c=k-h;a&&g.reverse();return{y_coords:g,width:c,max_coord:k,min_coord:h}};
NChart.Plotter.prototype.place_nodes=function(){this.alignments=[];var a=[],b=[],c=[0,1],d=[0,1];this.nchart.debug&&this.nchart.debug.direction&&(1==this.nchart.debug.direction?(c=[0],d=[0]):2==this.nchart.debug.direction?(c=[1],d=[0]):3==this.nchart.debug.direction?(c=[0],d=[1]):4==this.nchart.debug.direction&&(c=[1],d=[1]));var e=this;goog.array.forEach(c,function(c){e.right_reverse(c);goog.array.forEach(d,function(d){e.initialize(d);e.align_horizontally(c,d);var h=e.compact_vertically(c,d);e.alignments.push(h);
d?b.push(h):a.push(h)});e.right_reverse(c)});this.normalize_alignments(a,b);this.place_y();this.place_x()};NChart.Plotter.prototype.right_reverse=function(a){a&&(this.nchart.graph.compaction.reverse(),this.nchart.graph.e_compaction.reverse(),this.nchart.graph.layers.reverse())};
NChart.Plotter.prototype.normalize_alignments=function(a,b){for(var c={width:Infinity},d=0;d<this.alignments.length;d++){var e=this.alignments[d];e.width<c.width&&(c=e)}for(var f=[a,b],g=0;g<f.length;g++)for(var h=g?"max_coord":"min_coord",d=0;d<f[g].length;d++){var e=f[g][d],k=e[h]-c[h];if(0!=k)for(var m=0;m<e.y_coords.length;m++)for(var p=e.y_coords[m],n=0;n<p.length;n++)p[n]-=k}};
NChart.Plotter.prototype.place_y=function(){for(var a=Infinity,b=-Infinity,c=0;c<this.nchart.graph.e_compaction.length;c++)for(var d=this.nchart.graph.e_compaction[c],e=0;e<d.length;e++){var f=d[e];if(!this.nchart.debug||!this.nchart.debug.direction){var g=[this.alignments[0].y_coords[c][e],this.alignments[1].y_coords[c][e],this.alignments[2].y_coords[c][e],this.alignments[3].y_coords[c][e]];g.sort(function(a,b){return a-b});f.y=Math.round((g[1]+g[2])/2)}a=Math.min(f.y,a);b=Math.max(f.y+(f.size-1)*
this.nchart.subnode_spacing,b)}if(a!=this.nchart.initial_padding.top)for(a=this.nchart.initial_padding.top-a,b+=a,c=0;c<this.nchart.graph.e_compaction.length;c++)for(d=this.nchart.graph.e_compaction[c],e=0;e<d.length;e++)d[e].y+=a;this.nchart.graph.max_y=b};
NChart.Plotter.prototype.place_x=function(){for(var a=0,b=0;b<this.nchart.graph.e_compaction.length;b++){for(var c=this.nchart.graph.e_compaction[b],d=0,e=Infinity,f=0;f<c.length;f++){var g=c[f];g.x=a;for(var h=0;h<g.children.length;h++){var k=g.children[h];if(g.y!=k.y){var m=this.nchart.slope_func(g.edges[k.id]),k=Math.abs(g.y-k.y)+g.layer.duration*m;k>d&&(d=k);m<e&&(e=m)}}}a+=Math.floor(Math.max(d/e,100))}this.nchart.graph.max_x=this.nchart.graph.e_compaction[this.nchart.graph.e_compaction.length-
1][0].x};NChart.Plotter.prototype.initialize=function(a){this.dir={};a?(this.dir.pos="r_pos",this.dir.pred="succ",this.dir.shift_func=Math.max,this.dir.set_func=Math.min):(this.dir.pos="pos",this.dir.pred="pred",this.dir.shift_func=Math.min,this.dir.set_func=Math.max);for(var b=0;b<this.nchart.graph.e_compaction.length;b++)for(var c=this.nchart.graph.e_compaction[b],d=0;d<c.length;d++){var e=c[d];e.root=e;e.align=e;e.sink=e;e.shift=a?-Infinity:Infinity;e.size=e.subnodes.length;e.y=null}};
function draw_straight(a,b){for(var c=a.group("graph"),d=a.group(c,"pov",{"stroke-width":2}),e=a.group(c,"non_pov",{"stroke-width":1}),f={fill:"black"},g={stroke:"black",fill:"white"},h=0;h<graph.char_nodes.length;h++){for(var k=graph.char_nodes[h],m=["M"],p=["M"],n=[],l=["z"],q=k.character.short_name,t=[],w=[],r=!1,u=0;u<k.nodes.length;u++){var v=k.nodes[u];u&&(r?(m.push("M"),p.push("M"),n.push("L")):(m.push("L"),p.push("L")));var x=v.y+v.subnode_order[q]*this.nchart.subnode_spacing,z=x-4,y=x+4;
m.push(v.x+" "+x);p.push(v.x+" "+z);r&&n.push(v.x+" "+x);v.duration&&(r?n.push("h"+v.duration):m.push("h"+v.duration),p.push("h"+v.duration),l.push("h-"+v.duration));z=v.x+v.duration;u<k.nodes.length-1&&l.push("L"+z+" "+y);v.deaths&&goog.array.contains(v.deaths,q)&&(t.push([z,x,5]),r||(n.push("M"+z+" "+x),r=!0));v.undeaths&&goog.array.contains(v.undeaths,q)&&(w.push([z,x,5]),r=!1)}u=k.character.pov?d:e;p.push("v8");l.reverse();r=a.group(u,q+"_group",{"stroke-width":"inherit"});a.path(r,p.concat(l).join(""),
{id:q+"_box","class":"box",fill:"none"});a.path(r,m.join(""),{id:q,stroke:k.character.color,"stroke-width":"inherit","stroke-linecap":"round","stroke-linejoin":"round",fill:"none"});1<n.length&&a.path(r,n.join(""),{id:q+"_dead",stroke:k.character.color,"stroke-width":"inherit","stroke-linecap":"round","stroke-linejoin":"round","stroke-dasharray":"10",fill:"none"});for(u=0;u<t.length;u++)k=t[u],a.circle(r,k[0],k[1],k[2],f);for(u=0;u<w.length;u++)t=w[u],a.circle(r,t[0],t[1],t[2],g)}a.change(c,{transform:"scale("+
b+")"});$(c).mouseover(function(b){if("box"==b.target.className.baseVal){var c=b.target.parentNode.parentNode.getAttribute("stroke-width"),d=1<scale?4/scale:4;a.change(b.target.nextElementSibling,{"stroke-width":c});$(b.target.nextElementSibling).animate({svgStrokeWidth:d},200)}});$(c).mouseout(function(b){if("box"==b.target.className.baseVal){var c=b.target.parentNode.parentNode.getAttribute("stroke-width");$(b.target.nextElementSibling).animate({svgStrokeWidth:c},200);a.change(b.target.nextElementSibling,
{"stroke-width":"inherit"})}})}NChart.SvgDrawer=function(a){this.nchart=a};
NChart.SvgDrawer.prototype.draw_curvy=function(){var a=this,b=this.svg.getElementById("path_defs"),c=this.svg.getElementById("graph"),d={p:{}};goog.object.forEach(this.nchart.path_styles,function(a,b){d[b]={}});var e={};goog.object.forEach(this.nchart.group_styles,function(b,d){e[d]=a.svg.group(c,d,b)});for(var f=0;f<this.nchart.graph.char_nodes.length;f++){var g=this.nchart.graph.char_nodes[f],h=g.character.short_name,k=g.nodes[0].x,m=g.nodes[0].y+g.nodes[0].subnode_order[h]*this.nchart.subnode_spacing,
p={},n={},l={};goog.object.forEach(this.nchart.states,function(a,b){n[b]=[];a.following_style&&(p[a.following_style]=!(!g.nodes[0][a.following_style]||!goog.array.contains(g.nodes[0][a.following_style],h)),l[a.following_style]=[])});goog.object.contains(p,!0)||(p["default"]=!0);for(var q=["M"+k+","+m],t=!1,w=!1,r=0;r<g.nodes.length;r++){var u=g.nodes[r],v=u.y+u.subnode_order[h]*this.nchart.subnode_spacing,x=u.x+u.duration,z=[],y=goog.object.getKeys(goog.object.filter(p,function(a){return a})),D=goog.object.clone(p);
delete D["default"];if(goog.array.filter(y,function(b){return!!a.nchart.path_styles[b]}).length){if(r){var A=q[q.length-1],w=t;(t=m==v)?(z=["H",x],w?(A.x_range[1]=x,A.d[1]=x):q.push({x_range:[k,x],y_range:[v,v],type:"H",d:z})):(w=this.nchart.bendiness(k,m,u.x,v),z=["C",k+w,m,u.x-w,v,u.x,v],q.push({x_range:[k,u.x],y_range:[m,v],type:"C",d:z,bezier:new goog.math.Bezier(k,m,k+w,m,u.x-w,v,u.x,v)}),w=!1);goog.array.forEach(y,function(a){a=l[a];var b=a[a.length-1],c="H"==b[0];"H"==z[0]&&c?b[1]=x:a.push(z)})}else goog.array.forEach(y,
function(a){l[a].push(["M",k,m])});u.duration&&!t&&(goog.array.forEach(y,function(a){l[a].push(["H",x])}),q.push({x_range:[u.x,x],y_range:[v,v],type:"H",d:["H",x]}),t=!0)}goog.object.forEach(this.nchart.states,function(a,b){var c=a.noun,d=a.icon,e=a.following_style,f=a.reverses;c&&u[c]&&goog.array.contains(u[c],h)&&(d&&("start"==d.placement?n[b].push([d,k,m]):n[b].push([d,x,v])),e&&!p[e]&&(l[e].push(["M",x,v]),p[e]=!0,D[e]=!0),f&&p[f]&&(p[f]=!1,"default"!=f&&(D[f]=!1),p["default"]||goog.object.some(D,
function(a){return a})||(p["default"]=!0,l["default"].push(["M",x,v]))))});k=x;m=v}r=e[g.character.group]||e.default_group;d.p[h]?(d.p[h]++,t=h+"_"+d.p[h]):(t=h,d.p[h]=1);for(var C=this.svg.group(r,t+"_group",{"stroke-width":"inherit"}),w=this.svg.path(b,q.shift(),{id:t,"class":"character",fill:"none"}),r=y=0;r<q.length;r++){var A=q[r],B=$(w).attr("d")||"";this.svg.change(w,{d:[B,[A.d[0],A.d.slice(1).join(",")].join("")].join(" ")});"C"==A.type?(B=w.getTotalLength(),A.len_range=[y,B],y=B):"H"==A.type&&
(B=y+A.x_range[1]-A.x_range[0],A.len_range=[y,B],y=B)}r=$(w);r.data("use_segments",q);r.data("length",y);var F=[];r.data("skip_points",F);this.svg.use(C,"#"+t,{stroke:"white","stroke-width":8,"stroke-linecap":"round","stroke-linejoin":"round","class":"background"});goog.object.forEach(l,function(b,c){var e;d[c][h]?(d[c][h]++,e=h+"_"+c+"_"+d[c][h]):(e=h+"_"+c,d[c][h]=1);if(1<b.length&&a.nchart.path_styles[c]){var f=goog.array.map(b,function(a){return[a[0],a.slice(1).join(",")].join("")});e={id:e,stroke:g.character.color};
goog.object.extend(e,a.nchart.path_styles[c]);a.svg.path(C,f.join(" "),e)}});var E=0;goog.object.forEach(n,function(b,c){for(var d=0;d<b.length;d++){var e=b[d];q[0].x_range[0]==e[1]&&(E=Math.max(E,e[0].skip_radius));goog.object.forEach(e[0],function(b,c){if("skip_radius"!=c&&"placement"!=c){var d=goog.object.clone(b),f;"circle"==c?(goog.object.extend(d,{cx:e[1],cy:e[2]}),f=[C,null,null,null,d]):"path"==c&&(d.d=["M"+e[1]+","+e[2],d.d].join(" "),f=[C,"",d]);a.svg[c].apply(a.svg,f)}});F.push([e[1],e[2],
e[0].skip_radius||0])}});r.data("min_offset",E);y=this.svg.text(C,null,null,"",this.nchart.name_style);r.data("name_path",this.svg.textpath(y,"#"+t,g.character.name,{startOffset:E}));r.data("name_len",y.getComputedTextLength())}};
NChart.SvgDrawer.prototype.figure_scale=function(){if(this.nchart.start_scale)this.start_scale=this.nchart.start_scale;else{var a=this.nchart.paper.width()-this.nchart.initial_padding.left-this.nchart.initial_padding.right,b=this.nchart.paper.height()-this.nchart.initial_padding.top-this.nchart.initial_padding.bottom,c=a/this.nchart.graph.max_x,d=b/this.nchart.graph.max_y;c<d?(this.start_scale=c,this.start_x=this.nchart.initial_padding.left,this.start_y=b/2-c*this.nchart.graph.max_y/2+this.nchart.initial_padding.top):
(this.start_scale=d,this.start_x=a/2-d*this.nchart.graph.max_x/2,+this.nchart.initial_padding.left,this.start_y=this.nchart.initial_padding.top);this.translate={x:this.start_x,y:this.start_y}}};
NChart.SvgDrawer.prototype.wireframe=function(){for(var a=this.svg.getElementById("graph"),b=0;b<this.nchart.graph.layers.length;b++)for(var c=this.nchart.graph.layers[b],d=0;d<c.nodes.length;d++){var e=c.nodes[d];if(e.draw)for(var f=0;f<e.children.length;f++){var g=e.children[f];g.nodes&&(g=g.nodes[1]);this.svg.path(a,["M",e.x,e.y,"L",g.x,g.y].join(" "),{stroke:"black","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round",fill:"none"})}}};
NChart.SvgDrawer.prototype.debug_nodes=function(){for(var a=this.svg.getElementById("graph"),b,c=0;c<this.nchart.graph.layers.length;c++)for(var d=this.nchart.graph.layers[c],e=0;e<d.nodes.length;e++){var f=d.nodes[e];f.draw&&(b=f.p?"blue":f.q?"green":f.r?"yellow":"red",this.svg.circle(a,f.x,f.y,15,{fill:b,id:"node_"+f.id,"class":"debug_node class_"+f.root.sink.id+" block_"+f.root.id}))}};
NChart.SvgDrawer.prototype.debug_blocks=function(){for(var a=this.svg.getElementById("graph"),b=0;b<this.nchart.graph.layers.length;b++)for(var c=this.nchart.graph.layers[b],d=0;d<c.L.length;d++){var e=c.L[d];if(e.root==e){var f=e;do f=f.align;while(f.align!=e);if(0==this.nchart.debug.direction%2)var g=e,e=f,f=g;f=this.svg.rect(a,e.x-17,e.y-17,f.x-e.x+34,34,8,8,{fill:"blue",opacity:".25",id:"block_"+e.root.id,"class":"debug_block class_"+e.root.sink.id});$(f).data("root","node_"+e.root.id)}}var h=
this;$(".debug_block").mouseenter(function(a){h.svg.change(this,{fill:"yellow"});goog.array.contains(h.nchart.debug.features,"nodes")&&(a=h.svg.getElementById($(this).data("root")),h.svg.change(a,{r:40,stroke:"black","stroke-width":7}))}).mouseleave(function(a){h.svg.change(this,{fill:"blue"});goog.array.contains(h.nchart.debug.features,"nodes")&&(a=h.svg.getElementById($(this).data("root")),h.svg.change(a,{r:15,stroke:"none"}))})};
NChart.SvgDrawer.prototype.debug_classes=function(){for(var a=this.svg.getElementById("graph"),b={},c=0;c<this.nchart.graph.layers.length;c++)for(var d=this.nchart.graph.layers[c],e=0;e<d.L.length;e++){var f=d.L[e];goog.object.setIfUndefined(b,f.root.sink.id,{});goog.object.setIfUndefined(b[f.root.sink.id],c,[]);b[f.root.sink.id][c][0]||(b[f.root.sink.id][c][0]=f);if(!b[f.root.sink.id][c][1]||b[f.root.sink.id][c][1].y<f.y)b[f.root.sink.id][c][1]=f}var g=this;goog.object.forEach(b,function(b,c){var d=
[],e=[],f;goog.object.forEach(b,function(a){var b=a[0].x-22,c=a[0].y-22,g=a[1].y+22;if(d[d.length-1]){var h=d[d.length-1][0],k=d[d.length-1][1];k<c?(d.push([h+44,k]),d.push([h+44,c])):d.push([b,k])}d.push([b,c]);e[e.length-1]&&(h=e[e.length-1][0],c=e[e.length-1][1],c>g?(e.push([h+44,c]),e.push([h+44,g])):e.push([b,c]));e.push([b,g]);f=a});var l=f[0].x+22;d.push([l,f[0].y-22]);e.push([l,f[1].y+22]);e.reverse();var l=d.concat(e),q=g.svg.polygon(a,l,{fill:"green",opacity:".15",id:"class_"+c,"class":"debug_class"});
$(q).data("sink","node_"+c);g.svg.polygon(a,l,{stroke:"black","stroke-width":2,fill:"none"})});$(".debug_class").mouseenter(function(a){g.svg.change(this,{fill:"yellow"});goog.array.contains(g.nchart.debug.features,"nodes")&&(a=g.svg.getElementById($(this).data("sink")),g.svg.change(a,{r:40,stroke:"black","stroke-width":7}))}).mouseleave(function(a){g.svg.change(this,{fill:"green"});goog.array.contains(g.nchart.debug.features,"nodes")&&(a=g.svg.getElementById($(this).data("sink")),g.svg.change(a,
{r:15,stroke:"none"}))})};
NChart.SvgDrawer.prototype.draw_graph=function(){this.figure_scale();this.nchart.paper.children().remove();this.scale=this.start_scale;var a=this;this.nchart.paper.svg({onLoad:function(b){a.svg=b;b.defs("path_defs");var c=b.group("graph");a.svg.change(c,{transform:"translate("+a.start_x+","+a.start_y+"), scale("+a.start_scale+")"});a.nchart.debug&&a.nchart.debug.wireframe?a.wireframe():a.draw_curvy();a.nchart.debug&&(c=b.defs("debug_defs"),c=b.filter(c,"inner_glow"),b.filters.gaussianBlur(c,"blur",
null,6),b.filters.composite(c,"composite_blur","arithmetic","blur","SourceGraphic",0,-1,1),goog.array.forEach(a.nchart.debug.features,function(b){if(a["debug_"+b])a["debug_"+b]();else alert('Debug option "'+b+'" not supported')}))},settings:{width:this.nchart.paper.width(),height:this.nchart.paper.height()}});this.attach_events()};
NChart.SvgDrawer.prototype.point_and_length_at_x=function(a,b){var c=this.nchart.length_tolerance,d=(a.x_range[0]+a.x_range[1])/2,e,f;if(b<d-c)e=0,f=.5;else if(b>d+c)e=.5,f=1;else return{point:{x:d,y:(a.y_range[0]+a.y_range[1])/2},length:(a.len_range[0]+a.len_range[1])/2};for(;;){var d=(e+f)/2,g=a.bezier.getPoint(d);if(b<g.x-c)f=d;else if(b>g.x+c)e=d;else return{point:g,length:a.bezier.lengthAtPoint(d)+a.len_range[0]}}};
NChart.SvgDrawer.prototype.point_and_length_at_y=function(a,b){var c=this.nchart.length_tolerance,d=(a.y_range[0]+a.y_range[1])/2,e,f;if(b<d-c)e=0,f=.5;else if(b>d+c)e=.5,f=1;else return{point:{x:(a.x_range[0]+a.x_range[1])/2,y:d},length:(a.len_range[0]+a.len_range[1])/2};for(;;){var d=(e+f)/2,g=a.bezier.getPoint(d);if(b<g.y-c)f=d;else if(b>g.y+c)e=d;else return{point:g,length:a.bezier.lengthAtPoint(d)+a.len_range[0]}}};
NChart.SvgDrawer.prototype.point_and_length_at_y_neg=function(a,b){var c=this.nchart.length_tolerance,d=(a.y_range[0]+a.y_range[1])/2,e,f;if(b>d+c)e=0,f=.5;else if(b<d-c)e=.5,f=1;else return{point:{x:(a.x_range[0]+a.x_range[1])/2,y:d},length:(a.len_range[0]+a.len_range[1])/2};for(;;){var d=(e+f)/2,g=a.bezier.getPoint(d);if(b>g.y+c)f=d;else if(b<g.y-c)e=d;else return{point:g,length:a.bezier.lengthAtPoint(d)+a.len_range[0]}}};
NChart.SvgDrawer.prototype.adjust_graph=function(){var a=this.svg.getElementById("graph");this.svg.change(a,{transform:"translate("+this.translate.x+","+this.translate.y+"), scale("+this.scale+")"});var a=-this.translate.x/this.scale,b=a+this.nchart.paper.width()/this.scale,c=-this.translate.y/this.scale,d=c+this.nchart.paper.height()/this.scale;$("path.character").each(this.move_name(a,b,c,d))};
NChart.SvgDrawer.prototype.attach_events=function(){var a,b,c=this;this.nchart.paper.mousewheel(this.zoom_graph());this.nchart.paper.dblclick(function(a){var b;1==a.which?b=2:3==a.which&&(b=-2);b&&c.zoom_graph()(a,b)});this.nchart.paper.mousedown(function(d){a=d.pageX;b=d.pageY;original_translate={};goog.object.extend(original_translate,c.translate);c.nchart.paper.mousemove(function(d){c.translate={x:original_translate.x+d.pageX-a,y:original_translate.y+d.pageY-b};c.adjust_graph()})});this.nchart.paper.mouseup(function(a){c.nchart.paper.unbind("mousemove")})};
NChart.SvgDrawer.prototype.zoom_graph=function(){var a=this.nchart.paper.offset(),b=this;return function(c,d){var e=b.scale,f={};goog.object.forEach(b.nchart.group_styles,function(a,c){f[c]=b.svg.getElementById(c)});b.scale=goog.math.clamp(b.scale*Math.pow(1.2,d/Math.abs(d)),b.nchart.min_scale,b.nchart.max_scale);if(b.scale!=e){var e=b.scale/e,g=c.pageX-a.left,h=c.pageY-a.top;b.translate={x:g+e*(b.translate.x-g),y:h+e*(b.translate.y-h)};1<b.scale&&goog.object.forEach(b.nchart.group_styles,function(a,
c){b.svg.change(f[c],{"stroke-width":a["stroke-width"]/b.scale})});b.adjust_graph()}return!1}};
NChart.SvgDrawer.prototype.move_name=function(a,b,c,d){var e=this;a+=this.nchart.name_padding.left;c+=this.nchart.name_padding.top;d-=this.nchart.name_padding.bottom;return function(){var f=$(this),g=f.data("use_segments"),h=g.length-1;if(!(a>g[h].x_range[1])){var k=f.data("length"),m=f.data("name_len"),p=f.data("skip_points"),n=f.data("min_offset"),k=k-m,l,q,t,w=!1;a<g[0].x_range[0]?(l=g[0],t=0,w=!0):a<=g[h].x_range[1]&&(t=goog.array.binarySearch(g,a,e.segment_search),l=g[t]);var r,u;"H"==l.type?
(r=l.y_range[0],u={point:{x:a,y:r},length:l.len_range[0]+a-l.x_range[0]}):"C"==l.type&&(u=e.point_and_length_at_x(l,a),r=u.point.y);if(r>=c&&r<=d)q=w?n:Math.min(u.length,k);else for(;!q&&l&&l.x_range[0]<b;){if("C"==l.type){var v;r<c&&l.y_range[1]>=c?v=e.point_and_length_at_y(l,c):r>d&&l.y_range[1]<=d&&(v=e.point_and_length_at_y_neg(l,d));v&&(q=Math.min(v.length,k))}t++;l=g[t]}if(q&&q!=n){n=l.len_range[1];h=[l];t++;for(l=g[t];l&&n<q+m;)h.push(l),n=l.len_range[1],t++,l=g[t];for(g=0;g<p.length;g++)for(l=
p[g],t=l[2],n=0;n<h.length;n++)r=h[n],r.x_range[0]==l[0]?q<r.len_range[0]+t&&(q=r.len_range[0]+t):r.x_range[1]==l[0]&&q+m>r.len_range[1]-t&&(q=r.len_range[1]-m-t)}e.svg.change(f.data("name_path"),{startOffset:q})}}};NChart.SvgDrawer.prototype.segment_search=function(a,b){return a>b.x_range[1]?1:a<b.x_range[0]?-1:0};
function bezier_prototype_length_and_lengthAtPoint(){goog.math.Bezier.prototype.length=function(){for(var a={x:0,y:0},b=0,c=0;1.01>c;c+=.1){var d=this.getPoint(c);c&&(b+=Math.sqrt(Math.pow(a.x-d.x,2)+Math.pow(a.y-d.y,2)));a=d}return b};goog.math.Bezier.prototype.lengthAtPoint=function(a){var b=this.clone();b.subdivideLeft(a);return b.length()}}function intersect(a,b){if(a.length<=b.length)var c=a,d=b;else c=b,d=a;return goog.array.filter(c,function(a){return goog.array.contains(d,a)})}
function next2power(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;return(a|a>>16)+1}window.NChart=NChart;
