;(function(){var _findWithFunction=jsPlumbUtil.findWithFunction,_indexOf=jsPlumbUtil.indexOf,_removeWithFunction=jsPlumbUtil.removeWithFunction,_remove=jsPlumbUtil.remove,_addWithFunction=jsPlumbUtil.addWithFunction,_addToList=jsPlumbUtil.addToList,_isArray=jsPlumbUtil.isArray,_isString=jsPlumbUtil.isString,_isObject=jsPlumbUtil.isObject;var _connectionBeingDragged=null,_getAttribute=function(el,attName){return jsPlumb.CurrentLibrary.getAttribute(_getElementObject(el),attName);},_setAttribute=function(el,attName,attValue){jsPlumb.CurrentLibrary.setAttribute(_getElementObject(el),attName,attValue);},_addClass=function(el,clazz){jsPlumb.CurrentLibrary.addClass(_getElementObject(el),clazz);},_hasClass=function(el,clazz){return jsPlumb.CurrentLibrary.hasClass(_getElementObject(el),clazz);},_removeClass=function(el,clazz){jsPlumb.CurrentLibrary.removeClass(_getElementObject(el),clazz);},_getElementObject=function(el){return jsPlumb.CurrentLibrary.getElementObject(el);},_getOffset=function(el){return jsPlumb.CurrentLibrary.getOffset(_getElementObject(el));},_getSize=function(el){return jsPlumb.CurrentLibrary.getSize(_getElementObject(el));},_log=jsPlumbUtil.log,_group=jsPlumbUtil.group,_groupEnd=jsPlumbUtil.groupEnd,_time=jsPlumbUtil.time,_timeEnd=jsPlumbUtil.timeEnd,_timestamp=function(){return""+(new Date()).getTime();},jsPlumbUIComponent=function(params){var self=this,a=arguments,_hover=false,parameters=params.parameters||{},idPrefix=self.idPrefix,id=idPrefix+(new Date()).getTime(),paintStyle=null,hoverPaintStyle=null;self._jsPlumb=params["_jsPlumb"];self.getId=function(){return id;};self.tooltip=params.tooltip;self.hoverClass=params.hoverClass||self._jsPlumb.Defaults.HoverClass||jsPlumb.Defaults.HoverClass;jsPlumbUtil.EventGenerator.apply(this);this.clone=function(){var o=new Object();self.constructor.apply(o,a);return o;};this.getParameter=function(name){return parameters[name];},this.getParameters=function(){return parameters;},this.setParameter=function(name,value){parameters[name]=value;},this.setParameters=function(p){parameters=p;},this.overlayPlacements=[];var beforeDetach=params.beforeDetach;this.isDetachAllowed=function(connection){var r=self._jsPlumb.checkCondition("beforeDetach",connection);if(beforeDetach){try{r=beforeDetach(connection);}
catch(e){_log("jsPlumb: beforeDetach callback failed",e);}}
return r;};var beforeDrop=params.beforeDrop;this.isDropAllowed=function(sourceId,targetId,scope,connection,dropEndpoint){var r=self._jsPlumb.checkCondition("beforeDrop",{sourceId:sourceId,targetId:targetId,scope:scope,connection:connection,dropEndpoint:dropEndpoint});if(beforeDrop){try{r=beforeDrop({sourceId:sourceId,targetId:targetId,scope:scope,connection:connection,dropEndpoint:dropEndpoint});}
catch(e){_log("jsPlumb: beforeDrop callback failed",e);}}
return r;};var _updateHoverStyle=function(){if(paintStyle&&hoverPaintStyle){var mergedHoverStyle={};jsPlumb.extend(mergedHoverStyle,paintStyle);jsPlumb.extend(mergedHoverStyle,hoverPaintStyle);delete self["hoverPaintStyle"];if(mergedHoverStyle.gradient&&paintStyle.fillStyle)
delete mergedHoverStyle["gradient"];hoverPaintStyle=mergedHoverStyle;}};this.setPaintStyle=function(style,doNotRepaint){paintStyle=style;self.paintStyleInUse=paintStyle;_updateHoverStyle();if(!doNotRepaint)self.repaint();};this.getPaintStyle=function(){return paintStyle;};this.setHoverPaintStyle=function(style,doNotRepaint){hoverPaintStyle=style;_updateHoverStyle();if(!doNotRepaint)self.repaint();};this.getHoverPaintStyle=function(){return hoverPaintStyle;};this.setHover=function(hover,ignoreAttachedElements,timestamp){if(!self._jsPlumb.currentlyDragging&&!self._jsPlumb.isHoverSuspended()){_hover=hover;if(self.hoverClass!=null&&self.canvas!=null){if(hover)
jpcl.addClass(self.canvas,self.hoverClass);else
jpcl.removeClass(self.canvas,self.hoverClass);}
if(hoverPaintStyle!=null){self.paintStyleInUse=hover?hoverPaintStyle:paintStyle;timestamp=timestamp||_timestamp();self.repaint({timestamp:timestamp,recalc:false});}
if(self.getAttachedElements&&!ignoreAttachedElements)
_updateAttachedElements(hover,_timestamp(),self);}};this.isHover=function(){return _hover;};var zIndex=null;this.setZIndex=function(v){zIndex=v;};this.getZIndex=function(){return zIndex;};var jpcl=jsPlumb.CurrentLibrary,events=["click","dblclick","mouseenter","mouseout","mousemove","mousedown","mouseup","contextmenu"],eventFilters={"mouseout":"mouseexit"},bindOne=function(o,c,evt){var filteredEvent=eventFilters[evt]||evt;jpcl.bind(o,evt,function(ee){c.fire(filteredEvent,c,ee);});},unbindOne=function(o,evt){var filteredEvent=eventFilters[evt]||evt;jpcl.unbind(o,evt);};this.attachListeners=function(o,c){for(var i=0;i<events.length;i++){bindOne(o,c,events[i]);}};var _updateAttachedElements=function(state,timestamp,sourceElement){var affectedElements=self.getAttachedElements();if(affectedElements){for(var i=0;i<affectedElements.length;i++){if(!sourceElement||sourceElement!=affectedElements[i])
affectedElements[i].setHover(state,true,timestamp);}}};this.reattachListenersForElement=function(o){if(arguments.length>1){for(var i=0;i<events.length;i++)
unbindOne(o,events[i]);for(var i=1;i<arguments.length;i++)
self.attachListeners(o,arguments[i]);}};var _types=[],_splitType=function(t){return t==null?null:t.split(" ")},_applyTypes=function(doNotRepaint){if(self.getDefaultType){var td=self.getTypeDescriptor();var o=jsPlumbUtil.merge({},self.getDefaultType());for(var i=0;i<_types.length;i++)
o=jsPlumbUtil.merge(o,self._jsPlumb.getType(_types[i],td));self.applyType(o);if(!doNotRepaint)self.repaint();}};self.setType=function(typeId,doNotRepaint){_types=_splitType(typeId)||[];_applyTypes(doNotRepaint);};self.getType=function(){return _types;};self.hasType=function(typeId){return jsPlumbUtil.indexOf(_types,typeId)!=-1;};self.addType=function(typeId,doNotRepaint){var t=_splitType(typeId),_cont=false;if(t!=null){for(var i=0;i<t.length;i++){if(!self.hasType(t[i])){_types.push(t[i]);_cont=true;}}
if(_cont)_applyTypes(doNotRepaint);}};self.removeType=function(typeId,doNotRepaint){var t=_splitType(typeId),_cont=false,_one=function(tt){var idx=jsPlumbUtil.indexOf(_types,tt);if(idx!=-1){_types.splice(idx,1);return true;}
return false;};if(t!=null){for(var i=0;i<t.length;i++){_cont=_one(t[i])||_cont;}
if(_cont)_applyTypes(doNotRepaint);}};self.toggleType=function(typeId,doNotRepaint){var t=_splitType(typeId);if(t!=null){for(var i=0;i<t.length;i++){var idx=jsPlumbUtil.indexOf(_types,t[i]);if(idx!=-1)
_types.splice(idx,1);else
_types.push(t[i]);}
_applyTypes(doNotRepaint);}};this.applyType=function(t){self.setPaintStyle(t.paintStyle);self.setHoverPaintStyle(t.hoverPaintStyle);if(t.parameters){for(var i in t.parameters)
self.setParameter(i,t.parameters[i]);}};},overlayCapableJsPlumbUIComponent=function(params){jsPlumbUIComponent.apply(this,arguments);var self=this;this.overlays=[];var processOverlay=function(o){var _newOverlay=null;if(_isArray(o)){var type=o[0],p=jsPlumb.extend({component:self,_jsPlumb:self._jsPlumb},o[1]);if(o.length==3)jsPlumb.extend(p,o[2]);_newOverlay=new jsPlumb.Overlays[self._jsPlumb.getRenderMode()][type](p);if(p.events){for(var evt in p.events){_newOverlay.bind(evt,p.events[evt]);}}}else if(o.constructor==String){_newOverlay=new jsPlumb.Overlays[self._jsPlumb.getRenderMode()][o]({component:self,_jsPlumb:self._jsPlumb});}else{_newOverlay=o;}
self.overlays.push(_newOverlay);},calculateOverlaysToAdd=function(params){var defaultKeys=self.defaultOverlayKeys||[],o=params.overlays,checkKey=function(k){return self._jsPlumb.Defaults[k]||jsPlumb.Defaults[k]||[];};if(!o)o=[];for(var i=0;i<defaultKeys.length;i++)
o.unshift.apply(o,checkKey(defaultKeys[i]));return o;}
var _overlays=calculateOverlaysToAdd(params);if(_overlays){for(var i=0;i<_overlays.length;i++){processOverlay(_overlays[i]);}}
var _getOverlayIndex=function(id){var idx=-1;for(var i=0;i<self.overlays.length;i++){if(id===self.overlays[i].id){idx=i;break;}}
return idx;};this.addOverlay=function(overlay,doNotRepaint){processOverlay(overlay);if(!doNotRepaint)self.repaint();};this.getOverlay=function(id){var idx=_getOverlayIndex(id);return idx>=0?self.overlays[idx]:null;};this.getOverlays=function(){return self.overlays;};this.hideOverlay=function(id){var o=self.getOverlay(id);if(o)o.hide();};this.hideOverlays=function(){for(var i=0;i<self.overlays.length;i++)
self.overlays[i].hide();};this.showOverlay=function(id){var o=self.getOverlay(id);if(o)o.show();};this.showOverlays=function(){for(var i=0;i<self.overlays.length;i++)
self.overlays[i].show();};this.removeAllOverlays=function(){for(var i in self.overlays)
self.overlays[i].cleanup();self.overlays.splice(0,self.overlays.length);self.repaint();};this.removeOverlay=function(overlayId){var idx=_getOverlayIndex(overlayId);if(idx!=-1){var o=self.overlays[idx];o.cleanup();self.overlays.splice(idx,1);}};this.removeOverlays=function(){for(var i=0;i<arguments.length;i++)
self.removeOverlay(arguments[i]);};var _internalLabelOverlayId="__label",_makeLabelOverlay=function(params){var _params={cssClass:params.cssClass,labelStyle:this.labelStyle,id:_internalLabelOverlayId,component:self,_jsPlumb:self._jsPlumb},mergedParams=jsPlumb.extend(_params,params);return new jsPlumb.Overlays[self._jsPlumb.getRenderMode()].Label(mergedParams);};if(params.label){var loc=params.labelLocation||self.defaultLabelLocation||0.5,labelStyle=params.labelStyle||self._jsPlumb.Defaults.LabelStyle||jsPlumb.Defaults.LabelStyle;this.overlays.push(_makeLabelOverlay({label:params.label,location:loc,labelStyle:labelStyle}));}
this.setLabel=function(l){var lo=self.getOverlay(_internalLabelOverlayId);if(!lo){var params=l.constructor==String||l.constructor==Function?{label:l}:l;lo=_makeLabelOverlay(params);this.overlays.push(lo);}
else{if(l.constructor==String||l.constructor==Function)lo.setLabel(l);else{if(l.label)lo.setLabel(l.label);if(l.location)lo.setLocation(l.location);}}
if(!self._jsPlumb.isSuspendDrawing())
self.repaint();};this.getLabel=function(){var lo=self.getOverlay(_internalLabelOverlayId);return lo!=null?lo.getLabel():null;};this.getLabelOverlay=function(){return self.getOverlay(_internalLabelOverlayId);};var superAt=this.applyType;this.applyType=function(t){superAt(t);self.removeAllOverlays();if(t.overlays){for(var i=0;i<t.overlays.length;i++)
self.addOverlay(t.overlays[i],true);}};},_bindListeners=function(obj,_self,_hoverFunction){obj.bind("click",function(ep,e){_self.fire("click",_self,e);});obj.bind("dblclick",function(ep,e){_self.fire("dblclick",_self,e);});obj.bind("contextmenu",function(ep,e){_self.fire("contextmenu",_self,e);});obj.bind("mouseenter",function(ep,e){if(!_self.isHover()){_hoverFunction(true);_self.fire("mouseenter",_self,e);}});obj.bind("mouseexit",function(ep,e){if(_self.isHover()){_hoverFunction(false);_self.fire("mouseexit",_self,e);}});};var _jsPlumbInstanceIndex=0,getInstanceIndex=function(){var i=_jsPlumbInstanceIndex+1;_jsPlumbInstanceIndex++;return i;};var jsPlumbInstance=function(_defaults){this.Defaults={Anchor:"BottomCenter",Anchors:[null,null],ConnectionsDetachable:true,ConnectionOverlays:[],Connector:"Bezier",ConnectorZIndex:null,Container:null,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fillStyle:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},LogEnabled:false,Overlays:[],MaxConnections:1,PaintStyle:{lineWidth:8,strokeStyle:"#456"},RenderMode:"svg",Scope:"jsPlumb_DefaultScope"};if(_defaults)jsPlumb.extend(this.Defaults,_defaults);this.logEnabled=this.Defaults.LogEnabled;var _connectionTypes={},_endpointTypes={};this.registerConnectionType=function(id,type){_connectionTypes[id]=jsPlumb.extend({},type);};this.registerConnectionTypes=function(types){for(var i in types)
_connectionTypes[i]=jsPlumb.extend({},types[i]);};this.registerEndpointType=function(id,type){_endpointTypes[id]=jsPlumb.extend({},type);};this.registerEndpointTypes=function(types){for(var i in types)
_endpointTypes[i]=jsPlumb.extend({},types[i]);};this.getType=function(id,typeDescriptor){return typeDescriptor==="connection"?_connectionTypes[id]:_endpointTypes[id];};jsPlumbUtil.EventGenerator.apply(this);var _currentInstance=this,_instanceIndex=getInstanceIndex(),_bb=_currentInstance.bind,_initialDefaults={};for(var i in this.Defaults)
_initialDefaults[i]=this.Defaults[i];this.bind=function(event,fn){if("ready"===event&&initialized)fn();else _bb.apply(_currentInstance,[event,fn]);};_currentInstance.importDefaults=function(d){for(var i in d){_currentInstance.Defaults[i]=d[i];}};_currentInstance.restoreDefaults=function(){_currentInstance.Defaults=jsPlumb.extend({},_initialDefaults);};var log=null,repaintFunction=function(){jsPlumb.repaintEverything();},automaticRepaint=true,repaintEverything=function(){if(automaticRepaint)
repaintFunction();},resizeTimer=null,initialized=false,connectionsByScope={},endpointsByElement={},endpointsByUUID={},offsets={},offsetTimestamps={},floatingConnections={},draggableStates={},canvasList=[],sizes=[],DEFAULT_SCOPE=this.Defaults.Scope,renderMode=null,_addToList=function(map,key,value){var l=map[key];if(l==null){l=[];map[key]=l;}
l.push(value);return l;},_appendElement=function(el,parent){if(_currentInstance.Defaults.Container)
jsPlumb.CurrentLibrary.appendElement(el,_currentInstance.Defaults.Container);else if(!parent)
jsPlumbAdapter.appendToRoot(el);else
jsPlumb.CurrentLibrary.appendElement(el,parent);},_curIdStamp=1,_idstamp=function(){return""+_curIdStamp++;},_convertYUICollection=function(c){return c._nodes?c._nodes:c;},_draw=function(element,ui,timestamp){if(!jsPlumbAdapter.headless&&!_suspendDrawing){var id=_getAttribute(element,"id"),repaintEls=_currentInstance.dragManager.getElementsForDraggable(id);if(timestamp==null)timestamp=_timestamp();_currentInstance.anchorManager.redraw(id,ui,timestamp);if(repaintEls){for(var i in repaintEls){_currentInstance.anchorManager.redraw(repaintEls[i].id,ui,timestamp,repaintEls[i].offset);}}}},_elementProxy=function(element,fn){var retVal=null;if(_isArray(element)){retVal=[];for(var i=0;i<element.length;i++){var el=_getElementObject(element[i]),id=_getAttribute(el,"id");retVal.push(fn(el,id));}}else{var el=_getElementObject(element),id=_getAttribute(el,"id");retVal=fn(el,id);}
return retVal;},_getEndpoint=function(uuid){return endpointsByUUID[uuid];},_initDraggableIfNecessary=function(element,isDraggable,dragOptions){if(!jsPlumbAdapter.headless){var draggable=isDraggable==null?false:isDraggable,jpcl=jsPlumb.CurrentLibrary;if(draggable){if(jpcl.isDragSupported(element)&&!jpcl.isAlreadyDraggable(element)){var options=dragOptions||_currentInstance.Defaults.DragOptions||jsPlumb.Defaults.DragOptions;options=jsPlumb.extend({},options);var dragEvent=jpcl.dragEvents["drag"],stopEvent=jpcl.dragEvents["stop"],startEvent=jpcl.dragEvents["start"];options[startEvent]=_wrap(options[startEvent],function(){_currentInstance.setHoverSuspended(true);});options[dragEvent]=_wrap(options[dragEvent],function(){var ui=jpcl.getUIPosition(arguments);_draw(element,ui);_addClass(element,"jsPlumb_dragged");});options[stopEvent]=_wrap(options[stopEvent],function(){var ui=jpcl.getUIPosition(arguments);_draw(element,ui);_removeClass(element,"jsPlumb_dragged");_currentInstance.setHoverSuspended(false);});var elId=_getId(element);draggableStates[elId]=true;var draggable=draggableStates[elId];options.disabled=draggable==null?false:!draggable;jpcl.initDraggable(element,options,false);_currentInstance.dragManager.register(element);}}}},_prepareConnectionParams=function(params,referenceParams){var _p=jsPlumb.extend({},params);if(referenceParams)jsPlumb.extend(_p,referenceParams);if(_p.source&&_p.source.endpoint)_p.sourceEndpoint=_p.source;if(_p.source&&_p.target.endpoint)_p.targetEndpoint=_p.target;if(params.uuids){_p.sourceEndpoint=_getEndpoint(params.uuids[0]);_p.targetEndpoint=_getEndpoint(params.uuids[1]);}
if(_p.sourceEndpoint&&_p.sourceEndpoint.isFull()){_log(_currentInstance,"could not add connection; source endpoint is full");return;}
if(_p.targetEndpoint&&_p.targetEndpoint.isFull()){_log(_currentInstance,"could not add connection; target endpoint is full");return;}
if(!_p.type&&_p.sourceEndpoint)
_p.type=_p.sourceEndpoint.connectionType;if(_p.sourceEndpoint&&_p.sourceEndpoint.connectorOverlays){_p.overlays=_p.overlays||[];for(var i=0;i<_p.sourceEndpoint.connectorOverlays.length;i++){_p.overlays.push(_p.sourceEndpoint.connectorOverlays[i]);}}
_p.tooltip=params.tooltip;if(!_p.tooltip&&_p.sourceEndpoint&&_p.sourceEndpoint.connectorTooltip)
_p.tooltip=_p.sourceEndpoint.connectorTooltip;if(_p.target&&!_p.target.endpoint&&!_p.targetEndpoint&&!_p.newConnection){var tid=_getId(_p.target),tep=_targetEndpointDefinitions[tid],existingUniqueEndpoint=_targetEndpoints[tid];if(tep){if(!_targetsEnabled[tid])return;var newEndpoint=existingUniqueEndpoint!=null?existingUniqueEndpoint:_currentInstance.addEndpoint(_p.target,tep);if(_targetEndpointsUnique[tid])_targetEndpoints[tid]=newEndpoint;_p.targetEndpoint=newEndpoint;newEndpoint._makeTargetCreator=true;}}
if(_p.source&&!_p.source.endpoint&&!_p.sourceEndpoint&&!_p.newConnection){var tid=_getId(_p.source),tep=_sourceEndpointDefinitions[tid],existingUniqueEndpoint=_sourceEndpoints[tid];if(tep){if(!_sourcesEnabled[tid])return;var newEndpoint=existingUniqueEndpoint!=null?existingUniqueEndpoint:_currentInstance.addEndpoint(_p.source,tep);if(_sourceEndpointsUnique[tid])_sourceEndpoints[tid]=newEndpoint;_p.sourceEndpoint=newEndpoint;}}
return _p;},_newConnection=function(params){var connectionFunc=_currentInstance.Defaults.ConnectionType||_currentInstance.getDefaultConnectionType(),endpointFunc=_currentInstance.Defaults.EndpointType||Endpoint,parent=jsPlumb.CurrentLibrary.getParent;if(params.container)
params["parent"]=params.container;else{if(params.sourceEndpoint)
params["parent"]=params.sourceEndpoint.parent;else if(params.source.constructor==endpointFunc)
params["parent"]=params.source.parent;else params["parent"]=parent(params.source);}
params["_jsPlumb"]=_currentInstance;var con=new connectionFunc(params);con.id="con_"+_idstamp();_eventFireProxy("click","click",con);_eventFireProxy("dblclick","dblclick",con);_eventFireProxy("contextmenu","contextmenu",con);return con;},_finaliseConnection=function(jpc,params,originalEvent){params=params||{};if(!jpc.suspendedEndpoint)
_addToList(connectionsByScope,jpc.scope,jpc);if(!params.doNotFireConnectionEvent&&params.fireEvent!==false){var eventArgs={connection:jpc,source:jpc.source,target:jpc.target,sourceId:jpc.sourceId,targetId:jpc.targetId,sourceEndpoint:jpc.endpoints[0],targetEndpoint:jpc.endpoints[1]};_currentInstance.fire("jsPlumbConnection",eventArgs,originalEvent);_currentInstance.fire("connection",eventArgs,originalEvent);}
_currentInstance.anchorManager.newConnection(jpc);_draw(jpc.source);},_eventFireProxy=function(event,proxyEvent,obj){obj.bind(event,function(originalObject,originalEvent){_currentInstance.fire(proxyEvent,obj,originalEvent);});},_getParentFromParams=function(params){if(params.container)
return params.container;else{var tag=jsPlumb.CurrentLibrary.getTagName(params.source),p=jsPlumb.CurrentLibrary.getParent(params.source);if(tag&&tag.toLowerCase()==="td")
return jsPlumb.CurrentLibrary.getParent(p);else return p;}},_newEndpoint=function(params){var endpointFunc=_currentInstance.Defaults.EndpointType||Endpoint;params.parent=_getParentFromParams(params);params["_jsPlumb"]=_currentInstance;var ep=new endpointFunc(params);ep.id="ep_"+_idstamp();_eventFireProxy("click","endpointClick",ep);_eventFireProxy("dblclick","endpointDblClick",ep);_eventFireProxy("contextmenu","contextmenu",ep);return ep;},_operation=function(elId,func,endpointFunc){var endpoints=endpointsByElement[elId];if(endpoints&&endpoints.length){for(var i=0;i<endpoints.length;i++){for(var j=0;j<endpoints[i].connections.length;j++){var retVal=func(endpoints[i].connections[j]);if(retVal)return;}
if(endpointFunc)endpointFunc(endpoints[i]);}}},_operationOnAll=function(func){for(var elId in endpointsByElement){_operation(elId,func);}},_removeElement=function(element,parent){if(element!=null&&element.parentNode!=null){element.parentNode.removeChild(element);}},_removeElements=function(elements,parent){for(var i=0;i<elements.length;i++)
_removeElement(elements[i],parent);},_setDraggable=function(element,draggable){return _elementProxy(element,function(el,id){draggableStates[id]=draggable;if(jsPlumb.CurrentLibrary.isDragSupported(el)){jsPlumb.CurrentLibrary.setDraggable(el,draggable);}});},_setVisible=function(el,state,alsoChangeEndpoints){state=state==="block";var endpointFunc=null;if(alsoChangeEndpoints){if(state)endpointFunc=function(ep){ep.setVisible(true,true,true);};else endpointFunc=function(ep){ep.setVisible(false,true,true);};}
var id=_getAttribute(el,"id");_operation(id,function(jpc){if(state&&alsoChangeEndpoints){var oidx=jpc.sourceId===id?1:0;if(jpc.endpoints[oidx].isVisible())jpc.setVisible(true);}
else
jpc.setVisible(state);},endpointFunc);},_toggleDraggable=function(el){return _elementProxy(el,function(el,elId){var state=draggableStates[elId]==null?false:draggableStates[elId];state=!state;draggableStates[elId]=state;jsPlumb.CurrentLibrary.setDraggable(el,state);return state;});},_toggleVisible=function(elId,changeEndpoints){var endpointFunc=null;if(changeEndpoints){endpointFunc=function(ep){var state=ep.isVisible();ep.setVisible(!state);};}
_operation(elId,function(jpc){var state=jpc.isVisible();jpc.setVisible(!state);},endpointFunc);},_updateOffset=function(params){var timestamp=params.timestamp,recalc=params.recalc,offset=params.offset,elId=params.elId;if(!recalc){if(timestamp&&timestamp===offsetTimestamps[elId])
return offsets[elId];}
if(recalc||!offset){var s=_getElementObject(elId);if(s!=null){sizes[elId]=_getSize(s);offsets[elId]=_getOffset(s);offsetTimestamps[elId]=timestamp;}}else{offsets[elId]=offset;if(sizes[elId]==null){var s=_getElementObject(elId);if(s!=null)
sizes[elId]=_getSize(s);}}
if(offsets[elId]&&!offsets[elId].right){offsets[elId].right=offsets[elId].left+sizes[elId][0];offsets[elId].bottom=offsets[elId].top+sizes[elId][1];offsets[elId].width=sizes[elId][0];offsets[elId].height=sizes[elId][1];offsets[elId].centerx=offsets[elId].left+(offsets[elId].width/2);offsets[elId].centery=offsets[elId].top+(offsets[elId].height/2);}
return offsets[elId];},_getCachedData=function(elId){var o=offsets[elId];if(!o)o=_updateOffset({elId:elId});return{o:o,s:sizes[elId]};},_getId=function(element,uuid,doNotCreateIfNotFound){var ele=_getElementObject(element);var id=_getAttribute(ele,"id");if(!id||id=="undefined"){if(arguments.length==2&&arguments[1]!=undefined)
id=uuid;else if(arguments.length==1||(arguments.length==3&&!arguments[2]))
id="jsPlumb_"+_instanceIndex+"_"+_idstamp();_setAttribute(ele,"id",id);}
return id;},_wrap=function(wrappedFunction,newFunction,returnOnThisValue){wrappedFunction=wrappedFunction||function(){};newFunction=newFunction||function(){};return function(){var r=null;try{r=newFunction.apply(this,arguments);}catch(e){_log(_currentInstance,"jsPlumb function failed : "+e);}
if(returnOnThisValue==null||(r!==returnOnThisValue)){try{wrappedFunction.apply(this,arguments);}catch(e){_log(_currentInstance,"wrapped function failed : "+e);}}
return r;};};this.connectorClass="_jsPlumb_connector";this.endpointClass="_jsPlumb_endpoint";this.overlayClass="_jsPlumb_overlay";this.Anchors={};this.Connectors={"canvas":{},"svg":{},"vml":{}};this.Endpoints={"canvas":{},"svg":{},"vml":{}};this.Overlays={"canvas":{},"svg":{},"vml":{}};this.addClass=function(el,clazz){return jsPlumb.CurrentLibrary.addClass(el,clazz);};this.removeClass=function(el,clazz){return jsPlumb.CurrentLibrary.removeClass(el,clazz);};this.hasClass=function(el,clazz){return jsPlumb.CurrentLibrary.hasClass(el,clazz);};this.addEndpoint=function(el,params,referenceParams){referenceParams=referenceParams||{};var p=jsPlumb.extend({},referenceParams);jsPlumb.extend(p,params);p.endpoint=p.endpoint||_currentInstance.Defaults.Endpoint||jsPlumb.Defaults.Endpoint;p.paintStyle=p.paintStyle||_currentInstance.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle;el=_convertYUICollection(el);var results=[],inputs=el.length&&el.constructor!=String?el:[el];for(var i=0;i<inputs.length;i++){var _el=_getElementObject(inputs[i]),id=_getId(_el);p.source=_el;_updateOffset({elId:id});var e=_newEndpoint(p);if(p.parentAnchor)e.parentAnchor=p.parentAnchor;_addToList(endpointsByElement,id,e);var myOffset=offsets[id],myWH=sizes[id];var anchorLoc=e.anchor.compute({xy:[myOffset.left,myOffset.top],wh:myWH,element:e});e.paint({anchorLoc:anchorLoc});results.push(e);if(!jsPlumbAdapter.headless)
_currentInstance.dragManager.endpointAdded(_el);}
return results.length==1?results[0]:results;};this.addEndpoints=function(el,endpoints,referenceParams){var results=[];for(var i=0;i<endpoints.length;i++){var e=_currentInstance.addEndpoint(el,endpoints[i],referenceParams);if(_isArray(e))
Array.prototype.push.apply(results,e);else results.push(e);}
return results;};this.animate=function(el,properties,options){var ele=_getElementObject(el),id=_getAttribute(el,"id");options=options||{};var stepFunction=jsPlumb.CurrentLibrary.dragEvents['step'];var completeFunction=jsPlumb.CurrentLibrary.dragEvents['complete'];options[stepFunction]=_wrap(options[stepFunction],function(){_currentInstance.repaint(id);});options[completeFunction]=_wrap(options[completeFunction],function(){_currentInstance.repaint(id);});jsPlumb.CurrentLibrary.animate(ele,properties,options);};this.checkCondition=function(conditionName,value){var l=_currentInstance.getListener(conditionName);var r=true;if(l&&l.length>0){try{for(var i=0;i<l.length;i++){r=r&&l[i](value);}}
catch(e){_log(_currentInstance,"cannot check condition ["+conditionName+"]"+e);}}
return r;};this.connect=function(params,referenceParams){var _p=_prepareConnectionParams(params,referenceParams),jpc;if(_p){if(_p.deleteEndpointsOnDetach==null)
_p.deleteEndpointsOnDetach=true;jpc=_newConnection(_p);_finaliseConnection(jpc,_p);}
return jpc;};this.deleteEndpoint=function(object){var endpoint=(typeof object=="string")?endpointsByUUID[object]:object;if(endpoint){var uuid=endpoint.getUuid();if(uuid)endpointsByUUID[uuid]=null;endpoint.detachAll();if(endpoint.endpoint.cleanup)endpoint.endpoint.cleanup();_removeElements(endpoint.endpoint.getDisplayElements());_currentInstance.anchorManager.deleteEndpoint(endpoint);for(var e in endpointsByElement){var endpoints=endpointsByElement[e];if(endpoints){var newEndpoints=[];for(var i=0;i<endpoints.length;i++)
if(endpoints[i]!=endpoint)newEndpoints.push(endpoints[i]);endpointsByElement[e]=newEndpoints;}}
if(!jsPlumbAdapter.headless)
_currentInstance.dragManager.endpointDeleted(endpoint);}};this.deleteEveryEndpoint=function(){_currentInstance.setSuspendDrawing(true);for(var id in endpointsByElement){var endpoints=endpointsByElement[id];if(endpoints&&endpoints.length){for(var i=0;i<endpoints.length;i++){_currentInstance.deleteEndpoint(endpoints[i]);}}}
delete endpointsByElement;endpointsByElement={};delete endpointsByUUID;endpointsByUUID={};_currentInstance.setSuspendDrawing(false,true);};var fireDetachEvent=function(jpc,doFireEvent,originalEvent){var connType=_currentInstance.Defaults.ConnectionType||_currentInstance.getDefaultConnectionType(),argIsConnection=jpc.constructor==connType,params=argIsConnection?{connection:jpc,source:jpc.source,target:jpc.target,sourceId:jpc.sourceId,targetId:jpc.targetId,sourceEndpoint:jpc.endpoints[0],targetEndpoint:jpc.endpoints[1]}:jpc;if(doFireEvent){_currentInstance.fire("jsPlumbConnectionDetached",params,originalEvent);_currentInstance.fire("connectionDetached",params,originalEvent);}
_currentInstance.anchorManager.connectionDetached(params);},fireConnectionDraggingEvent=function(jpc){_currentInstance.fire("connectionDrag",jpc);},fireConnectionDragStopEvent=function(jpc){_currentInstance.fire("connectionDragStop",jpc);};this.detach=function(){if(arguments.length==0)return;var connType=_currentInstance.Defaults.ConnectionType||_currentInstance.getDefaultConnectionType(),firstArgIsConnection=arguments[0].constructor==connType,params=arguments.length==2?firstArgIsConnection?(arguments[1]||{}):arguments[0]:arguments[0],fireEvent=(params.fireEvent!==false),forceDetach=params.forceDetach,connection=firstArgIsConnection?arguments[0]:params.connection;if(connection){if(forceDetach||(connection.isDetachAllowed(connection)&&connection.endpoints[0].isDetachAllowed(connection)&&connection.endpoints[1].isDetachAllowed(connection))){if(forceDetach||_currentInstance.checkCondition("beforeDetach",connection))
connection.endpoints[0].detach(connection,false,true,fireEvent);}}
else{var _p=jsPlumb.extend({},params);if(_p.uuids){_getEndpoint(_p.uuids[0]).detachFrom(_getEndpoint(_p.uuids[1]),fireEvent);}else if(_p.sourceEndpoint&&_p.targetEndpoint){_p.sourceEndpoint.detachFrom(_p.targetEndpoint);}else{var sourceId=_getId(_p.source),targetId=_getId(_p.target);_operation(sourceId,function(jpc){if((jpc.sourceId==sourceId&&jpc.targetId==targetId)||(jpc.targetId==sourceId&&jpc.sourceId==targetId)){if(_currentInstance.checkCondition("beforeDetach",jpc)){jpc.endpoints[0].detach(jpc,false,true,fireEvent);}}});}}};this.detachAllConnections=function(el,params){params=params||{};el=_getElementObject(el);var id=_getAttribute(el,"id"),endpoints=endpointsByElement[id];if(endpoints&&endpoints.length){for(var i=0;i<endpoints.length;i++){endpoints[i].detachAll(params.fireEvent);}}};this.detachEveryConnection=function(params){params=params||{};for(var id in endpointsByElement){var endpoints=endpointsByElement[id];if(endpoints&&endpoints.length){for(var i=0;i<endpoints.length;i++){endpoints[i].detachAll(params.fireEvent);}}}
delete connectionsByScope;connectionsByScope={};};this.draggable=function(el,options){if(typeof el=='object'&&el.length){for(var i=0;i<el.length;i++){var ele=_getElementObject(el[i]);if(ele)_initDraggableIfNecessary(ele,true,options);}}
else if(el._nodes){for(var i=0;i<el._nodes.length;i++){var ele=_getElementObject(el._nodes[i]);if(ele)_initDraggableIfNecessary(ele,true,options);}}
else{var ele=_getElementObject(el);if(ele)_initDraggableIfNecessary(ele,true,options);}};this.extend=function(o1,o2){return jsPlumb.CurrentLibrary.extend(o1,o2);};this.getDefaultEndpointType=function(){return Endpoint;};this.getDefaultConnectionType=function(){return Connection;};var _setOperation=function(list,func,args,selector){for(var i=0;i<list.length;i++){list[i][func].apply(list[i],args);}
return selector(list);},_getOperation=function(list,func,args){var out=[];for(var i=0;i<list.length;i++){out.push([list[i][func].apply(list[i],args),list[i]]);}
return out;},setter=function(list,func,selector){return function(){return _setOperation(list,func,arguments,selector);};},getter=function(list,func){return function(){return _getOperation(list,func,arguments);};},prepareList=function(input,doNotGetIds){var r=[];if(input){if(typeof input=='string'){if(input==="*")return input;r.push(input);}
else{if(doNotGetIds)r=input;else{for(var i=0;i<input.length;i++)
r.push(_getId(_getElementObject(input[i])));}}}
return r;},filterList=function(list,value,missingIsFalse){if(list==="*")return true;return list.length>0?_indexOf(list,value)!=-1:!missingIsFalse;};this.getConnections=function(options,flat){if(!options){options={};}else if(options.constructor==String){options={"scope":options};}
var
scope=options.scope||_currentInstance.getDefaultScope(),scopes=prepareList(scope,true),sources=prepareList(options.source),targets=prepareList(options.target),results=(!flat&&scopes.length>1)?{}:[],_addOne=function(scope,obj){if(!flat&&scopes.length>1){var ss=results[scope];if(ss==null){ss=[];results[scope]=ss;}
ss.push(obj);}else results.push(obj);};for(var i in connectionsByScope){if(filterList(scopes,i)){for(var j=0;j<connectionsByScope[i].length;j++){var c=connectionsByScope[i][j];if(filterList(sources,c.sourceId)&&filterList(targets,c.targetId))
_addOne(i,c);}}}
return results;};var _curryEach=function(list,executor){return function(f){for(var i=0;i<list.length;i++){f(list[i]);}
return executor(list);};},_curryGet=function(list){return function(idx){return list[idx];};};var _makeCommonSelectHandler=function(list,executor){return{setHover:setter(list,"setHover",executor),removeAllOverlays:setter(list,"removeAllOverlays",executor),setLabel:setter(list,"setLabel",executor),addOverlay:setter(list,"addOverlay",executor),removeOverlay:setter(list,"removeOverlay",executor),removeOverlays:setter(list,"removeOverlays",executor),showOverlay:setter(list,"showOverlay",executor),hideOverlay:setter(list,"hideOverlay",executor),showOverlays:setter(list,"showOverlays",executor),hideOverlays:setter(list,"hideOverlays",executor),setPaintStyle:setter(list,"setPaintStyle",executor),setHoverPaintStyle:setter(list,"setHoverPaintStyle",executor),setParameter:setter(list,"setParameter",executor),setParameters:setter(list,"setParameters",executor),setVisible:setter(list,"setVisible",executor),setZIndex:setter(list,"setZIndex",executor),repaint:setter(list,"repaint",executor),addType:setter(list,"addType",executor),toggleType:setter(list,"toggleType",executor),removeType:setter(list,"removeType",executor),getLabel:getter(list,"getLabel"),getOverlay:getter(list,"getOverlay"),isHover:getter(list,"isHover"),getParameter:getter(list,"getParameter"),getParameters:getter(list,"getParameters"),getPaintStyle:getter(list,"getPaintStyle"),getHoverPaintStyle:getter(list,"getHoverPaintStyle"),isVisible:getter(list,"isVisible"),getZIndex:getter(list,"getZIndex"),hasType:getter(list,"hasType"),getType:getter(list,"getType"),length:list.length,each:_curryEach(list,executor),get:_curryGet(list)};};var _makeConnectionSelectHandler=function(list){var common=_makeCommonSelectHandler(list,_makeConnectionSelectHandler);return jsPlumb.CurrentLibrary.extend(common,{setDetachable:setter(list,"setDetachable",_makeConnectionSelectHandler),setConnector:setter(list,"setConnector",_makeConnectionSelectHandler),detach:function(){for(var i=0;i<list.length;i++)
_currentInstance.detach(list[i]);},isDetachable:getter(list,"isDetachable")});};var _makeEndpointSelectHandler=function(list){var common=_makeCommonSelectHandler(list,_makeEndpointSelectHandler);return jsPlumb.CurrentLibrary.extend(common,{setEnabled:setter(list,"setEnabled",_makeEndpointSelectHandler),isEnabled:getter(list,"isEnabled"),detachAll:function(){for(var i=0;i<list.length;i++)
list[i].detachAll();},"delete":function(){for(var i=0;i<list.length;i++)
_currentInstance.deleteEndpoint(list[i]);}});};this.select=function(params){params=params||{};params.scope=params.scope||"*";var c=_currentInstance.getConnections(params,true);return _makeConnectionSelectHandler(c);};this.selectEndpoints=function(params){params=params||{};params.scope=params.scope||"*";var noElementFilters=!params.element&&!params.source&&!params.target,elements=noElementFilters?"*":prepareList(params.element),sources=noElementFilters?"*":prepareList(params.source),targets=noElementFilters?"*":prepareList(params.target),scopes=prepareList(params.scope,true);var ep=[];for(var el in endpointsByElement){var either=filterList(elements,el,true),source=filterList(sources,el,true),sourceMatchExact=sources!="*",target=filterList(targets,el,true),targetMatchExact=targets!="*";if(either||source||target){inner:for(var i=0;i<endpointsByElement[el].length;i++){var _ep=endpointsByElement[el][i];if(filterList(scopes,_ep.scope,true)){var noMatchSource=(sourceMatchExact&&sources.length>0&&!_ep.isSource),noMatchTarget=(targetMatchExact&&targets.length>0&&!_ep.isTarget);if(noMatchSource||noMatchTarget)
continue inner;ep.push(_ep);}}}}
return _makeEndpointSelectHandler(ep);};this.getAllConnections=function(){return connectionsByScope;};this.getDefaultScope=function(){return DEFAULT_SCOPE;};this.getEndpoint=_getEndpoint;this.getEndpoints=function(el){return endpointsByElement[_getId(el)];};this.getId=_getId;this.getOffset=function(id){var o=offsets[id];return _updateOffset({elId:id});};this.getSelector=function(spec){return jsPlumb.CurrentLibrary.getSelector(spec);};this.getSize=function(id){var s=sizes[id];if(!s)_updateOffset({elId:id});return sizes[id];};this.appendElement=_appendElement;var _hoverSuspended=false;this.isHoverSuspended=function(){return _hoverSuspended;};this.setHoverSuspended=function(s){_hoverSuspended=s;};var _isAvailable=function(m){return function(){return jsPlumbAdapter.isRenderModeAvailable(m);};}
this.isCanvasAvailable=_isAvailable("canvas");this.isSVGAvailable=_isAvailable("svg");this.isVMLAvailable=_isAvailable("vml");this.hide=function(el,changeEndpoints){_setVisible(el,"none",changeEndpoints);};this.idstamp=_idstamp;this.init=function(){if(!initialized){_currentInstance.setRenderMode(_currentInstance.Defaults.RenderMode);var bindOne=function(event){jsPlumb.CurrentLibrary.bind(document,event,function(e){if(!_currentInstance.currentlyDragging&&renderMode==jsPlumb.CANVAS){for(var scope in connectionsByScope){var c=connectionsByScope[scope];for(var i=0;i<c.length;i++){var t=c[i].connector[event](e);if(t)return;}}
for(var el in endpointsByElement){var ee=endpointsByElement[el];for(var i=0;i<ee.length;i++){if(ee[i].endpoint[event](e))return;}}}});};bindOne("click");bindOne("dblclick");bindOne("mousemove");bindOne("mousedown");bindOne("mouseup");bindOne("contextmenu");initialized=true;_currentInstance.fire("ready");}};this.log=log;this.jsPlumbUIComponent=jsPlumbUIComponent;this.makeAnchor=function(){if(arguments.length==0)return null;var specimen=arguments[0],elementId=arguments[1],jsPlumbInstance=arguments[2],newAnchor=null;if(specimen.compute&&specimen.getOrientation)return specimen;else if(typeof specimen=="string"){newAnchor=jsPlumb.Anchors[arguments[0]]({elementId:elementId,jsPlumbInstance:_currentInstance});}
else if(_isArray(specimen)){if(_isArray(specimen[0])||_isString(specimen[0])){if(specimen.length==2&&_isString(specimen[0])&&_isObject(specimen[1])){var pp=jsPlumb.extend({elementId:elementId,jsPlumbInstance:_currentInstance},specimen[1]);newAnchor=jsPlumb.Anchors[specimen[0]](pp);}
else
newAnchor=new DynamicAnchor(specimen,null,elementId);}
else{var anchorParams={x:specimen[0],y:specimen[1],orientation:(specimen.length>=4)?[specimen[2],specimen[3]]:[0,0],offsets:(specimen.length==6)?[specimen[4],specimen[5]]:[0,0],elementId:elementId};newAnchor=new Anchor(anchorParams);newAnchor.clone=function(){return new Anchor(anchorParams);};}}
if(!newAnchor.id)newAnchor.id="anchor_"+_idstamp();return newAnchor;};this.makeAnchors=function(types,elementId,jsPlumbInstance){var r=[];for(var i=0;i<types.length;i++){if(typeof types[i]=="string")
r.push(jsPlumb.Anchors[types[i]]({elementId:elementId,jsPlumbInstance:jsPlumbInstance}));else if(_isArray(types[i]))
r.push(_currentInstance.makeAnchor(types[i],elementId,jsPlumbInstance));}
return r;};this.makeDynamicAnchor=function(anchors,anchorSelector){return new DynamicAnchor(anchors,anchorSelector);};var _targetEndpointDefinitions={},_targetEndpoints={},_targetEndpointsUnique={},_targetMaxConnections={},_setEndpointPaintStylesAndAnchor=function(ep,epIndex){ep.paintStyle=ep.paintStyle||_currentInstance.Defaults.EndpointStyles[epIndex]||_currentInstance.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyles[epIndex]||jsPlumb.Defaults.EndpointStyle;ep.hoverPaintStyle=ep.hoverPaintStyle||_currentInstance.Defaults.EndpointHoverStyles[epIndex]||_currentInstance.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyles[epIndex]||jsPlumb.Defaults.EndpointHoverStyle;ep.anchor=ep.anchor||_currentInstance.Defaults.Anchors[epIndex]||_currentInstance.Defaults.Anchor||jsPlumb.Defaults.Anchors[epIndex]||jsPlumb.Defaults.Anchor;ep.endpoint=ep.endpoint||_currentInstance.Defaults.Endpoints[epIndex]||_currentInstance.Defaults.Endpoint||jsPlumb.Defaults.Endpoints[epIndex]||jsPlumb.Defaults.Endpoint;};this.makeTarget=function(el,params,referenceParams){var p=jsPlumb.extend({_jsPlumb:_currentInstance},referenceParams);jsPlumb.extend(p,params);_setEndpointPaintStylesAndAnchor(p,1);var jpcl=jsPlumb.CurrentLibrary,targetScope=p.scope||_currentInstance.Defaults.Scope,deleteEndpointsOnDetach=!(p.deleteEndpointsOnDetach===false),maxConnections=p.maxConnections||-1,onMaxConnections=p.onMaxConnections;_doOne=function(_el){var elid=_getId(_el);_targetEndpointDefinitions[elid]=p;_targetEndpointsUnique[elid]=p.uniqueEndpoint,_targetMaxConnections[elid]=maxConnections,_targetsEnabled[elid]=true,proxyComponent=new jsPlumbUIComponent(p);var dropOptions=jsPlumb.extend({},p.dropOptions||{}),_drop=function(){var originalEvent=jsPlumb.CurrentLibrary.getDropEvent(arguments),targetCount=_currentInstance.select({target:elid}).length;_currentInstance.currentlyDragging=false;var draggable=_getElementObject(jpcl.getDragObject(arguments)),id=_getAttribute(draggable,"dragId"),scope=_getAttribute(draggable,"originalScope"),jpc=floatingConnections[id],source=jpc.endpoints[0],_endpoint=p.endpoint?jsPlumb.extend({},p.endpoint):{};if(!_targetsEnabled[elid]||_targetMaxConnections[elid]>0&&targetCount>=_targetMaxConnections[elid]){if(onMaxConnections){onMaxConnections({element:_el,connection:jpc},originalEvent);}
return false;}
source.anchor.locked=false;if(scope)jpcl.setDragScope(draggable,scope);var _continue=proxyComponent.isDropAllowed(jpc.sourceId,_getId(_el),jpc.scope,jpc,null);if(jpc.endpointsToDeleteOnDetach){if(source===jpc.endpointsToDeleteOnDetach[0])
jpc.endpointsToDeleteOnDetach[0]=null;else if(source===jpc.endpointsToDeleteOnDetach[1])
jpc.endpointsToDeleteOnDetach[1]=null;}
if(jpc.suspendedEndpoint){jpc.targetId=jpc.suspendedEndpoint.elementId;jpc.target=jpcl.getElementObject(jpc.suspendedEndpoint.elementId);jpc.endpoints[1]=jpc.suspendedEndpoint;}
if(_continue){source.detach(jpc,false,true,false);var newEndpoint=_targetEndpoints[elid]||_currentInstance.addEndpoint(_el,p);if(p.uniqueEndpoint)_targetEndpoints[elid]=newEndpoint;newEndpoint._makeTargetCreator=true;if(newEndpoint.anchor.positionFinder!=null){var dropPosition=jpcl.getUIPosition(arguments),elPosition=jpcl.getOffset(_el),elSize=jpcl.getSize(_el),ap=newEndpoint.anchor.positionFinder(dropPosition,elPosition,elSize,newEndpoint.anchor.constructorParams);newEndpoint.anchor.x=ap[0];newEndpoint.anchor.y=ap[1];}
var c=_currentInstance.connect({source:source,target:newEndpoint,scope:scope,previousConnection:jpc,container:jpc.parent,deleteEndpointsOnDetach:deleteEndpointsOnDetach,doNotFireConnectionEvent:source.endpointWillMoveAfterConnection});if(jpc.endpoints[1]._makeTargetCreator&&jpc.endpoints[1].connections.length<2)
_currentInstance.deleteEndpoint(jpc.endpoints[1]);if(deleteEndpointsOnDetach)
c.endpointsToDeleteOnDetach=[source,newEndpoint];c.repaint();}
else{if(jpc.suspendedEndpoint){if(source.isReattach){jpc.setHover(false);jpc.floatingAnchorIndex=null;jpc.suspendedEndpoint.addConnection(jpc);_currentInstance.repaint(source.elementId);}
else
source.detach(jpc,false,true,true,originalEvent);}}};var dropEvent=jpcl.dragEvents['drop'];dropOptions["scope"]=dropOptions["scope"]||targetScope;dropOptions[dropEvent]=_wrap(dropOptions[dropEvent],_drop);jpcl.initDroppable(_el,dropOptions,true);};el=_convertYUICollection(el);var inputs=el.length&&el.constructor!=String?el:[el];for(var i=0;i<inputs.length;i++){_doOne(_getElementObject(inputs[i]));}
return _currentInstance;};this.unmakeTarget=function(el,doNotClearArrays){el=jsPlumb.CurrentLibrary.getElementObject(el);var elid=_getId(el);if(!doNotClearArrays){delete _targetEndpointDefinitions[elid];delete _targetEndpointsUnique[elid];delete _targetMaxConnections[elid];delete _targetsEnabled[elid];}
return _currentInstance;};this.makeTargets=function(els,params,referenceParams){for(var i=0;i<els.length;i++){_currentInstance.makeTarget(els[i],params,referenceParams);}};var _sourceEndpointDefinitions={},_sourceEndpoints={},_sourceEndpointsUnique={},_sourcesEnabled={},_sourceTriggers={},_sourceMaxConnections={},_targetsEnabled={};this.makeSource=function(el,params,referenceParams){var p=jsPlumb.extend({},referenceParams);jsPlumb.extend(p,params);_setEndpointPaintStylesAndAnchor(p,0);var jpcl=jsPlumb.CurrentLibrary,maxConnections=p.maxConnections||-1,onMaxConnections=p.onMaxConnections,_doOne=function(_el){var elid=_getId(_el),parent=p.parent,idToRegisterAgainst=parent!=null?_currentInstance.getId(jpcl.getElementObject(parent)):elid;_sourceEndpointDefinitions[idToRegisterAgainst]=p;_sourceEndpointsUnique[idToRegisterAgainst]=p.uniqueEndpoint;_sourcesEnabled[idToRegisterAgainst]=true;var stopEvent=jpcl.dragEvents["stop"],dragEvent=jpcl.dragEvents["drag"],dragOptions=jsPlumb.extend({},p.dragOptions||{}),existingDrag=dragOptions.drag,existingStop=dragOptions.stop,ep=null,endpointAddedButNoDragYet=false;_sourceMaxConnections[idToRegisterAgainst]=maxConnections;dragOptions["scope"]=dragOptions["scope"]||p.scope;dragOptions[dragEvent]=_wrap(dragOptions[dragEvent],function(){if(existingDrag)existingDrag.apply(this,arguments);endpointAddedButNoDragYet=false;});dragOptions[stopEvent]=_wrap(dragOptions[stopEvent],function(){if(existingStop)existingStop.apply(this,arguments);_currentInstance.currentlyDragging=false;if(ep.connections.length==0)
_currentInstance.deleteEndpoint(ep);else{jpcl.unbind(ep.canvas,"mousedown");var anchorDef=p.anchor||_currentInstance.Defaults.Anchor,oldAnchor=ep.anchor,oldConnection=ep.connections[0];ep.anchor=_currentInstance.makeAnchor(anchorDef,elid,_currentInstance);if(p.parent){var parent=jpcl.getElementObject(p.parent);if(parent){var currentId=ep.elementId;var potentialParent=p.container||_currentInstance.Defaults.Container||jsPlumb.Defaults.Container;ep.setElement(parent,potentialParent);ep.endpointWillMoveAfterConnection=false;_currentInstance.anchorManager.rehomeEndpoint(currentId,parent);oldConnection.previousConnection=null;_removeWithFunction(connectionsByScope[oldConnection.scope],function(c){return c.id===oldConnection.id;});_currentInstance.anchorManager.connectionDetached({sourceId:oldConnection.sourceId,targetId:oldConnection.targetId,connection:oldConnection});_finaliseConnection(oldConnection);}}
ep.repaint();_currentInstance.repaint(ep.elementId);_currentInstance.repaint(oldConnection.targetId);}});var mouseDownListener=function(e){if(!_sourcesEnabled[idToRegisterAgainst])return;var sourceCount=_currentInstance.select({source:idToRegisterAgainst}).length
if(_sourceMaxConnections[idToRegisterAgainst]>=0&&sourceCount>=_sourceMaxConnections[idToRegisterAgainst]){if(onMaxConnections){onMaxConnections({element:_el,maxConnections:maxConnections},e);}
return false;}
if(params.filter){var r=params.filter(jpcl.getOriginalEvent(e),_el);if(r===false)return;}
var myOffsetInfo=_updateOffset({elId:elid});var x=((e.pageX||e.page.x)-myOffsetInfo.left)/myOffsetInfo.width,y=((e.pageY||e.page.y)-myOffsetInfo.top)/myOffsetInfo.height,parentX=x,parentY=y;if(p.parent){var pEl=jpcl.getElementObject(p.parent),pId=_getId(pEl);myOffsetInfo=_updateOffset({elId:pId});parentX=((e.pageX||e.page.x)-myOffsetInfo.left)/myOffsetInfo.width,parentY=((e.pageY||e.page.y)-myOffsetInfo.top)/myOffsetInfo.height;}
var tempEndpointParams={};jsPlumb.extend(tempEndpointParams,p);tempEndpointParams.isSource=true;tempEndpointParams.anchor=[x,y,0,0];tempEndpointParams.parentAnchor=[parentX,parentY,0,0];tempEndpointParams.dragOptions=dragOptions;if(p.parent){var potentialParent=tempEndpointParams.container||_currentInstance.Defaults.Container||jsPlumb.Defaults.Container;if(potentialParent)
tempEndpointParams.container=potentialParent;else
tempEndpointParams.container=jsPlumb.CurrentLibrary.getParent(p.parent);}
ep=_currentInstance.addEndpoint(elid,tempEndpointParams);endpointAddedButNoDragYet=true;ep.endpointWillMoveAfterConnection=p.parent!=null;ep.endpointWillMoveTo=p.parent?jpcl.getElementObject(p.parent):null;var _delTempEndpoint=function(){if(endpointAddedButNoDragYet){_currentInstance.deleteEndpoint(ep);}};_currentInstance.registerListener(ep.canvas,"mouseup",_delTempEndpoint);_currentInstance.registerListener(_el,"mouseup",_delTempEndpoint);jpcl.trigger(ep.canvas,"mousedown",e);};_currentInstance.registerListener(_el,"mousedown",mouseDownListener);_sourceTriggers[elid]=mouseDownListener;};el=_convertYUICollection(el);var inputs=el.length&&el.constructor!=String?el:[el];for(var i=0;i<inputs.length;i++){_doOne(_getElementObject(inputs[i]));}
return _currentInstance;};this.unmakeSource=function(el,doNotClearArrays){el=jsPlumb.CurrentLibrary.getElementObject(el);var id=_getId(el),mouseDownListener=_sourceTriggers[id];if(mouseDownListener)
_currentInstance.unregisterListener(_el,"mousedown",mouseDownListener);if(!doNotClearArrays){delete _sourceEndpointDefinitions[id];delete _sourceEndpointsUnique[id];delete _sourcesEnabled[id];delete _sourceTriggers[id];delete _sourceMaxConnections[id];}
return _currentInstance;};this.unmakeEverySource=function(){for(var i in _sourcesEnabled)
_currentInstance.unmakeSource(i,true);_sourceEndpointDefinitions={};_sourceEndpointsUnique={};_sourcesEnabled={};_sourceTriggers={};};this.unmakeEveryTarget=function(){for(var i in _targetsEnabled)
_currentInstance.unmakeTarget(i,true);_targetEndpointDefinitions={};_targetEndpointsUnique={};_targetMaxConnections={};_targetsEnabled={};return _currentInstance;};this.makeSources=function(els,params,referenceParams){for(var i=0;i<els.length;i++){_currentInstance.makeSource(els[i],params,referenceParams);}
return _currentInstance;};var _setEnabled=function(type,el,state,toggle){var a=type=="source"?_sourcesEnabled:_targetsEnabled;if(_isString(el))a[el]=toggle?!a[el]:state;else if(el.length){el=_convertYUICollection(el);for(var i=0;i<el.length;i++){var id=_el=jsPlumb.CurrentLibrary.getElementObject(el[i]),id=_getId(_el);a[id]=toggle?!a[id]:state;}}
return _currentInstance;};this.setSourceEnabled=function(el,state){return _setEnabled("source",el,state);};this.toggleSourceEnabled=function(el){_setEnabled("source",el,null,true);return _currentInstance.isSourceEnabled(el);};this.isSource=function(el){el=jsPlumb.CurrentLibrary.getElementObject(el);return _sourcesEnabled[_getId(el)]!=null;};this.isSourceEnabled=function(el){el=jsPlumb.CurrentLibrary.getElementObject(el);return _sourcesEnabled[_getId(el)]===true;};this.setTargetEnabled=function(el,state){return _setEnabled("target",el,state);};this.toggleTargetEnabled=function(el){return _setEnabled("target",el,null,true);return _currentInstance.isTargetEnabled(el);};this.isTarget=function(el){el=jsPlumb.CurrentLibrary.getElementObject(el);return _targetsEnabled[_getId(el)]!=null;};this.isTargetEnabled=function(el){el=jsPlumb.CurrentLibrary.getElementObject(el);return _targetsEnabled[_getId(el)]===true;};this.ready=function(fn){_currentInstance.bind("ready",fn);},this.repaint=function(el,ui,timestamp){if(typeof el=='object')
for(var i=0;i<el.length;i++){_draw(_getElementObject(el),ui,timestamp);}
else
_draw(_getElementObject(el),ui,timestamp);};this.repaintEverything=function(){for(var elId in endpointsByElement){_draw(_getElementObject(elId),null,null);}};this.removeAllEndpoints=function(el){var elId=_getAttribute(el,"id"),ebe=endpointsByElement[elId];if(ebe){for(var i=0;i<ebe.length;i++)
_currentInstance.deleteEndpoint(ebe[i]);}
endpointsByElement[elId]=[];};this.removeEveryEndpoint=this.deleteEveryEndpoint;this.removeEndpoint=function(el,endpoint){_currentInstance.deleteEndpoint(endpoint);};var _registeredListeners={},_unbindRegisteredListeners=function(){for(var i in _registeredListeners){for(var j=0;j<_registeredListeners[i].length;j++){var info=_registeredListeners[i][j];jsPlumb.CurrentLibrary.unbind(info.el,info.event,info.listener);}}
_registeredListeners={};};this.registerListener=function(el,type,listener){jsPlumb.CurrentLibrary.bind(el,type,listener);_addToList(_registeredListeners,type,{el:el,event:type,listener:listener});};this.unregisterListener=function(el,type,listener){jsPlumb.CurrentLibrary.unbind(el,type,listener);_removeWithFunction(_registeredListeners,function(rl){return rl.type==type&&rl.listener==listener;});};this.reset=function(){_currentInstance.deleteEveryEndpoint();_currentInstance.unbind();_targetEndpointDefinitions={};_targetEndpoints={};_targetEndpointsUnique={};_targetMaxConnections={};_sourceEndpointDefinitions={};_sourceEndpoints={};_sourceEndpointsUnique={};_sourceMaxConnections={};_unbindRegisteredListeners();_currentInstance.anchorManager.reset();if(!jsPlumbAdapter.headless)
_currentInstance.dragManager.reset();};this.setDefaultScope=function(scope){DEFAULT_SCOPE=scope;};this.setDraggable=_setDraggable;this.setId=function(el,newId,doNotSetAttribute){var id=el.constructor==String?el:_currentInstance.getId(el),sConns=_currentInstance.getConnections({source:id,scope:'*'},true),tConns=_currentInstance.getConnections({target:id,scope:'*'},true);newId=""+newId;if(!doNotSetAttribute){el=jsPlumb.CurrentLibrary.getElementObject(id);jsPlumb.CurrentLibrary.setAttribute(el,"id",newId);}
el=jsPlumb.CurrentLibrary.getElementObject(newId);endpointsByElement[newId]=endpointsByElement[id]||[];for(var i=0;i<endpointsByElement[newId].length;i++){endpointsByElement[newId][i].elementId=newId;endpointsByElement[newId][i].element=el;endpointsByElement[newId][i].anchor.elementId=newId;}
delete endpointsByElement[id];_currentInstance.anchorManager.changeId(id,newId);var _conns=function(list,epIdx,type){for(var i=0;i<list.length;i++){list[i].endpoints[epIdx].elementId=newId;list[i].endpoints[epIdx].element=el;list[i][type+"Id"]=newId;list[i][type]=el;}};_conns(sConns,0,"source");_conns(tConns,1,"target");};this.setIdChanged=function(oldId,newId){_currentInstance.setId(oldId,newId,true);};this.setDebugLog=function(debugLog){log=debugLog;};this.setRepaintFunction=function(f){repaintFunction=f;};var _suspendDrawing=false;this.setSuspendDrawing=function(val,repaintAfterwards){_suspendDrawing=val;if(repaintAfterwards)_currentInstance.repaintEverything();};this.isSuspendDrawing=function(){return _suspendDrawing;};this.CANVAS="canvas";this.SVG="svg";this.VML="vml";this.setRenderMode=function(mode){renderMode=jsPlumbAdapter.setRenderMode(mode);return renderMode;};this.getRenderMode=function(){return renderMode;};this.show=function(el,changeEndpoints){_setVisible(el,"block",changeEndpoints);};this.sizeCanvas=function(canvas,x,y,w,h){if(canvas){canvas.style.height=h+"px";canvas.height=h;canvas.style.width=w+"px";canvas.width=w;canvas.style.left=x+"px";canvas.style.top=y+"px";}};this.getTestHarness=function(){return{endpointsByElement:endpointsByElement,endpointCount:function(elId){var e=endpointsByElement[elId];return e?e.length:0;},connectionCount:function(scope){scope=scope||DEFAULT_SCOPE;var c=connectionsByScope[scope];return c?c.length:0;},getId:_getId,makeAnchor:self.makeAnchor,makeDynamicAnchor:self.makeDynamicAnchor};};this.toggle=_toggleVisible;this.toggleVisible=_toggleVisible;this.toggleDraggable=_toggleDraggable;this.unload=function(){};this.wrap=_wrap;this.addListener=this.bind;var adjustForParentOffsetAndScroll=function(xy,el){var offsetParent=null,result=xy;if(el.tagName.toLowerCase()==="svg"&&el.parentNode){offsetParent=el.parentNode;}
else if(el.offsetParent){offsetParent=el.offsetParent;}
if(offsetParent!=null){var po=offsetParent.tagName.toLowerCase()==="body"?{left:0,top:0}:_getOffset(offsetParent),so=offsetParent.tagName.toLowerCase()==="body"?{left:0,top:0}:{left:offsetParent.scrollLeft,top:offsetParent.scrollTop};result[0]=xy[0]-po.left+so.left;result[1]=xy[1]-po.top+so.top;}
return result;};var Anchor=function(params){var self=this;this.x=params.x||0;this.y=params.y||0;this.elementId=params.elementId;var orientation=params.orientation||[0,0];var lastTimestamp=null,lastReturnValue=null;this.offsets=params.offsets||[0,0];self.timestamp=null;this.compute=function(params){var xy=params.xy,wh=params.wh,element=params.element,timestamp=params.timestamp;if(timestamp&&timestamp===self.timestamp)
return lastReturnValue;lastReturnValue=[xy[0]+(self.x*wh[0])+self.offsets[0],xy[1]+(self.y*wh[1])+self.offsets[1]];lastReturnValue=adjustForParentOffsetAndScroll(lastReturnValue,element.canvas);self.timestamp=timestamp;return lastReturnValue;};this.getOrientation=function(_endpoint){return orientation;};this.equals=function(anchor){if(!anchor)return false;var ao=anchor.getOrientation();var o=this.getOrientation();return this.x==anchor.x&&this.y==anchor.y&&this.offsets[0]==anchor.offsets[0]&&this.offsets[1]==anchor.offsets[1]&&o[0]==ao[0]&&o[1]==ao[1];};this.getCurrentLocation=function(){return lastReturnValue;};};var FloatingAnchor=function(params){var ref=params.reference,refCanvas=params.referenceCanvas,size=_getSize(_getElementObject(refCanvas)),xDir=0,yDir=0,orientation=null,_lastResult=null;this.x=0;this.y=0;this.isFloating=true;this.compute=function(params){var xy=params.xy,element=params.element,result=[xy[0]+(size[0]/2),xy[1]+(size[1]/2)];result=adjustForParentOffsetAndScroll(result,element.canvas);_lastResult=result;return result;};this.getOrientation=function(_endpoint){if(orientation)return orientation;else{var o=ref.getOrientation(_endpoint);return[Math.abs(o[0])*xDir*-1,Math.abs(o[1])*yDir*-1];}};this.over=function(anchor){orientation=anchor.getOrientation();};this.out=function(){orientation=null;};this.getCurrentLocation=function(){return _lastResult;};};var DynamicAnchor=function(anchors,anchorSelector,elementId){this.isSelective=true;this.isDynamic=true;var _anchors=[],self=this,_convert=function(anchor){return anchor.constructor==Anchor?anchor:_currentInstance.makeAnchor(anchor,elementId,_currentInstance);};for(var i=0;i<anchors.length;i++)
_anchors[i]=_convert(anchors[i]);this.addAnchor=function(anchor){_anchors.push(_convert(anchor));};this.getAnchors=function(){return _anchors;};this.locked=false;var _curAnchor=_anchors.length>0?_anchors[0]:null,_curIndex=_anchors.length>0?0:-1,self=this,_distance=function(anchor,cx,cy,xy,wh){var ax=xy[0]+(anchor.x*wh[0]),ay=xy[1]+(anchor.y*wh[1]);return Math.sqrt(Math.pow(cx-ax,2)+Math.pow(cy-ay,2));},_anchorSelector=anchorSelector||function(xy,wh,txy,twh,anchors){var cx=txy[0]+(twh[0]/2),cy=txy[1]+(twh[1]/2);var minIdx=-1,minDist=Infinity;for(var i=0;i<anchors.length;i++){var d=_distance(anchors[i],cx,cy,xy,wh);if(d<minDist){minIdx=i+0;minDist=d;}}
return anchors[minIdx];};this.compute=function(params){var xy=params.xy,wh=params.wh,timestamp=params.timestamp,txy=params.txy,twh=params.twh;if(self.locked||txy==null||twh==null)
return _curAnchor.compute(params);else
params.timestamp=null;_curAnchor=_anchorSelector(xy,wh,txy,twh,_anchors);self.x=_curAnchor.x;self.y=_curAnchor.y;return _curAnchor.compute(params);};this.getCurrentLocation=function(){return _curAnchor!=null?_curAnchor.getCurrentLocation():null;};this.getOrientation=function(_endpoint){return _curAnchor!=null?_curAnchor.getOrientation(_endpoint):[0,0];};this.over=function(anchor){if(_curAnchor!=null)_curAnchor.over(anchor);};this.out=function(){if(_curAnchor!=null)_curAnchor.out();};};var continuousAnchors={},continuousAnchorLocations={},continuousAnchorOrientations={},Orientation={HORIZONTAL:"horizontal",VERTICAL:"vertical",DIAGONAL:"diagonal",IDENTITY:"identity"},calculateOrientation=function(sourceId,targetId,sd,td){if(sourceId===targetId)return{orientation:Orientation.IDENTITY,a:["top","top"]};var theta=Math.atan2((td.centery-sd.centery),(td.centerx-sd.centerx)),theta2=Math.atan2((sd.centery-td.centery),(sd.centerx-td.centerx)),h=((sd.left<=td.left&&sd.right>=td.left)||(sd.left<=td.right&&sd.right>=td.right)||(sd.left<=td.left&&sd.right>=td.right)||(td.left<=sd.left&&td.right>=sd.right)),v=((sd.top<=td.top&&sd.bottom>=td.top)||(sd.top<=td.bottom&&sd.bottom>=td.bottom)||(sd.top<=td.top&&sd.bottom>=td.bottom)||(td.top<=sd.top&&td.bottom>=sd.bottom));if(!(h||v)){var a=null,rls=false,rrs=false,sortValue=null;if(td.left>sd.left&&td.top>sd.top)
a=["right","top"];else if(td.left>sd.left&&sd.top>td.top)
a=["top","left"];else if(td.left<sd.left&&td.top<sd.top)
a=["top","right"];else if(td.left<sd.left&&td.top>sd.top)
a=["left","top"];return{orientation:Orientation.DIAGONAL,a:a,theta:theta,theta2:theta2};}
else if(h)return{orientation:Orientation.HORIZONTAL,a:sd.top<td.top?["bottom","top"]:["top","bottom"],theta:theta,theta2:theta2}
else return{orientation:Orientation.VERTICAL,a:sd.left<td.left?["right","left"]:["left","right"],theta:theta,theta2:theta2}},placeAnchorsOnLine=function(desc,elementDimensions,elementPosition,connections,horizontal,otherMultiplier,reverse){var a=[],step=elementDimensions[horizontal?0:1]/(connections.length+1);for(var i=0;i<connections.length;i++){var val=(i+1)*step,other=otherMultiplier*elementDimensions[horizontal?1:0];if(reverse)
val=elementDimensions[horizontal?0:1]-val;var dx=(horizontal?val:other),x=elementPosition[0]+dx,xp=dx/elementDimensions[0],dy=(horizontal?other:val),y=elementPosition[1]+dy,yp=dy/elementDimensions[1];a.push([x,y,xp,yp,connections[i][1],connections[i][2]]);}
return a;},standardEdgeSort=function(a,b){return a[0]>b[0]?1:-1},currySort=function(reverseAngles){return function(a,b){var r=true;if(reverseAngles){if(a[0][0]<b[0][0])
r=true;else
r=a[0][1]>b[0][1];}
else{if(a[0][0]>b[0][0])
r=true;else
r=a[0][1]>b[0][1];}
return r===false?-1:1;};},leftSort=function(a,b){var p1=a[0][0]<0?-Math.PI-a[0][0]:Math.PI-a[0][0],p2=b[0][0]<0?-Math.PI-b[0][0]:Math.PI-b[0][0];if(p1>p2)return 1;else return a[0][1]>b[0][1]?1:-1;},edgeSortFunctions={"top":standardEdgeSort,"right":currySort(true),"bottom":currySort(true),"left":leftSort},_sortHelper=function(_array,_fn){return _array.sort(_fn);},placeAnchors=function(elementId,_anchorLists){var sS=sizes[elementId],sO=offsets[elementId],placeSomeAnchors=function(desc,elementDimensions,elementPosition,unsortedConnections,isHorizontal,otherMultiplier,orientation){if(unsortedConnections.length>0){var sc=_sortHelper(unsortedConnections,edgeSortFunctions[desc]),reverse=desc==="right"||desc==="top",anchors=placeAnchorsOnLine(desc,elementDimensions,elementPosition,sc,isHorizontal,otherMultiplier,reverse);var _setAnchorLocation=function(endpoint,anchorPos){var a=adjustForParentOffsetAndScroll([anchorPos[0],anchorPos[1]],endpoint.canvas);continuousAnchorLocations[endpoint.id]=[a[0],a[1],anchorPos[2],anchorPos[3]];continuousAnchorOrientations[endpoint.id]=orientation;};for(var i=0;i<anchors.length;i++){var c=anchors[i][4],weAreSource=c.endpoints[0].elementId===elementId,weAreTarget=c.endpoints[1].elementId===elementId;if(weAreSource)
_setAnchorLocation(c.endpoints[0],anchors[i]);else if(weAreTarget)
_setAnchorLocation(c.endpoints[1],anchors[i]);}}};placeSomeAnchors("bottom",sS,[sO.left,sO.top],_anchorLists.bottom,true,1,[0,1]);placeSomeAnchors("top",sS,[sO.left,sO.top],_anchorLists.top,true,0,[0,-1]);placeSomeAnchors("left",sS,[sO.left,sO.top],_anchorLists.left,false,0,[-1,0]);placeSomeAnchors("right",sS,[sO.left,sO.top],_anchorLists.right,false,1,[1,0]);},AnchorManager=function(){var _amEndpoints={},connectionsByElementId={},self=this,anchorLists={};this.reset=function(){_amEndpoints={};connectionsByElementId={};anchorLists={};};this.newConnection=function(conn){var sourceId=conn.sourceId,targetId=conn.targetId,ep=conn.endpoints,doRegisterTarget=true,registerConnection=function(otherIndex,otherEndpoint,otherAnchor,elId,c){if((sourceId==targetId)&&otherAnchor.isContinuous){jsPlumb.CurrentLibrary.removeElement(ep[1].canvas);doRegisterTarget=false;}
_addToList(connectionsByElementId,elId,[c,otherEndpoint,otherAnchor.constructor==DynamicAnchor]);};registerConnection(0,ep[0],ep[0].anchor,targetId,conn);if(doRegisterTarget)
registerConnection(1,ep[1],ep[1].anchor,sourceId,conn);};this.connectionDetached=function(connInfo){var connection=connInfo.connection||connInfo;var sourceId=connection.sourceId,targetId=connection.targetId,ep=connection.endpoints,removeConnection=function(otherIndex,otherEndpoint,otherAnchor,elId,c){if(otherAnchor.constructor==FloatingAnchor){}
else{_removeWithFunction(connectionsByElementId[elId],function(_c){return _c[0].id==c.id;});}};removeConnection(1,ep[1],ep[1].anchor,sourceId,connection);removeConnection(0,ep[0],ep[0].anchor,targetId,connection);var sEl=connection.sourceId,tEl=connection.targetId,sE=connection.endpoints[0].id,tE=connection.endpoints[1].id,_remove=function(list,eId){if(list){var f=function(e){return e[4]==eId;};_removeWithFunction(list["top"],f);_removeWithFunction(list["left"],f);_removeWithFunction(list["bottom"],f);_removeWithFunction(list["right"],f);}};_remove(anchorLists[sEl],sE);_remove(anchorLists[tEl],tE);self.redraw(sEl);self.redraw(tEl);};this.add=function(endpoint,elementId){_addToList(_amEndpoints,elementId,endpoint);};this.changeId=function(oldId,newId){connectionsByElementId[newId]=connectionsByElementId[oldId];_amEndpoints[newId]=_amEndpoints[oldId];delete connectionsByElementId[oldId];delete _amEndpoints[oldId];};this.getConnectionsFor=function(elementId){return connectionsByElementId[elementId]||[];};this.getEndpointsFor=function(elementId){return _amEndpoints[elementId]||[];};this.deleteEndpoint=function(endpoint){_removeWithFunction(_amEndpoints[endpoint.elementId],function(e){return e.id==endpoint.id;});};this.clearFor=function(elementId){delete _amEndpoints[elementId];_amEndpoints[elementId]=[];};var _updateAnchorList=function(lists,theta,order,conn,aBoolean,otherElId,idx,reverse,edgeId,elId,connsToPaint,endpointsToPaint){var exactIdx=-1,firstMatchingElIdx=-1,endpoint=conn.endpoints[idx],endpointId=endpoint.id,oIdx=[1,0][idx],values=[[theta,order],conn,aBoolean,otherElId,endpointId],listToAddTo=lists[edgeId],listToRemoveFrom=endpoint._continuousAnchorEdge?lists[endpoint._continuousAnchorEdge]:null;if(listToRemoveFrom){var rIdx=_findWithFunction(listToRemoveFrom,function(e){return e[4]==endpointId});if(rIdx!=-1){listToRemoveFrom.splice(rIdx,1);for(var i=0;i<listToRemoveFrom.length;i++){_addWithFunction(connsToPaint,listToRemoveFrom[i][1],function(c){return c.id==listToRemoveFrom[i][1].id});_addWithFunction(endpointsToPaint,listToRemoveFrom[i][1].endpoints[idx],function(e){return e.id==listToRemoveFrom[i][1].endpoints[idx].id});}}}
for(var i=0;i<listToAddTo.length;i++){if(idx==1&&listToAddTo[i][3]===otherElId&&firstMatchingElIdx==-1)
firstMatchingElIdx=i;_addWithFunction(connsToPaint,listToAddTo[i][1],function(c){return c.id==listToAddTo[i][1].id});_addWithFunction(endpointsToPaint,listToAddTo[i][1].endpoints[idx],function(e){return e.id==listToAddTo[i][1].endpoints[idx].id});}
if(exactIdx!=-1){listToAddTo[exactIdx]=values;}
else{var insertIdx=reverse?firstMatchingElIdx!=-1?firstMatchingElIdx:0:listToAddTo.length;listToAddTo.splice(insertIdx,0,values);}
endpoint._continuousAnchorEdge=edgeId;};this.redraw=function(elementId,ui,timestamp,offsetToUI){if(!_suspendDrawing){var ep=_amEndpoints[elementId]||[],endpointConnections=connectionsByElementId[elementId]||[],connectionsToPaint=[],endpointsToPaint=[],anchorsToUpdate=[];timestamp=timestamp||_timestamp();offsetToUI=offsetToUI||{left:0,top:0};if(ui){ui={left:ui.left+offsetToUI.left,top:ui.top+offsetToUI.top}}
_updateOffset({elId:elementId,offset:ui,recalc:false,timestamp:timestamp});var myOffset=offsets[elementId],myWH=sizes[elementId],orientationCache={};for(var i=0;i<endpointConnections.length;i++){var conn=endpointConnections[i][0],sourceId=conn.sourceId,targetId=conn.targetId,sourceContinuous=conn.endpoints[0].anchor.isContinuous,targetContinuous=conn.endpoints[1].anchor.isContinuous;if(sourceContinuous||targetContinuous){var oKey=sourceId+"_"+targetId,oKey2=targetId+"_"+sourceId,o=orientationCache[oKey],oIdx=conn.sourceId==elementId?1:0;if(sourceContinuous&&!anchorLists[sourceId])anchorLists[sourceId]={top:[],right:[],bottom:[],left:[]};if(targetContinuous&&!anchorLists[targetId])anchorLists[targetId]={top:[],right:[],bottom:[],left:[]};if(elementId!=targetId)_updateOffset({elId:targetId,timestamp:timestamp});if(elementId!=sourceId)_updateOffset({elId:sourceId,timestamp:timestamp});var td=_getCachedData(targetId),sd=_getCachedData(sourceId);if(targetId==sourceId&&(sourceContinuous||targetContinuous)){_updateAnchorList(anchorLists[sourceId],-Math.PI/2,0,conn,false,targetId,0,false,"top",sourceId,connectionsToPaint,endpointsToPaint)}
else{if(!o){o=calculateOrientation(sourceId,targetId,sd.o,td.o);orientationCache[oKey]=o;}
if(sourceContinuous)_updateAnchorList(anchorLists[sourceId],o.theta,0,conn,false,targetId,0,false,o.a[0],sourceId,connectionsToPaint,endpointsToPaint);if(targetContinuous)_updateAnchorList(anchorLists[targetId],o.theta2,-1,conn,true,sourceId,1,true,o.a[1],targetId,connectionsToPaint,endpointsToPaint);}
if(sourceContinuous)_addWithFunction(anchorsToUpdate,sourceId,function(a){return a===sourceId;});if(targetContinuous)_addWithFunction(anchorsToUpdate,targetId,function(a){return a===targetId;});_addWithFunction(connectionsToPaint,conn,function(c){return c.id==conn.id;});if((sourceContinuous&&oIdx==0)||(targetContinuous&&oIdx==1))
_addWithFunction(endpointsToPaint,conn.endpoints[oIdx],function(e){return e.id==conn.endpoints[oIdx].id;});}}
for(var i=0;i<ep.length;i++){if(ep[i].connections.length==0&&ep[i].anchor.isContinuous){if(!anchorLists[elementId])anchorLists[elementId]={top:[],right:[],bottom:[],left:[]};_updateAnchorList(anchorLists[elementId],-Math.PI/2,0,{endpoints:[ep[i],ep[i]],paint:function(){}},false,elementId,0,false,"top",elementId,connectionsToPaint,endpointsToPaint)
_addWithFunction(anchorsToUpdate,elementId,function(a){return a===elementId;})}}
for(var i=0;i<anchorsToUpdate.length;i++){placeAnchors(anchorsToUpdate[i],anchorLists[anchorsToUpdate[i]]);}
for(var i=0;i<ep.length;i++){ep[i].paint({timestamp:timestamp,offset:myOffset,dimensions:myWH});}
for(var i=0;i<endpointsToPaint.length;i++){endpointsToPaint[i].paint({timestamp:timestamp,offset:myOffset,dimensions:myWH});}
for(var i=0;i<endpointConnections.length;i++){var otherEndpoint=endpointConnections[i][1];if(otherEndpoint.anchor.constructor==DynamicAnchor){otherEndpoint.paint({elementWithPrecedence:elementId});_addWithFunction(connectionsToPaint,endpointConnections[i][0],function(c){return c.id==endpointConnections[i][0].id;});for(var k=0;k<otherEndpoint.connections.length;k++){if(otherEndpoint.connections[k]!==endpointConnections[i][0])
_addWithFunction(connectionsToPaint,otherEndpoint.connections[k],function(c){return c.id==otherEndpoint.connections[k].id;});}}else if(otherEndpoint.anchor.constructor==Anchor){_addWithFunction(connectionsToPaint,endpointConnections[i][0],function(c){return c.id==endpointConnections[i][0].id;});}}
var fc=floatingConnections[elementId];if(fc)
fc.paint({timestamp:timestamp,recalc:false,elId:elementId});for(var i=0;i<connectionsToPaint.length;i++){connectionsToPaint[i].paint({elId:elementId,timestamp:timestamp,recalc:false});}}};this.rehomeEndpoint=function(currentId,element){var eps=_amEndpoints[currentId]||[],elementId=_currentInstance.getId(element);for(var i=0;i<eps.length;i++){self.add(eps[i],elementId);}
eps.splice(0,eps.length);};};_currentInstance.anchorManager=new AnchorManager();_currentInstance.continuousAnchorFactory={get:function(params){var existing=continuousAnchors[params.elementId];if(!existing){existing={type:"Continuous",compute:function(params){return continuousAnchorLocations[params.element.id]||[0,0];},getCurrentLocation:function(endpoint){return continuousAnchorLocations[endpoint.id]||[0,0];},getOrientation:function(endpoint){return continuousAnchorOrientations[endpoint.id]||[0,0];},isDynamic:true,isContinuous:true};continuousAnchors[params.elementId]=existing;}
return existing;}};if(!jsPlumbAdapter.headless)
_currentInstance.dragManager=jsPlumbAdapter.getDragManager(_currentInstance);var Connection=function(params){var self=this,visible=true,_internalHover,_superClassHover;self.idPrefix="_jsplumb_c_";self.defaultLabelLocation=0.5;self.defaultOverlayKeys=["Overlays","ConnectionOverlays"];this.parent=params.parent;overlayCapableJsPlumbUIComponent.apply(this,arguments);this.isVisible=function(){return visible;};this.setVisible=function(v){visible=v;self[v?"showOverlays":"hideOverlays"]();if(self.connector&&self.connector.canvas)self.connector.canvas.style.display=v?"block":"none";self.repaint();};this.getTypeDescriptor=function(){return"connection";};this.getDefaultType=function(){return{parameters:{},scope:null,detachable:self._jsPlumb.Defaults.ConnectionsDetachable,paintStyle:self._jsPlumb.Defaults.PaintStyle||jsPlumb.Defaults.PaintStyle,connector:self._jsPlumb.Defaults.Connector||jsPlumb.Defaults.Connector,hoverPaintStyle:self._jsPlumb.Defaults.HoverPaintStyle||jsPlumb.Defaults.HoverPaintStyle,overlays:self._jsPlumb.Defaults.ConnectorOverlays||jsPlumb.Defaults.ConnectorOverlays};};var superAt=this.applyType;this.applyType=function(t){superAt(t);if(t.detachable!=null)self.setDetachable(t.detachable);if(t.scope)self.scope=t.scope;self.setConnector(t.connector);};_superClassHover=self.setHover;self.setHover=function(state){var zi=_currentInstance.ConnectorZIndex||jsPlumb.Defaults.ConnectorZIndex;if(zi)
self.connector.setZIndex(zi+(state?1:0));self.connector.setHover.apply(self.connector,arguments);_superClassHover.apply(self,arguments);};_internalHover=function(state){if(_connectionBeingDragged==null){self.setHover(state,false);}};this.setConnector=function(connector,doNotRepaint){if(self.connector!=null)_removeElements(self.connector.getDisplayElements(),self.parent);var connectorArgs={_jsPlumb:self._jsPlumb,parent:params.parent,cssClass:params.cssClass,container:params.container,tooltip:self.tooltip};if(_isString(connector))
this.connector=new jsPlumb.Connectors[renderMode][connector](connectorArgs);else if(_isArray(connector)){if(connector.length==1)
this.connector=new jsPlumb.Connectors[renderMode][connector[0]](connectorArgs);else
this.connector=new jsPlumb.Connectors[renderMode][connector[0]](jsPlumb.extend(connector[1],connectorArgs));}
self.canvas=self.connector.canvas;_bindListeners(self.connector,self,_internalHover);var zi=_currentInstance.ConnectorZIndex||jsPlumb.Defaults.ConnectorZIndex;if(zi)
self.connector.setZIndex(zi);if(!doNotRepaint)self.repaint();};this.source=_getElementObject(params.source);this.target=_getElementObject(params.target);if(params.sourceEndpoint)this.source=params.sourceEndpoint.endpointWillMoveTo||params.sourceEndpoint.getElement();if(params.targetEndpoint)this.target=params.targetEndpoint.getElement();self.previousConnection=params.previousConnection;this.sourceId=_getAttribute(this.source,"id");this.targetId=_getAttribute(this.target,"id");this.scope=params.scope;this.endpoints=[];this.endpointStyles=[];var _makeAnchor=function(anchorParams,elementId){return(anchorParams)?_currentInstance.makeAnchor(anchorParams,elementId,_currentInstance):null;},prepareEndpoint=function(existing,index,params,element,elementId,connectorPaintStyle,connectorHoverPaintStyle){var e;if(existing){self.endpoints[index]=existing;existing.addConnection(self);}else{if(!params.endpoints)params.endpoints=[null,null];var ep=params.endpoints[index]||params.endpoint||_currentInstance.Defaults.Endpoints[index]||jsPlumb.Defaults.Endpoints[index]||_currentInstance.Defaults.Endpoint||jsPlumb.Defaults.Endpoint;if(!params.endpointStyles)params.endpointStyles=[null,null];if(!params.endpointHoverStyles)params.endpointHoverStyles=[null,null];var es=params.endpointStyles[index]||params.endpointStyle||_currentInstance.Defaults.EndpointStyles[index]||jsPlumb.Defaults.EndpointStyles[index]||_currentInstance.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle;if(es.fillStyle==null&&connectorPaintStyle!=null)
es.fillStyle=connectorPaintStyle.strokeStyle;if(es.outlineColor==null&&connectorPaintStyle!=null)
es.outlineColor=connectorPaintStyle.outlineColor;if(es.outlineWidth==null&&connectorPaintStyle!=null)
es.outlineWidth=connectorPaintStyle.outlineWidth;var ehs=params.endpointHoverStyles[index]||params.endpointHoverStyle||_currentInstance.Defaults.EndpointHoverStyles[index]||jsPlumb.Defaults.EndpointHoverStyles[index]||_currentInstance.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyle;if(connectorHoverPaintStyle!=null){if(ehs==null)ehs={};if(ehs.fillStyle==null){ehs.fillStyle=connectorHoverPaintStyle.strokeStyle;}}
var a=params.anchors?params.anchors[index]:params.anchor?params.anchor:_makeAnchor(_currentInstance.Defaults.Anchors[index],elementId)||_makeAnchor(jsPlumb.Defaults.Anchors[index],elementId)||_makeAnchor(_currentInstance.Defaults.Anchor,elementId)||_makeAnchor(jsPlumb.Defaults.Anchor,elementId),u=params.uuids?params.uuids[index]:null;e=_newEndpoint({paintStyle:es,hoverPaintStyle:ehs,endpoint:ep,connections:[self],uuid:u,anchor:a,source:element,scope:params.scope,container:params.container,reattach:params.reattach,detachable:params.detachable});self.endpoints[index]=e;if(params.drawEndpoints===false)e.setVisible(false,true,true);}
return e;};var eS=prepareEndpoint(params.sourceEndpoint,0,params,self.source,self.sourceId,params.paintStyle,params.hoverPaintStyle);if(eS)_addToList(endpointsByElement,this.sourceId,eS);var eT=prepareEndpoint(params.targetEndpoint,1,params,self.target,self.targetId,params.paintStyle,params.hoverPaintStyle);if(eT)_addToList(endpointsByElement,this.targetId,eT);if(!this.scope)this.scope=this.endpoints[0].scope;if(params.deleteEndpointsOnDetach)
self.endpointsToDeleteOnDetach=[eS,eT];self.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||params.connector||_currentInstance.Defaults.Connector||jsPlumb.Defaults.Connector,true);this.setPaintStyle(this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||params.paintStyle||_currentInstance.Defaults.PaintStyle||jsPlumb.Defaults.PaintStyle,true);this.setHoverPaintStyle(this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||params.hoverPaintStyle||_currentInstance.Defaults.HoverPaintStyle||jsPlumb.Defaults.HoverPaintStyle,true);this.paintStyleInUse=this.getPaintStyle();_updateOffset({elId:this.sourceId});_updateOffset({elId:this.targetId});var myOffset=offsets[this.sourceId],myWH=sizes[this.sourceId],otherOffset=offsets[this.targetId],otherWH=sizes[this.targetId],initialTimestamp=_timestamp(),anchorLoc=this.endpoints[0].anchor.compute({xy:[myOffset.left,myOffset.top],wh:myWH,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[otherOffset.left,otherOffset.top],twh:otherWH,tElement:this.endpoints[1],timestamp:initialTimestamp});this.endpoints[0].paint({anchorLoc:anchorLoc,timestamp:initialTimestamp});anchorLoc=this.endpoints[1].anchor.compute({xy:[otherOffset.left,otherOffset.top],wh:otherWH,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[myOffset.left,myOffset.top],twh:myWH,tElement:this.endpoints[0],timestamp:initialTimestamp});this.endpoints[1].paint({anchorLoc:anchorLoc,timestamp:initialTimestamp});var _detachable=_currentInstance.Defaults.ConnectionsDetachable;if(params.detachable===false)_detachable=false;if(self.endpoints[0].connectionsDetachable===false)_detachable=false;if(self.endpoints[1].connectionsDetachable===false)_detachable=false;this.isDetachable=function(){return _detachable===true;};this.setDetachable=function(detachable){_detachable=detachable===true;};var _cost=params.cost||self.endpoints[0].getConnectionCost();self.getCost=function(){return _cost;};self.setCost=function(c){_cost=c;};var _bidirectional=!(params.bidirectional===false);if(params.bidirectional==null)_bidirectional=self.endpoints[0].areConnectionsBidirectional();self.isBidirectional=function(){return _bidirectional;};var _p=jsPlumb.extend({},this.endpoints[0].getParameters());jsPlumb.extend(_p,this.endpoints[1].getParameters());jsPlumb.extend(_p,self.getParameters());self.setParameters(_p);this.getAttachedElements=function(){return self.endpoints;};this.moveParent=function(newParent){var jpcl=jsPlumb.CurrentLibrary,curParent=jpcl.getParent(self.connector.canvas);if(self.connector.bgCanvas){jpcl.removeElement(self.connector.bgCanvas,curParent);jpcl.appendElement(self.connector.bgCanvas,newParent);}
jpcl.removeElement(self.connector.canvas,curParent);jpcl.appendElement(self.connector.canvas,newParent);for(var i=0;i<self.overlays.length;i++){if(self.overlays[i].isAppendedAtTopLevel){jpcl.removeElement(self.overlays[i].canvas,curParent);jpcl.appendElement(self.overlays[i].canvas,newParent);if(self.overlays[i].reattachListeners)
self.overlays[i].reattachListeners(self.connector);}}
if(self.connector.reattachListeners)
self.connector.reattachListeners();};this.paint=function(params){if(visible){params=params||{};var elId=params.elId,ui=params.ui,recalc=params.recalc,timestamp=params.timestamp,swap=false,tId=swap?this.sourceId:this.targetId,sId=swap?this.targetId:this.sourceId,tIdx=swap?0:1,sIdx=swap?1:0;var sourceInfo=_updateOffset({elId:elId,offset:ui,recalc:recalc,timestamp:timestamp}),targetInfo=_updateOffset({elId:tId,timestamp:timestamp});var sE=this.endpoints[sIdx],tE=this.endpoints[tIdx],sAnchorP=sE.anchor.getCurrentLocation(sE),tAnchorP=tE.anchor.getCurrentLocation(tE);var maxSize=0;for(var i=0;i<self.overlays.length;i++){var o=self.overlays[i];if(o.isVisible())maxSize=Math.max(maxSize,o.computeMaxSize());}
var dim=this.connector.compute(sAnchorP,tAnchorP,this.endpoints[sIdx],this.endpoints[tIdx],this.endpoints[sIdx].anchor,this.endpoints[tIdx].anchor,self.paintStyleInUse.lineWidth,maxSize,sourceInfo,targetInfo);self.connector.paint(dim,self.paintStyleInUse);for(var i=0;i<self.overlays.length;i++){var o=self.overlays[i];if(o.isVisible)self.overlayPlacements[i]=o.draw(self.connector,self.paintStyleInUse,dim);}}};this.repaint=function(params){params=params||{};var recalc=!(params.recalc===false);this.paint({elId:this.sourceId,recalc:recalc,timestamp:params.timestamp});};var _type=params.type||self.endpoints[0].connectionType||self.endpoints[1].connectionType;if(_type)
self.setType(_type);};var _makeConnectionDragHandler=function(placeholder){var stopped=false;return{drag:function(){if(stopped){stopped=false;return true;}
var _ui=jsPlumb.CurrentLibrary.getUIPosition(arguments),el=placeholder.element;if(el){jsPlumb.CurrentLibrary.setOffset(el,_ui);_draw(_getElementObject(el),_ui);}},stopDrag:function(){stopped=true;}};};var _makeFloatingEndpoint=function(paintStyle,referenceAnchor,endpoint,referenceCanvas,sourceElement){var floatingAnchor=new FloatingAnchor({reference:referenceAnchor,referenceCanvas:referenceCanvas});return _newEndpoint({paintStyle:paintStyle,endpoint:endpoint,anchor:floatingAnchor,source:sourceElement,scope:"__floating"});};var _makeDraggablePlaceholder=function(placeholder,parent){var n=document.createElement("div");n.style.position="absolute";var placeholderDragElement=_getElementObject(n);_appendElement(n,parent);var id=_getId(placeholderDragElement);_updateOffset({elId:id});placeholder.id=id;placeholder.element=placeholderDragElement;};var Endpoint=function(params){var self=this;self.idPrefix="_jsplumb_e_";self.defaultLabelLocation=[0.5,0.5];self.defaultOverlayKeys=["Overlays","EndpointOverlays"];this.parent=params.parent;overlayCapableJsPlumbUIComponent.apply(this,arguments);params=params||{};this.getTypeDescriptor=function(){return"endpoint";};this.getDefaultType=function(){return{parameters:{},scope:null,maxConnections:self._jsPlumb.Defaults.MaxConnections,paintStyle:self._jsPlumb.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle,endpoint:self._jsPlumb.Defaults.Endpoint||jsPlumb.Defaults.Endpoint,hoverPaintStyle:self._jsPlumb.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyle,overlays:self._jsPlumb.Defaults.EndpointOverlays||jsPlumb.Defaults.EndpointOverlays,connectorStyle:params.connectorStyle,connectorHoverStyle:params.connectorHoverStyle,connectorClass:params.connectorClass,connectorHoverClass:params.connectorHoverClass,connectorOverlays:params.connectorOverlays,connector:params.connector,connectorTooltip:params.connectorTooltip};};var superAt=this.applyType;this.applyType=function(t){superAt(t);if(t.maxConnections!=null)_maxConnections=t.maxConnections;if(t.scope)self.scope=t.scope;self.connectorStyle=t.connectorStyle;self.connectorHoverStyle=t.connectorHoverStyle;self.connectorOverlays=t.connectorOverlays;self.connector=t.connector;self.connectorTooltip=t.connectorTooltip;self.connectionType=t.connectionType;self.connectorClass=t.connectorClass;self.connectorHoverClass=t.connectorHoverClass;};var visible=true,__enabled=!(params.enabled===false);this.isVisible=function(){return visible;};this.setVisible=function(v,doNotChangeConnections,doNotNotifyOtherEndpoint){visible=v;if(self.canvas)self.canvas.style.display=v?"block":"none";self[v?"showOverlays":"hideOverlays"]();if(!doNotChangeConnections){for(var i=0;i<self.connections.length;i++){self.connections[i].setVisible(v);if(!doNotNotifyOtherEndpoint){var oIdx=self===self.connections[i].endpoints[0]?1:0;if(self.connections[i].endpoints[oIdx].connections.length==1)self.connections[i].endpoints[oIdx].setVisible(v,true,true);}}}};this.isEnabled=function(){return __enabled;};this.setEnabled=function(e){__enabled=e;};var _element=params.source,_uuid=params.uuid,floatingEndpoint=null,inPlaceCopy=null;if(_uuid)endpointsByUUID[_uuid]=self;var _elementId=_getAttribute(_element,"id");this.elementId=_elementId;this.element=_element;var _connectionCost=params.connectionCost;this.getConnectionCost=function(){return _connectionCost;};this.setConnectionCost=function(c){_connectionCost=c;};var _connectionsBidirectional=params.connectionsBidirectional===false?false:true;this.areConnectionsBidirectional=function(){return _connectionsBidirectional;};this.setConnectionsBidirectional=function(b){_connectionsBidirectional=b;};self.anchor=params.anchor?_currentInstance.makeAnchor(params.anchor,_elementId,_currentInstance):params.anchors?_currentInstance.makeAnchor(params.anchors,_elementId,_currentInstance):_currentInstance.makeAnchor("TopCenter",_elementId,_currentInstance);if(!params._transient)
_currentInstance.anchorManager.add(self,_elementId);var _endpoint=null,originalEndpoint=null;this.setEndpoint=function(ep){var endpointArgs={_jsPlumb:self._jsPlumb,parent:params.parent,container:params.container,tooltip:params.tooltip,connectorTooltip:params.connectorTooltip,endpoint:self};if(_isString(ep))
_endpoint=new jsPlumb.Endpoints[renderMode][ep](endpointArgs);else if(_isArray(ep)){endpointArgs=jsPlumb.extend(ep[1],endpointArgs);_endpoint=new jsPlumb.Endpoints[renderMode][ep[0]](endpointArgs);}
else{_endpoint=ep.clone();}
var argsForClone=jsPlumb.extend({},endpointArgs);_endpoint.clone=function(){var o=new Object();_endpoint.constructor.apply(o,[argsForClone]);return o;};self.endpoint=_endpoint;self.type=self.endpoint.type;};this.setEndpoint(params.endpoint||_currentInstance.Defaults.Endpoint||jsPlumb.Defaults.Endpoint||"Dot");originalEndpoint=_endpoint;var _sh=self.setHover;self.setHover=function(){self.endpoint.setHover.apply(self.endpoint,arguments);_sh.apply(self,arguments);};var internalHover=function(state){if(self.connections.length>0)
self.connections[0].setHover(state,false);else
self.setHover(state);};_bindListeners(self.endpoint,self,internalHover);this.setPaintStyle(params.paintStyle||params.style||_currentInstance.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle,true);this.setHoverPaintStyle(params.hoverPaintStyle||_currentInstance.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyle,true);this.paintStyleInUse=this.getPaintStyle();var originalPaintStyle=this.getPaintStyle();this.connectorStyle=params.connectorStyle;this.connectorHoverStyle=params.connectorHoverStyle;this.connectorOverlays=params.connectorOverlays;this.connector=params.connector;this.connectorTooltip=params.connectorTooltip;this.connectorClass=params.connectorClass;this.connectorHoverClass=params.connectorHoverClass;this.isSource=params.isSource||false;this.isTarget=params.isTarget||false;var _maxConnections=params.maxConnections||_currentInstance.Defaults.MaxConnections;this.getAttachedElements=function(){return self.connections;};this.canvas=this.endpoint.canvas;this.connections=params.connections||[];this.scope=params.scope||DEFAULT_SCOPE;this.connectionType=params.connectionType;this.timestamp=null;self.isReattach=params.reattach||false;self.connectionsDetachable=_currentInstance.Defaults.ConnectionsDetachable;if(params.connectionsDetachable===false||params.detachable===false)
self.connectionsDetachable=false;var dragAllowedWhenFull=params.dragAllowedWhenFull||true;if(params.onMaxConnections)
self.bind("maxConnections",params.onMaxConnections);this.computeAnchor=function(params){return self.anchor.compute(params);};this.addConnection=function(connection){self.connections.push(connection);};this.detach=function(connection,ignoreTarget,forceDetach,fireEvent,originalEvent){var idx=_findWithFunction(self.connections,function(c){return c.id==connection.id}),actuallyDetached=false;fireEvent=(fireEvent!==false);if(idx>=0){if(forceDetach||connection._forceDetach||connection.isDetachable()||connection.isDetachAllowed(connection)){var t=connection.endpoints[0]==self?connection.endpoints[1]:connection.endpoints[0];if(forceDetach||connection._forceDetach||(self.isDetachAllowed(connection))){self.connections.splice(idx,1);if(!ignoreTarget){t.detach(connection,true,forceDetach);if(connection.endpointsToDeleteOnDetach){for(var i=0;i<connection.endpointsToDeleteOnDetach.length;i++){var cde=connection.endpointsToDeleteOnDetach[i];if(cde&&cde.connections.length==0)
_currentInstance.deleteEndpoint(cde);}}}
_removeElements(connection.connector.getDisplayElements(),connection.parent);_removeWithFunction(connectionsByScope[connection.scope],function(c){return c.id==connection.id;});actuallyDetached=true;var doFireEvent=(!ignoreTarget&&fireEvent)
fireDetachEvent(connection,doFireEvent,originalEvent);}}}
return actuallyDetached;};this.detachAll=function(fireEvent,originalEvent){while(self.connections.length>0){self.detach(self.connections[0],false,true,fireEvent,originalEvent);}};this.detachFrom=function(targetEndpoint,fireEvent,originalEvent){var c=[];for(var i=0;i<self.connections.length;i++){if(self.connections[i].endpoints[1]==targetEndpoint||self.connections[i].endpoints[0]==targetEndpoint){c.push(self.connections[i]);}}
for(var i=0;i<c.length;i++){if(self.detach(c[i],false,true,fireEvent,originalEvent))
c[i].setHover(false,false);}};this.detachFromConnection=function(connection){var idx=_findWithFunction(self.connections,function(c){return c.id==connection.id});if(idx>=0){self.connections.splice(idx,1);}};this.getElement=function(){return _element;};this.setElement=function(el,container){var parentId=_getId(el);_removeWithFunction(endpointsByElement[self.elementId],function(e){return e.id==self.id;});_element=_getElementObject(el);_elementId=_getId(_element);self.elementId=_elementId;var newParentElement=_getParentFromParams({source:parentId,container:container}),curParent=jpcl.getParent(self.canvas);jpcl.removeElement(self.canvas,curParent);jpcl.appendElement(self.canvas,newParentElement);for(var i=0;i<self.connections.length;i++){self.connections[i].moveParent(newParentElement);self.connections[i].sourceId=_elementId;self.connections[i].source=_element;}
_addToList(endpointsByElement,parentId,self);};this.getUuid=function(){return _uuid;};this.makeInPlaceCopy=function(){var loc=self.anchor.getCurrentLocation(self),o=self.anchor.getOrientation(self),inPlaceAnchor={compute:function(){return[loc[0],loc[1]]},getCurrentLocation:function(){return[loc[0],loc[1]]},getOrientation:function(){return o;}};return _newEndpoint({anchor:inPlaceAnchor,source:_element,paintStyle:this.getPaintStyle(),endpoint:_endpoint,_transient:true,scope:self.scope});};this.isConnectedTo=function(endpoint){var found=false;if(endpoint){for(var i=0;i<self.connections.length;i++){if(self.connections[i].endpoints[1]==endpoint){found=true;break;}}}
return found;};this.isFloating=function(){return floatingEndpoint!=null;};this.connectorSelector=function(){var candidate=self.connections[0];if(self.isTarget&&candidate)return candidate;else{return(self.connections.length<_maxConnections)||_maxConnections==-1?null:candidate;}};this.isFull=function(){return!(self.isFloating()||_maxConnections<1||self.connections.length<_maxConnections);};this.setDragAllowedWhenFull=function(allowed){dragAllowedWhenFull=allowed;};this.setStyle=self.setPaintStyle;this.equals=function(endpoint){return this.anchor.equals(endpoint.anchor);};var findConnectionToUseForDynamicAnchor=function(elementWithPrecedence){var idx=0;if(elementWithPrecedence!=null){for(var i=0;i<self.connections.length;i++){if(self.connections[i].sourceId==elementWithPrecedence||self.connections[i].targetId==elementWithPrecedence){idx=i;break;}}}
return self.connections[idx];};this.paint=function(params){params=params||{};var timestamp=params.timestamp,recalc=!(params.recalc===false);if(!timestamp||self.timestamp!==timestamp){_updateOffset({elId:_elementId,timestamp:timestamp,recalc:recalc});var xy=params.offset||offsets[_elementId];if(xy){var ap=params.anchorPoint,connectorPaintStyle=params.connectorPaintStyle;if(ap==null){var wh=params.dimensions||sizes[_elementId];if(xy==null||wh==null){_updateOffset({elId:_elementId,timestamp:timestamp});xy=offsets[_elementId];wh=sizes[_elementId];}
var anchorParams={xy:[xy.left,xy.top],wh:wh,element:self,timestamp:timestamp};if(recalc&&self.anchor.isDynamic&&self.connections.length>0){var c=findConnectionToUseForDynamicAnchor(params.elementWithPrecedence),oIdx=c.endpoints[0]==self?1:0,oId=oIdx==0?c.sourceId:c.targetId,oOffset=offsets[oId],oWH=sizes[oId];anchorParams.txy=[oOffset.left,oOffset.top];anchorParams.twh=oWH;anchorParams.tElement=c.endpoints[oIdx];}
ap=self.anchor.compute(anchorParams);}
var d=_endpoint.compute(ap,self.anchor.getOrientation(self),self.paintStyleInUse,connectorPaintStyle||self.paintStyleInUse);_endpoint.paint(d,self.paintStyleInUse,self.anchor);self.timestamp=timestamp;for(var i=0;i<self.overlays.length;i++){var o=self.overlays[i];if(o.isVisible)self.overlayPlacements[i]=o.draw(self.endpoint,self.paintStyleInUse,d);}}}};this.repaint=this.paint;this.removeConnection=this.detach;if(jsPlumb.CurrentLibrary.isDragSupported(_element)){var placeholderInfo={id:null,element:null},jpc=null,existingJpc=false,existingJpcParams=null,_dragHandler=_makeConnectionDragHandler(placeholderInfo);var start=function(){jpc=self.connectorSelector();var _continue=true;if(!self.isEnabled())_continue=false;if(jpc==null&&!params.isSource)_continue=false;if(params.isSource&&self.isFull()&&!dragAllowedWhenFull)_continue=false;if(jpc!=null&&!jpc.isDetachable())_continue=false;if(_continue===false){if(jsPlumb.CurrentLibrary.stopDrag)jsPlumb.CurrentLibrary.stopDrag();_dragHandler.stopDrag();return false;}
if(jpc&&!self.isFull()&&params.isSource)jpc=null;_updateOffset({elId:_elementId});inPlaceCopy=self.makeInPlaceCopy();inPlaceCopy.paint();_makeDraggablePlaceholder(placeholderInfo,self.parent);var ipcoel=_getElementObject(inPlaceCopy.canvas),ipco=jsPlumb.CurrentLibrary.getOffset(ipcoel),po=adjustForParentOffsetAndScroll([ipco.left,ipco.top],inPlaceCopy.canvas);jsPlumb.CurrentLibrary.setOffset(placeholderInfo.element,{left:po[0],top:po[1]});if(self.parentAnchor)self.anchor=_currentInstance.makeAnchor(self.parentAnchor,self.elementId,_currentInstance);_setAttribute(_getElementObject(self.canvas),"dragId",placeholderInfo.id);_setAttribute(_getElementObject(self.canvas),"elId",_elementId);if(params.proxy){self.setPaintStyle(params.proxy.paintStyle);}
floatingEndpoint=_makeFloatingEndpoint(self.getPaintStyle(),self.anchor,_endpoint,self.canvas,placeholderInfo.element);if(jpc==null){self.anchor.locked=true;self.setHover(false,false);jpc=_newConnection({sourceEndpoint:self,targetEndpoint:floatingEndpoint,source:self.endpointWillMoveTo||_getElementObject(_element),target:placeholderInfo.element,anchors:[self.anchor,floatingEndpoint.anchor],paintStyle:params.connectorStyle,hoverPaintStyle:params.connectorHoverStyle,connector:params.connector,overlays:params.connectorOverlays,type:self.connectionType,cssClass:self.connectorClass,hoverClass:self.connectorHoverClass});}else{existingJpc=true;jpc.connector.setHover(false,false);_initDropTarget(_getElementObject(inPlaceCopy.canvas),false,true);var anchorIdx=jpc.endpoints[0].id==self.id?0:1;jpc.floatingAnchorIndex=anchorIdx;self.detachFromConnection(jpc);var c=_getElementObject(self.canvas),dragScope=jsPlumb.CurrentLibrary.getDragScope(c);_setAttribute(c,"originalScope",dragScope);var dropScope=jsPlumb.CurrentLibrary.getDropScope(c);jsPlumb.CurrentLibrary.setDragScope(c,dropScope);if(anchorIdx==0){existingJpcParams=[jpc.source,jpc.sourceId,i,dragScope];jpc.source=placeholderInfo.element;jpc.sourceId=placeholderInfo.id;}else{existingJpcParams=[jpc.target,jpc.targetId,i,dragScope];jpc.target=placeholderInfo.element;jpc.targetId=placeholderInfo.id;}
jpc.endpoints[anchorIdx==0?1:0].anchor.locked=true;jpc.suspendedEndpoint=jpc.endpoints[anchorIdx];jpc.suspendedEndpoint.setHover(false);jpc.endpoints[anchorIdx]=floatingEndpoint;fireConnectionDraggingEvent(jpc);}
floatingConnections[placeholderInfo.id]=jpc;floatingEndpoint.addConnection(jpc);_addToList(endpointsByElement,placeholderInfo.id,floatingEndpoint);_currentInstance.currentlyDragging=true;};var jpcl=jsPlumb.CurrentLibrary,dragOptions=params.dragOptions||{},defaultOpts=jsPlumb.extend({},jpcl.defaultDragOptions),startEvent=jpcl.dragEvents["start"],stopEvent=jpcl.dragEvents["stop"],dragEvent=jpcl.dragEvents["drag"];dragOptions=jsPlumb.extend(defaultOpts,dragOptions);dragOptions.scope=dragOptions.scope||self.scope;dragOptions[startEvent]=_wrap(dragOptions[startEvent],start);dragOptions[dragEvent]=_wrap(dragOptions[dragEvent],_dragHandler.drag);dragOptions[stopEvent]=_wrap(dragOptions[stopEvent],function(){var originalEvent=jpcl.getDropEvent(arguments);_currentInstance.currentlyDragging=false;_removeWithFunction(endpointsByElement[placeholderInfo.id],function(e){return e.id==floatingEndpoint.id;});_removeElements([placeholderInfo.element[0],floatingEndpoint.canvas],_element);_removeElement(inPlaceCopy.canvas,_element);_currentInstance.anchorManager.clearFor(placeholderInfo.id);var idx=jpc.floatingAnchorIndex==null?1:jpc.floatingAnchorIndex;jpc.endpoints[idx==0?1:0].anchor.locked=false;self.setPaintStyle(originalPaintStyle);if(jpc.endpoints[idx]==floatingEndpoint){if(existingJpc&&jpc.suspendedEndpoint){if(idx==0){jpc.source=existingJpcParams[0];jpc.sourceId=existingJpcParams[1];}else{jpc.target=existingJpcParams[0];jpc.targetId=existingJpcParams[1];}
jsPlumb.CurrentLibrary.setDragScope(existingJpcParams[2],existingJpcParams[3]);jpc.endpoints[idx]=jpc.suspendedEndpoint;if(self.isReattach||jpc._forceDetach||!jpc.endpoints[idx==0?1:0].detach(jpc,false,false,true,originalEvent)){jpc.setHover(false);jpc.floatingAnchorIndex=null;jpc.suspendedEndpoint.addConnection(jpc);_currentInstance.repaint(existingJpcParams[1]);}
jpc._forceDetach=null;}else{_removeElements(jpc.connector.getDisplayElements(),self.parent);self.detachFromConnection(jpc);}}
self.anchor.locked=false;self.paint({recalc:false});jpc.setHover(false,false);fireConnectionDragStopEvent(jpc);jpc=null;inPlaceCopy=null;delete endpointsByElement[floatingEndpoint.elementId];floatingEndpoint.anchor=null;floatingEndpoint=null;_currentInstance.currentlyDragging=false;});var i=_getElementObject(self.canvas);jsPlumb.CurrentLibrary.initDraggable(i,dragOptions,true);}
var _initDropTarget=function(canvas,forceInit,isTransient,endpoint){if((params.isTarget||forceInit)&&jsPlumb.CurrentLibrary.isDropSupported(_element)){var dropOptions=params.dropOptions||_currentInstance.Defaults.DropOptions||jsPlumb.Defaults.DropOptions;dropOptions=jsPlumb.extend({},dropOptions);dropOptions.scope=dropOptions.scope||self.scope;var dropEvent=jsPlumb.CurrentLibrary.dragEvents['drop'],overEvent=jsPlumb.CurrentLibrary.dragEvents['over'],outEvent=jsPlumb.CurrentLibrary.dragEvents['out'],drop=function(){var originalEvent=jsPlumb.CurrentLibrary.getDropEvent(arguments),draggable=_getElementObject(jsPlumb.CurrentLibrary.getDragObject(arguments)),id=_getAttribute(draggable,"dragId"),elId=_getAttribute(draggable,"elId"),scope=_getAttribute(draggable,"originalScope"),jpc=floatingConnections[id];if(jpc!=null){var idx=jpc.floatingAnchorIndex==null?1:jpc.floatingAnchorIndex,oidx=idx==0?1:0;if(scope)jsPlumb.CurrentLibrary.setDragScope(draggable,scope);var endpointEnabled=endpoint!=null?endpoint.isEnabled():true;if(self.isFull()){self.fire("maxConnections",{endpoint:self,connection:jpc,maxConnections:_maxConnections},originalEvent);}
if(!self.isFull()&&!(idx==0&&!self.isSource)&&!(idx==1&&!self.isTarget)&&endpointEnabled){var _doContinue=true;if(jpc.suspendedEndpoint&&jpc.suspendedEndpoint.id!=self.id){if(idx==0){jpc.source=jpc.suspendedEndpoint.element;jpc.sourceId=jpc.suspendedEndpoint.elementId;}else{jpc.target=jpc.suspendedEndpoint.element;jpc.targetId=jpc.suspendedEndpoint.elementId;}
if(!jpc.isDetachAllowed(jpc)||!jpc.endpoints[idx].isDetachAllowed(jpc)||!jpc.suspendedEndpoint.isDetachAllowed(jpc)||!_currentInstance.checkCondition("beforeDetach",jpc))
_doContinue=false;}
if(idx==0){jpc.source=self.element;jpc.sourceId=self.elementId;}else{jpc.target=self.element;jpc.targetId=self.elementId;}
_doContinue=_doContinue&&self.isDropAllowed(jpc.sourceId,jpc.targetId,jpc.scope,jpc,self);if(_doContinue){jpc.endpoints[idx].detachFromConnection(jpc);if(jpc.suspendedEndpoint)jpc.suspendedEndpoint.detachFromConnection(jpc);jpc.endpoints[idx]=self;self.addConnection(jpc);var params=self.getParameters();for(var aParam in params)
jpc.setParameter(aParam,params[aParam]);if(!jpc.suspendedEndpoint){if(params.draggable)
jsPlumb.CurrentLibrary.initDraggable(self.element,dragOptions,true);}
else{var suspendedElement=jpc.suspendedEndpoint.getElement(),suspendedElementId=jpc.suspendedEndpoint.elementId;fireDetachEvent({source:idx==0?suspendedElement:jpc.source,target:idx==1?suspendedElement:jpc.target,sourceId:idx==0?suspendedElementId:jpc.sourceId,targetId:idx==1?suspendedElementId:jpc.targetId,sourceEndpoint:idx==0?jpc.suspendedEndpoint:jpc.endpoints[0],targetEndpoint:idx==1?jpc.suspendedEndpoint:jpc.endpoints[1],connection:jpc},true,originalEvent);}
_finaliseConnection(jpc,null,originalEvent);}
else{if(jpc.suspendedEndpoint){jpc.endpoints[idx]=jpc.suspendedEndpoint;jpc.setHover(false);jpc._forceDetach=true;if(idx==0){jpc.source=jpc.suspendedEndpoint.element;jpc.sourceId=jpc.suspendedEndpoint.elementId;}else{jpc.target=jpc.suspendedEndpoint.element;jpc.targetId=jpc.suspendedEndpoint.elementId;;}
jpc.suspendedEndpoint.addConnection(jpc);jpc.endpoints[0].repaint();jpc.repaint();_currentInstance.repaint(jpc.source.elementId);jpc._forceDetach=false;}}
jpc.floatingAnchorIndex=null;}
_currentInstance.currentlyDragging=false;delete floatingConnections[id];}};dropOptions[dropEvent]=_wrap(dropOptions[dropEvent],drop);dropOptions[overEvent]=_wrap(dropOptions[overEvent],function(){if(self.isTarget){var draggable=jsPlumb.CurrentLibrary.getDragObject(arguments),id=_getAttribute(_getElementObject(draggable),"dragId"),jpc=floatingConnections[id];if(jpc!=null){var idx=jpc.floatingAnchorIndex==null?1:jpc.floatingAnchorIndex;jpc.endpoints[idx].anchor.over(self.anchor);}}});dropOptions[outEvent]=_wrap(dropOptions[outEvent],function(){if(self.isTarget){var draggable=jsPlumb.CurrentLibrary.getDragObject(arguments),id=_getAttribute(_getElementObject(draggable),"dragId"),jpc=floatingConnections[id];if(jpc!=null){var idx=jpc.floatingAnchorIndex==null?1:jpc.floatingAnchorIndex;jpc.endpoints[idx].anchor.out();}}});jsPlumb.CurrentLibrary.initDroppable(canvas,dropOptions,true,isTransient);}};_initDropTarget(_getElementObject(self.canvas),true,!(params._transient||self.anchor.isFloating),self);if(params.type)
self.setType(params.type);return self;};};var jsPlumb=new jsPlumbInstance();if(typeof window!='undefined')window.jsPlumb=jsPlumb;jsPlumb.getInstance=function(_defaults){var j=new jsPlumbInstance(_defaults);j.init();return j;};var _curryAnchor=function(x,y,ox,oy,type,fnInit){return function(params){params=params||{};var a=params.jsPlumbInstance.makeAnchor([x,y,ox,oy,0,0],params.elementId,params.jsPlumbInstance);a.type=type;if(fnInit)fnInit(a,params);return a;};};jsPlumb.Anchors["TopCenter"]=_curryAnchor(0.5,0,0,-1,"TopCenter");jsPlumb.Anchors["BottomCenter"]=_curryAnchor(0.5,1,0,1,"BottomCenter");jsPlumb.Anchors["LeftMiddle"]=_curryAnchor(0,0.5,-1,0,"LeftMiddle");jsPlumb.Anchors["RightMiddle"]=_curryAnchor(1,0.5,1,0,"RightMiddle");jsPlumb.Anchors["Center"]=_curryAnchor(0.5,0.5,0,0,"Center");jsPlumb.Anchors["TopRight"]=_curryAnchor(1,0,0,-1,"TopRight");jsPlumb.Anchors["BottomRight"]=_curryAnchor(1,1,0,1,"BottomRight");jsPlumb.Anchors["TopLeft"]=_curryAnchor(0,0,0,-1,"TopLeft");jsPlumb.Anchors["BottomLeft"]=_curryAnchor(0,1,0,1,"BottomLeft");jsPlumb.Defaults.DynamicAnchors=function(params){return params.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],params.elementId,params.jsPlumbInstance);};jsPlumb.Anchors["AutoDefault"]=function(params){var a=params.jsPlumbInstance.makeDynamicAnchor(jsPlumb.Defaults.DynamicAnchors(params));a.type="AutoDefault";return a;};jsPlumb.Anchors["Assign"]=_curryAnchor(0,0,0,0,"Assign",function(anchor,params){var pf=params.position||"Fixed";anchor.positionFinder=pf.constructor==String?params.jsPlumbInstance.AnchorPositionFinders[pf]:pf;anchor.constructorParams=params;});jsPlumb.Anchors["Continuous"]=function(params){return params.jsPlumbInstance.continuousAnchorFactory.get(params);};jsPlumb.AnchorPositionFinders={"Fixed":function(dp,ep,es,params){return[(dp.left-ep.left)/es[0],(dp.top-ep.top)/es[1]];},"Grid":function(dp,ep,es,params){var dx=dp.left-ep.left,dy=dp.top-ep.top,gx=es[0]/(params.grid[0]),gy=es[1]/(params.grid[1]),mx=Math.floor(dx/gx),my=Math.floor(dy/gy);return[((mx*gx)+(gx/2))/es[0],((my*gy)+(gy/2))/es[1]];}};jsPlumb.Anchors["Perimeter"]=function(params){params=params||{};var anchorCount=params.anchorCount||40,shape=params.shape;if(!shape)throw new Error("no shape supplied to Perimeter Anchor type");var _shapes={"circle":function(){var r=0.5,step=Math.PI*2/anchorCount,current=0,a=[];for(var i=0;i<anchorCount;i++){var x=r+(r*Math.sin(current)),y=r+(r*Math.cos(current));a.push([x,y,0,0]);current+=step;}
return a;},"ellipse":function(){var step=Math.PI*2/anchorCount,current=0,a=[];for(var i=0;i<anchorCount;i++){var x=0.5+(params.rx*Math.sin(current)),y=0.5+(params.ry*Math.cos(current));a.push([x,y,0,0]);current+=step;}
return a;}};if(!_shapes[shape])throw new Error("Shape ["+shape+"] is unknown by Perimeter Anchor type");var da=_shapes[shape](),a=params.jsPlumbInstance.makeDynamicAnchor(da);a.type="Perimeter";return a;};})();